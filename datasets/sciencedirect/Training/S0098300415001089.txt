@&#MAIN-TITLE@&#
Ratiocalc: Software for processing data from multicomponent volcanic gas analyzers

@&#HIGHLIGHTS@&#
Portable gas analyzers for the real-time monitoring of volcanic gas composition.Ratiocalc software for the processing of chemical data obtained using the MultiGAS.Electrochemical and infrared sensors for volcanic gas measurements.Calibration, cross-interference correction, georeferencing of MultiGAS data.

@&#KEYPHRASES@&#
MultiGAS,Ratiocalc,Volcanic gas,Gas sensors,Gas analyzer,

@&#ABSTRACT@&#
Portable gas analyzers have become a powerful tool for the real-time monitoring of volcanic gas composition over the last decade. Gas analyzers make it possible to retrieve in real-time the chemical composition of a fumarole system or a plume in an open-conduit volcano via periodic field-deployments or at permanent stations. The core of a multicomponent volcanic gas analyzer (MultiGAS) consists of spectroscopic and electrochemical sensors that are used to determine the concentrations of the most abundant volcanic gases (H2O, CO2, SO2, H2S, H2, CO and HCl) in a diluted plume and their mutual molar ratios. Processing such data is often difficult due to the high sensitivity of the sensors to environmental conditions such as humidity, gas concentrations, and pressure, with all involving occasional instrumental drift. Analyses require accurate and time-consuming processing by an operator. This paper presents a stand-alone program for the processing of chemical data obtained using the MultiGAS, called Ratiocalc. The Ratiocalc program has a user-friendly interface to enable volcanologists to process large datasets in a simple and rapid manner, thereby reducing the processing time associated with volcano monitoring and surveying.

@&#INTRODUCTION@&#
Real-time observation of volcanic gas composition was achieved in the last decade with the advent of portable multisensor systems, the MultiGAS (e.g. Aiuppa et al., 2005; Shinohara, 2005; Roberts et al., 2012). Such devices usually integrate an infrared spectrometer for CO2 and H2O determination (Aiuppa et al., 2007) with electrochemical sensors for SO2, H2S, H2, HCl and CO detection (Aiuppa et al., 2005, 2012; Roberts et al., 2012). The volcanic gases are actively pumped into the detectors at a constant flow rate (typically 0.5–2lpm), and the output electrical signals are captured by a data-logger board. The MultiGAS allows the determination of the volcanic gas molar ratios that represent key parameters in volcano monitoring: the CO2/SO2 ratio is a depth marker based on the contrasting solubility properties of CO2 and SO2, while H2/H2O and SO2/H2S are important markers for redox, temperature, and pressure conditions (Giggenbach, 1987; Aiuppa et al., 2006). The MultiGAS operates directly in situ, close to the gas sources (e.g., fumaroles or plumes) so as to avoid extensive dilution. Depending on the volcanic gas source strength, the working distance ranges from <1m up to hundreds of meters from the emission point. This technique has the advantages of easy management, robustness, and low construction cost (<USD 6000), and potential for automation (e.g. Aiuppa et al., 2007). The relative low power consumption (<10W) and small dimensions (30cm×20cm×15cm) of the MultiGAS also facilitates its deployment in hostile and poorly accessible areas as the crater rims of open conduit volcanoes and fumarole fields.The relative simplicity of the MultiGAS hardware is contrasted by the complexity of the subsequent data analysis, which is greatly influenced by the environmental conditions (e.g., volcanic gas concentrations, humidity, and clouds) and the instrumental response (e.g., instrumental drift). This can result in postprocessing taking a long time when using generic software (e.g., spreadsheets such as Excel, or other numerical computing environments such as MATLAB), which is especially inconvenient when processing the huge datasets associated with volcano monitoring (e.g. with typical acquisition rates of 0.1–1Hz).Here we present Ratiocalc (Fig. 1), a user-friendly and freely available program (at http://sites.google.com/site/giancarlotamburello/volcanology/ratiocalc), for the postprocessing of data on volcanic gas concentrations recorded using the MultiGAS or general electrochemical sensors-based devices. Ratiocalc consists of an integrated suite of tools that makes it possible to instantly and dynamically obtain various types of statistical information, including scatterplots and related regression lines, histograms, georeferencing on Google Maps, hand-trackable trend lines, and cross-interferences within sensor pressure corrections. Included in the download are a detailed user manual and several examples for facilitating familiarization with the data analysis.Ratiocalc was written in LabVIEW and saved as a stand-alone application, so no additional software is required to run it. The software is flexible in terms of the data input type, in that it can open any properly formatted.csv data table from any multisensor device.Electrochemical and spectroscopic sensors measure gas concentrations by pumping the external air/plume mixture recorded at a given distance from the source. The absolute concentration measured depends on plume advection and dilution in the atmosphere. Nevertheless, the molar ratio among gas species can be determined to characterise the emissions.The gas molar ratio can be calculated by applying the following four methods to two concentration time series: the ratio between integrated areas (e.g. Shinohara, 2005) (Fig. 2a), the slope of a best-fit regression line (e.g. Aiuppa et al., 2005) (Fig. 2b), the dot-to-dot ratio versus time (Pering et al., 2014) (Fig. 2c), and the dot-to-dot ratio versus concentration (Fig. 2d) of a volcanic gas indicator. Three of these methods (not the regression line) require the atmospheric background to be subtracted (if it is relevant, which is the case for CO2 and H2O, but not for SO2 and H2S whose background abundance is very low compared to the plume). If the background correction is successful, the results of the regression line and areas methods will ideally converge to the same value unless other errors are present, see Roberts et al., 2014. The dot-to-dot ratio time series (Fig. 2c) is a point-by-point calculation of the volcanic gas ratio for each measurement time-stamp. It provides the highest temporal resolution, which is optimal for detecting rapid changes in the chemical composition (Pering et al., 2014), but it is more affected by signal noise, especially at low concentrations (Fig. 2c, d).This article provides a synopsis of the capabilities of Ratiocalc and presents the general framework for its usage. More information about how to use the software is available in the downloadable manual of Ratiocalc.Ratiocalc is a computational program suited for processing time series of volcanic gas concentrations produced from any multisensor device, with special emphasis on the INGV MultiGAS analyzer. The installer and manual are downloadable from https://sites.google.com/site/giancarlotamburello/volcanology/ratiocalc. Ratiocalc runs only on Windows platforms, and the guided installation procedure is straightforward. While some computers might run slowly when applying the calculation procedures to huge datasets, this problem is easily solved by fragmenting the dataset.Ratiocalc software can load all tabular data items of raw data (to be calibrated, see user manual in the auxiliary material for further informations) or volcanic gas concentration (in ppmv molar ratio, equivalent to μmol/mol) in a plain-text format (e.g., txt or csv) structured with a header as the first row, the names of the gas species and a time/date vector (in free format) in the first column (seeTable 1), and latitude and longitude vectors (in decimal degrees) as the last columns, if the measurements have been GPS-synchronized. Geolocalization of the measurements is crucial for the chemical mapping of fumarole fields or multiple-vent volcanoes. Ratiocalc integrates satellite maps from Google (using the Google Static Maps API) so as to enable the identification of the gas sources and/or topographic elements where high resolution satellite maps are available (Fig. 3).Ratiocalc interface presents three graphs: a main graph (Fig. 2a), a subset graph (Fig. 2b) and a ratio graph (Fig. 2c). The main graph displays the whole concentration time series of two gas species, selectable from the dataset, and green and red cursors for cropping a subset of the dataset, which is plotted and processed in real time in the other two graphs. Primary processing consists of calculating the molar ratio (e.g., CO2 and SO2 in Fig. 2) and error respectively from the slope and the R2 value of the best-fit line (linear regression) plotted in the “Slope” graph (red line in Fig. 2c). Ratiocalc simultaneously calculates the ratio between the areas under the curves plotted in the subset graph (Fig. 2b), providing a helpful dynamic working window.Electrochemical and spectroscopic sensors exhibit different response times (e.g., T90~10s for CO2 Gascard NG and ~20s for SO2 Citytechnology at 20°C) due to the different kinetics of the processes, and these change with the gas concentration (and redox reactions and infrared absorption). Evidence from this difference is shown by Roberts et al. (2014) and manifests as a common phase shift between two signals and different levels of noise. Ratiocalc can be used to apply a fast Savitzky–Golay filter (Savitzky and Golay, 1964) to the signals for the purpose of smoothing the noisiest data and to find the phase shift by cross-correlating the two signals. However Roberts et al. (2014) recently highlighted errors and bias can result in volcano gas ratio analysis when sensor signals are phase-shifted to correct for their differing response times, instead advocating sensor response modeling or integration techniques. The RatioCalc software provides a practical tool for testing several analysis methods in this context. The dot-to-dot and Histogram panels at the lower-right corner provide useful tools for exploring the dot-to-dot calculated molar ratios of two background air-corrected gas concentration time series. The default graph consists of a scatterplot of the molar ratio versus selected plume marker concentrations; that is, a gas species of strictly deep volcanic origin (e.g., SO2 in Fig. 1d). The background air-corrected molar ratios are widely scattered at low SO2 concentrations but converge to a less-varying ratio at high SO2 concentrations (Fig. 2d). This convergence trend is expected on statistical grounds but it might also reflect the presence of multiple gas sources: CO2/SO2 ratios are commonly lower for SO2-concentrated plumes than for SO2-poor fumaroles. If the SO2-concentrated plume has a large contribution from the main vent gas, the CO2/SO2 ratio of the main vent gas can be obtained from the converged value. This method cannot be applied to H2O data whose background concentrations are variable.Electrochemical gas sensors can be affected by minutes-long instrumental drifts during an acquisition epoch. The nature of these variations is unknown, but it is evident from the field tests and measurements that environmental conditions such as gas temperature and the water content have important influences (Roberts et al., 2012). Drifts consist of rapid changes in the offset or smooth variations of variable period. Ratiocalc allows a trend to be tracked manually by positioning typically five to ten points along the trend and interpolating them with a spline.A gas sensor can be calibrated to allow its current output to be converted into gas concentrations and to quantify potential cross-sensitivities with other gases (see the next paragraph). A calibration is often performed by inflating a Tedlar bag with the standard gas that is subsequently pumped inside the sensor at a low flow rate (0.5–2lpm) in order to reproduce the measurement conditions in the field. Previous studies (Aiuppa et al., 2011; Roberts et al., 2012) have demonstrated the high linearity of most commercially available gas sensors, and hence they are characterizable with a two-point calibration. Ratiocalc offers an easy tool (the Calibration panel) for converting a dataset with adimensional counts or electric signals (e.g. mV, mA) into concentrations using up to nine reference gas concentrations and to save a calibration file so that it can be reused to configure other sensors of the same type.Electrochemical sensors are generally fairly selective for the target gas they are designed for. The degree of selectivity depends on the type of sensor, the target gas, and the range of gas concentrations that the sensor is designed to detect. Most of the electrochemical sensors are affected by interference from other gases (e.g., CO and H2S sensors); the Interference panel of Ratiocalc makes it possible to subtract thus interference of a gas on a sensor following the analysis method described by Roberts et al. (2014) for SO2–H2S. The most important sensor used in volcanology that is affected by interference is the H2S sensor, which is also sensitive to SO2 gas. The interference is often linear, being constant over a wide range of SO2 concentrations, but it varies among sensors from the same manufacturer and hence the interference must be verified in the laboratory. For example, laboratory tests (Gaetano Giudice personal communication) have shown that the interference with SO2 for the H2S sensor produced by City Technology (http://www.citytech.com) is 7–25%.Consider the following three scenarios for two gas sensors A and B that are sensitive to gases Ag and Bg, respectively, in which at least one sensor is affected by cross-interference:1.Sensor A is sensitive to Bg, sensor is interference-free, and we want to calculate the Ag/Bg or Bg/Ag molar ratio.Ag interferes with sensor B and Bg interferes with sensor A, and we want to calculate the Ag/Bg or Bg/Ag molar ratio.Ag interferes with sensor B, which is interference-free, and we want to calculate the ratio with a third gas Cg (which is also interference-free): Ag/Cg or Cg/Ag.For the first scenario, which is typical for H2S and SO2 gas sensors, the corrected concentration [H2S]corrof hydrogen sulfide, as reported by Roberts et al. (2012), is equal to(1)[H2S]corr=[H2S]interf−[SO2]⋅FSO2/H2Swhere [H2S]interfis the uncorrected measured H2S concentration, [SO2] is the sulfur dioxide concentration measured with an SO2 sensor (cross-interference free), andFH2O/H2Sis the interference factor of SO2 gas on the H2S sensor.For the second scenario, involving the presence of two gas sensors with mutual cross-interference (e.g., H2 and CO), the corrected concentrations [H2]corrand [CO]corrof hydrogen and carbon monoxide are given by(2)[H2]corr=[H2]interf−[CO]corr⋅FCO/H2(3)[CO]corr=[CO]interf−[H2]corr⋅FH2/COwhich becomes(4)[H2]corr=[H2]interf−FCO/H2⋅[CO]interf1−FCO/H2⋅FH2/CO(5)[CO]corr=[CO]interf−FH2/CO⋅[H2]interf1−FCO/H2⋅FH2/COwhere [H2]interfand [CO]interfare the uncorrected measured H2 and CO concentrations, respectively,FCO/H2is the interference factor of CO gas on the H2 sensor, andFH2/COis the interference factor of H2 gas on the CO sensor. Ratiocalc corrects the cross-interference of sensors using Eq. (1) (the first scenario).A faster method for calculating directly the corrected molar ratio between two gases (first and second scenarios) is obtained by rearranging Eqs. (1), (4), and (5) so that the corrected ratio can be obtained by calculating the molar ratios between uncorrected gas concentrations through the slope of a best-fit regression line. For the first scenario, we can calculate the ratio between the sensor affected by interference (e.g., H2Sinterf, sensitive to SO2) using a sensor that can measure the interfering gas of the first sensor (e.g., SO2). Dividing Eq. (1) by [SO2] yields(6)[H2S]corr[SO2]=[H2S]interf[SO2]−FSO2/H2SA negative calculated [H2S]corr/[SO2] molar ratio implies that the concentration of the corrected gas (H2S in the case above) is below the detection limit.A mathematical approach can be applied to second scenario as well. According to Eqs. (4) and (5), the H2/CO corrected molar ratio can be calculated as follows:(8)[H2]corr[CO]corr=[H2]interf−FCO/H2⋅[CO]interf1−FCO/H2⋅FH2/CO[CO]interf−FH2/CO⋅[H2]interf1−FCO/H2⋅FH2/COwhich corresponds to(9)[H2]corr[CO]corr=[H2]interf−FCO/H2⋅[CO]interf[CO]interf−FH2/CO⋅[H2]interfMultiplying the numerator and denominator of the second term by 1/[CO]interf yields(10)[H2]corr[CO]corr=[H2]interf[CO]interf−FCO/H21−FH2/CO[H2]interf[CO]interfThis method makes possible to correct mathematically the interference while avoiding the dot-to-dot subtraction that is strongly affected by sensor phase shifts and electronic noise.

@&#CONCLUSIONS@&#
The in-situ electrochemical/spectroscopic sensor detection of volcanic gases represents an outstanding technique for monitoring volcanic activity. Due to the low power requirements and low construction cost (lower than that of a DOAS or FTIR instrument), the MultiGAS technique may became the first-choice device for real-time gas analysis in volcanic areas worldwide.This paper has introduced Ratiocalc, which is a stand-alone application that provides valuable tools for processing volcanic gas chemical data produced from gas sensors. A very user-friendly interface makes the data analysis rapid and easy, even for operators who are not familiar with this kind of data. Ratiocalc is already being used by several scientists worldwide for monitoring volcanic gas compositions, including at Turrialba and Poàs in Costa Rica (Aiuppa et al., 2014; monitoring in the framework of the Deep Carbon Degassing (DECADE) Project: Implementation of MultiGAS Instruments in the DECADE Project, ID 11121/2774-1977-2373-4052-CC), Hekla and Krýsuvík in Iceland, Stromboli and Mt. Etna in Italy (INGV-Palermo monitoring network), Nea Kameni in Greece (Bagnato et al., 2013; monitoring in the framework of the Deep Carbon Degassing (DECADE) Project), and Masaya in Nicaragua (monitoring in the framework of the Deep Carbon Degassing (DECADE) Project: Implementation of MultiGAS Instruments in the DECADE Project, ID 11121/2774-1977-2373-4052-CC)