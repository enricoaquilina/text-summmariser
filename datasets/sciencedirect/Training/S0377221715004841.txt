@&#MAIN-TITLE@&#
Capacitated p-center problem with failure foresight

@&#HIGHLIGHTS@&#
Different formulations for a genearalized p-center location problem.Developing of a heuristic approach to solve the problem.Development of preprocessing phases for fixing variables.Valid inequalities have been proposed for strengthening the formulations.An exact solution approach reducing two orders of magnitude the initial CPU times.

@&#KEYPHRASES@&#
p-center,Capacities,Integer programming,

@&#ABSTRACT@&#
This paper deals with a generalized version of the capacitated p-center problem. The model takes into account the possibility that a center might suffer a disruption (being unavailable to serve some demand) and assumes that every site will be covered by its closest available center. The problem is of interest when the goal is to locate emergency centers while, at the same time, taking precautions against an unforeseen incident (natural disaster, labor strike, accident…) which can cause failure of a center. We consider different formulations for the problem and extensive computational tests are reported, showing the potentials and limits of each formulation in several types of instances. Finally, a preprocessing phase for fixing variables has been developed and different families of valid inequalities have been proposed to strengthen the most promising formulations, obtaining in some cases much better resolution times.

@&#INTRODUCTION@&#
Facility location models have been extensively studied in the literature. Various kinds of facilities have been modeled, such as routers or servers in communication networks, warehouses or distribution centers in a supply chain, hubs or transshipment nodes in passenger transport, and hospitals or emergency facilities in a public service system, among many others. In general, the goal of these problems is to locate the facilities among a set of candidate sites and to assign customers to the facilities, optimizing some effectiveness measure that usually depends of the distances between the facilities and the customers, see for instance Daskin (1995) and Drezner and Hamacher (2002) and the references therein. The p-center problem (pCP) is a well-known discrete optimization location problem which consists of locating p centers out of n sites and assigning (allocating) the remainingn−psites to the centers so as to minimize the maximum distance (cost) between a site and the corresponding center. It was shown in Kariv and Hakimi (1979) that pCP is NP-hard. A straight application of pCP is the location of emergency services like ambulances, hospitals or fire stations, since the whole population should be inside a small radius around some emergency center. pCP has been extensively studied, and both exact and heuristic algorithms have been proposed. Recent articles on this issue are Mladenović, Labbé, and Hansen (2003), Elloumi, Labbé, and Pochet (2004), Daskin (2000) and Calik and Tansel (2014). We also refer the reader to Chapter 5 of Daskin (1995). A recent survey on location of emergency services can be consulted in Basar, Aatay, and Unluyurt (2012).Emergency services have, in practice, a limited capacity. Consequently, capacitated versions of pCP have also received attention in the literature. In the capacitated p-center problem (CpCP), each site has a demand and a capacity, and the total demand of the sites assigned to a center cannot exceed its capacity. Thus, CpCP is the problem of finding the set of p locations and the assignment pattern that satisfies the capacity constraints while minimizing the maximum distance site-closest center. A local search heuristic for CpCP has been developed in Scaparra, Pallotino, and Scutellá (2004). The special case where all demands are equal has been studied in Bar-Ilan, Kortsarrz, and Peleg (1993) and Khuller and Sussmann (2000). To the best of our knowledge, only in three papers, CpCP has been solved exactly. Jaeger and Goldberg (1994), where the special case of an underlying tree network is approached; Özsoy and Pinar (2006), where an algorithm developed in Ilhan and Pinar (2001) for the p-center problem is modified and extended, succeeding in providing optimal solutions in short times for small instances of the problem; and Albareda-Sambola, Díaz, and Fernández (2010) where the authors propose two different Lagrangian duals and an exact algorithm able to solve larger instances. In Kalcsics, Nickel, Puerto, and Rodríguez-Chía (2010), the capacitated ordered discrete location problem is studied; among many others, CpCP is a particular case obtained by fixing a parameterized vector used to get the objective function of the model to(0,…,0,1).In addition to the capacity constraint of the facilities, there is an important aspect that deserves attention, namely, the possibility of disruption of the facilities. Although most models in the literature on Location Theory have treated facilities as if they could never fail, there is a wide variety of reasons for which facilities can fail in practice (industrial accidents, natural disaster, labor strikes, et cetera). Some illustrative examples of real situations of the damage caused in facilities can be seen in the introduction of O’Hanley, Scaparra, and García (2013). There is some research on discrete location dealing with facility disruptions, although it is mainly focused on stochastic assumptions and reliability issues in supply chain design. In those models, some known probability of failure is considered for each of the facilities and the goal is to minimize the expected cost; if a facility fails, customers originally assigned to it have to be reassigned to other facilities. In Ball and Lin (1993) the authors attempt to increase the system availability through redundant coverage. In Snyder and Daskin (2005) an implicit formulation of the stochastic p-median problem as a linear integer program is developed, where the facilities are subject to failure with the same probability. In Zhan, Shen, and Daskin (2007) the authors provide several heuristics for the stochastic fixed-charged problem, which is also formulated as a nonlinear mixed integer program. Heuristics with bounds on the worst-case performance and the study of asymptotic properties of the solutions of the stochastic p-median problem are carried out in Berman, Krass, and Menezes (2007). In Cui, Ouyang, and Shen (2010), the uniform failure probability assumption in Snyder and Daskin (2005) is relaxed and the failure probabilities are facility-specific. In addition, the authors propose a mixed-integer formulation and a continuum approximation formulation to solve large-scale problems. In Shen, Zhan, and Zhang (2011), the problem is formulated as a two-stage stochastic program and then as a nonlinear integer program. Several heuristics and a 4-approximation algorithm are provided. Recently, O’Hanley et al. (2013) extend Berman et al. (2007) and Cui et al. (2010) by proposing an exact linear reformulation of the unreliable p-median problem given unequal facility disruption probabilities. Unlike the previous references, some recent papers deal with facility disruption without considering probabilities. In O’Hanley and Church (2011) the authors maximize a combination of initial coverage and the minimum coverage level after the loss of the most critical facilities. From a bilevel point of view, Aksen, Aras, and Piyade (2013) consider the location of p facilities and, in a second step, the protection of some of these under budget constraints. A related model that also considers capacity constraints is given in Aksen and Aras (2012). There is even one more paper in this line that considers the possibility of disruption in a hub location environment (Parvaresh, Husseini, Golpayegany, & Karimi, 2014), where some heuristics are developed with the aim of minimizing the effects of an attacker after designing the hub network.Other related research fields are the fortification of reliability of the service to cover a set of existing facilities and the backup set covering problems. The interdiction-fortification p-median problem is generally formulated as a bilevel programming problem, where the idea is to protect the existing critical facilities under the events of disruption, see Snyder, Scaparra, Daskin, and Church (2006) and Scaparra and Church (2008). In Lei and Church (2011), the authors use explicit closest assignment constraints for a novel multilevel facility interdiction problem that optimize worst levels of facility disruptions. A recent paper in this field that takes capacities into consideration (see also references therein) is Liberatore, Scaparra, and Daskin (2012), where the authors consider the protection of a capacitated median system with a limited amount of protective resources subject to partial or complete disruption of the facilities involved. On the other hand, several backup set covering problems have also appeared in the literature under the common idea of covering the demand points with several centers in order to guarantee the coverage in case of either failure or an overflow into one or some centers (in this sense, the model proposed in this paper can be considered a backup problem). In these models there are two natural objectives: Minimization of the number of open centers and maximization of the backup coverage. Several times the model is approached from the point of view of multiobjective optimization (Storbeck & Vohra, 1988) and model BACOP1 in Hogan and ReVelle (1986) are two examples of such an approach. At other times, both objectives are combined in a unique function as in model BACOP2 of Hogan and ReVelle (1986). In Weaver and Church (1985) the authors take a different approach with the Vector Assignment p-Median Model. In their model, a fixed fraction of each node’s demand is allocated among the facilities on the basis of their proximity, e.g., 70 percent of a node’s demand is assigned to the closest facility, 10 percent to the next closest facility, and so forth. Very recently, Curtin, Hayslett-McCall, and Qiu (2010) present a new backup coverage model that is appropriate for patrol area design, see also the references therein.This paper seeks to generalize the capacitated p-center problem by considering the possibility that a facility might suffer a disruption, being unavailable to serve some demand. These two joint aspects (capacity constraint and failure possibility) make the model we consider in this paper more fitting for some real situations. What we are going to consider is that sites must still be assigned to their closest centers and so any center j must have enough capacity to satisfy the demands of the sites which are closer to j than to any other center. In addition, an unpredictable incident may occur in any of the p centers, forcing it to be closed. Then each customer allocated to it is re-assigned to another center, which must be its second closest center. Consequently, the capacity of any center must be enough to receive also the sites re-assigned to it in case of failure of any other center. The goal then is to minimize the second lowest distance from a site to the set of centers, since in case of an accident which produces a damage in one of the emergency services, all the sites should still be inside the smallest possible radius around an available center. Since we consider emergency services which could be essential for saving lives, increasing the operation cost (with respect to not considering failure possibility) to prevent facility disruptions is fully justified. Observe that this problem is NP-hard because its uncapacitated 2p-facility version can be reduced to a pCP. We call our model Capacitated Second p-Center Problem (CSpCP, in short).The paper is organized as follows. In the next section, we formalize the problem and illustrate it with an example. In Section 3, different integer programming formulations for CSpCP are introduced. A comparison of CSpCP with CpCP with closest assignment and preliminary computational results are given in Section 4. In Section 5, a heuristic approach is developed and then, in Section 6, we use this heuristic to improve the formulations using different variable fixing strategies and strengthening formulations with new valid inequalities which are computationally compared. We end with some conclusions.LetN={1,…,n}be the given set of sites. Throughout the paper we assume, without loss of generality, that the set of candidate sites for centers is identical to N. Let hidenote the demand of site i ∈ N, bithe capacity of a center located at site i ∈ N, and p ≥ 2 be the number of centers to be located. For each pair (i, j), i, j ∈ N, let dijbe the distance (cost, travel time) from i to j. We assumedii=0∀i ∈ N and dij> 0 ∀i, j ∈ N: i ≠ j. We do not assume other special properties like satisfaction of triangle inequality, that is to say, strictly speaking d is not a distance. But we need to make an additional assumption to deal with the case of ties among several distances from the same site. If this is the case, in order to break ties we suppose that there are preferences on the centers such that sites will undoubtedly choose one center before the others. In practice, ties can be broken by slightly perturbing the tied distances. Summarizing, we will also assume dia≠ dib∀i, a, b ∈ N: a ≠ b. Then CSpCP is to choose p centers{i1,…,ip}among the n sites to minimize the distance from any site to its second closest center while satisfying the capacity limitations. This means that for anyi∈{i1,…,ip},bi≥maxj∈{i1,…,ip}∖{i}∑k:i=argminℓ∈{i1,…,ip}∖{j}dkℓhkmust hold. We present now an example of the problem for the sake of clarity.Example 2.1Consider eight points in the plane with coordinates (1.1,3.3), (6.4,5.6), (6.3,3.7), (2.7,9.1), (7.0,8.3), (3.7,3.8), (5.9,3.9) and (6.1,6.5), demands 5, 2, 2, 4, 1, 5, 4 and 4 and capacities 6, 7, 13, 11, 15, 13, 15 and 15, respectively. The ℓ1 norm is used to compute distances between points. Takingp=4,the optimal solution of the problem is given in Fig. 1. Centers are drawn inside circles; the closest center to a non-center point is indicated by a segment, and the second closest center with respect to a point is depicted with a two tip arrow. For instance, point 5 is not a center, its closest center is 8 and its second closest center is 7.To see that the solution satisfies the capacity constraints, in the following table we give for each center j (column 1), the total demand of points having j as their closest center (column 2), the additional demand assigned to j in case of failure of either 1, 6, 7 or 8 (columns 3–6), the maximum of the last four amounts (column 7), the sum of columns 2 and 7 (column 8) and the capacity of center j (column 9).CenterDemand1 fails6 fails7 fails8 failsMaxTotalCapacity15-000056655−64611137605−771315811000−01115For instance, center 7 is the closest center with respect to points 3 and itself, with a total demand of2+4=6. In case of failure of center 1, 7 would not receive additional demand. In case of failure of 6, 7 would receive the demand of point 6, which is 5. In case of failure of center 8, 7 would receive the demand of points 2, 5 and 8, i.e.,2+1+4=7. This is the worst case, and then in case of failure of center 8, center 7 would need enough capacity to cover the demand of6+7=13. Since the capacity of 7 is 15, the corresponding capacity constraint is satisfied.The objective value is given by the maximum distance from a point (in this case point 4) to its second closest center (in this case 6), as indicated in the figure by a dashed arrow.The model proposed in this work can be formulated as an integer linear programming problem. In this section we present several formulations.For the first formulation we will define the following two usual sets of binary variables, which will be used to determine the location of the centers and the allocation of the sites to the centers (the closest and the second-closest ones, respectively).yj={1,ifacenterislocatedatsitej,0,otherwise,j∈N,xijk={1,iftheclosestandthesecond-closestcenterstositeiarejandk,respectively,0,otherwise,∀i,j,k∈N.The formulation is(1)(P3)minz(2)s.t.∑j∈N∑k∈Nk≠i,jxijk=1∀i∈N,(3)∑j∈Nyj=p(4)∑ℓ∈Ndiℓ>dij∑k∈Nk≠i,ℓxiℓk+∑ℓ∈Ndiℓ<dij∑k∈Ndik>dijk≠i,ℓxiℓk+yj≤1∀i,j∈N,(5)∑ℓ∈N∑k∈Nk≠ℓ,jhℓxℓjk+∑ℓ∈Nℓ≠jhℓxℓij≤bjyj∀i,j∈N:i≠j,(6)z≥∑j∈N∑k∈Ndikxijk∀i∈N,(7)yj∈{0,1}∀j∈N,(8)xijk∈{0,1}∀i,j,k∈N.The objective function (1) together with constraints (6) are used to get the maximum distance of any site with respect to its second closest center by means of an additional decision variable z which is minimized in the objective. Constraints (2) force each site to be allocated to a pair of different centers. Constraint (3) fixes the number of centers to p.In order to ensure that a site is not assigned to centers other than the two closest ones, constraints (4) are incorporated into the formulation. Given a site i and a center j (i.e.,yj=1), x-variables in the first term (forced to take value 0) correspond with routes whose first center is further from i than j. Similarly, x-variables in the second term are fixed to 0 if the corresponding route goes first to a center closer to i than j but afterward to a center further to i than j. Both sets of variables can be aggregated (so producing a stronger formulation) since in caseyj=0,the resulting constraint is implied by (2).Constraints (5) have a double mission: preventing sites being assigned to sites which are not centers and keeping the demand of sites assigned to the same center under the capacity of this center. The demand added up on the left hand side splits into∑ℓ∈N∑k∈Nk≠ℓ,jhℓxℓjk,which is the demand of sites assigned to j as their first center, and∑ℓ∈Nℓ≠jhℓxℓij,which is the demand of sites having j as their second center and i as their first center. Finally, binarity of all variables is fixed in constraints (7) and (8).In what follows, we show the need for the families of constraints describing formulation (P3). It is clear that constraints (2), (3), (5) and (6) are necessary. Regarding family of constraints (4), we again consider the instance given in Example 2.1. After removing constraints (4), the optimal solution we obtain is depicted in Fig. 2. Here, for instance, site 1 is not allocated first to its closest center. The reason is to exploit the capacity of further centers in order to reduce the objective value. Also, site 5 is allocated first to 6 (and then to 8), not to itself. Similarly, sites 8 and 3 are allocated first to 5 (and then to 3 and 6, respectively).Note that xijk-variables withi=korj=kwill never take value 1 at any optimal solution and can be fixed at zero. Several other variables can be fixed at zero in (P3). The second closest center w.r.t. i will never be closer to i than the closest center, thenxijk=0∀i,j,k∈N:dij≥dik.Furthermore, y-variables can be removed from the formulation by taking into account thatyi=∑k∈Nxiik∀i∈N.In this formulation we will use the following sets of binary variables:xjj={1,ifacenterislocatedatsitej,0,otherwise,j∈N,xij={1,iftheclosestcentertositeiisj,0,otherwise,∀i,j∈N.Note thatxjj=1implies self allocation of site j. Additionally, we incorporate into the formulation the set of binary variableswij={1,ifthesecondclosestcentertositeiisj,0,otherwise,∀i,j∈N,necessary to determine the allocation of sites to their second closest centers.Then the formulation we propose is(9)(P2A)minzs.t.∑j∈Nxjj=p(10)∑j∈Nxij=1∀i∈N,(11)∑j∈Nj≠iwij=1∀i∈N,(12)xij+wij≤xjj∀i,j∈N,(13)∑ℓ∈Ndiℓ≤dijxjℓ+∑ℓ∈Ndiℓ>dijxiℓ≤1∀i,j∈N,(14)xjj+∑ℓ∈Ndiℓ>dijwiℓ≤1+xij∀i,j∈N:i≠j,(15)∑ℓ∈Nℓ≠jhℓxℓj+∑ℓ∈Ndℓi<dℓjhℓ(wℓj+xii−1)≤(bj−hj)xjj∀i,j∈N:i≠j,(16)z≥∑ℓ∈Ndiℓwiℓ∀i∈N,xij,wij∈{0,1}∀i,j∈N.The goal is to minimize the maximum of the distances to the second center assigned to each site, given in constraints (16). Constraints (9)–(12) resemble the classical constraints in discrete location problems. In our formulation they ensure allocation of a site to two different centers and fix the number of centers at p. Due to the capacity constraints we need to add closest assignment constraints (CAC) to the formulation (a recent and complete study of CAC can be consulted in Espejo, Marín, and Rodríguez-Chía, 2012). Constraints (13) improve on those proposed in Wagner and Falkson (1975), and force a variable xijto take value one if j is the closest center with respect to site i.Similar constraints are needed to force allocation (by means of w-variables) to the second closest center. To this end, constraints (14) act as follows. In the casesxjj=0andxjj=xij=1,(14) reduces to a trivial constraint due to (11). The case of interest isxjj=1andxij=0,i.e., j is a center but i is not allocated to j. Then, due to (13), there must exist a center closer to i than j, and (14) reads∑ℓ∈Ndiℓ>dijwiℓ≤0⇒wiℓ=0∀ℓ∈N:diℓ>dij. The effect is that i is not allocated to a second closest center further than j. A version of (14) has been also developed in Lei (2010), see also Lei and Church (2011).Constraints (15) are the capacity constraints. Ifxjj=0,it followsxℓj=wℓj=0∀ℓ ∈ N and then∑ℓ∈Ndℓi<dℓjhℓ(xii−1)≤0,which holds trivially. Ifxjj=1,bjbounds the sum of ∑ℓ ∈ Nhℓxℓjand∑ℓ∈Ndℓi<dℓjhℓ(wℓj+xii−1). The first addend measures the demand of sites which have j as the closest center. The second addend, for a given value of i, is only of interest ifxii=1(otherwise it is non-positive), in which case it counts the demand of the sites with j as the second closest center which are closer to i than to j. That is to say, the second addend measures the demand which will go to j if center i fails.All variables must be constrained to be 0–1 valued due to the capacity constraints (unsplittable demand). Note that takingi=jin (12) it follows thatwjj=0∀j ∈ N. Throughout the rest of the paper, we will use these identities when required.In order to show the need for several families of constraints in formulation (P2A) we consider again the instance given in Example 2.1. After removing constraints (13), the solution is depicted in Fig. 3. Note that, in order to reduce the objective value, allocation is made first to centers which are further than the closest center with respect to a given site; for instance, site 1 is allocated to 5 instead of 6. After removing, instead, constraints (14), the obtained solution is depicted in Fig. 4. Here, for instance, site 3 is not allocated to its second closest center. The reason is to exploit the capacity of further centers in order to reduce the objective value. After removing constraints (12), all points would be allocated to themselves by means of w-variables, with an objective value equal to zero. It is clear that constraints (9)–(11), (15) and (16) are necessary.Analogously to (P3), several variables can be fixed at zero in (P2A). Sorting the distances from a fixed site i to the rest of the sites byd1i≤d2i≤⋯≤dni,since there are p centers, i will never be assigned to thep−1furthest sites. Thenxij=0∀i,j∈N:dij>dn−p+1i.Analogously, the second closest center w.r.t. i will never be one of thep−2furthest sites andwij=0∀i,j∈N:dij>dn−p+2i.Also, since i is always the unique closest site with respect to itself,wii=0∀i∈N.It is observed in formulation (P2A) that the x-variables play a secondary role. It is possible, with a complete knowledge of xjj∀j ∈ N plus the w-variables, to build capacity constraints and CAC, thus reducing the size of the formulation. The result of this reduction is called formulation (P2B). Whether this change entails a quality reduction of the formulation and, in such a case, if the size reduction makes up for it, will be a matter of forthcoming sections. Formulation (P2B) is as follows:(17)(P2B)minzs.t.(9),(11),(16)wij≤xjj∀i,j∈N,(18)∑ℓ∈Ndiℓ>dij2wiℓ+∑ℓ∈Ndiℓ≤dijxℓℓ≥2∀i,j∈N:i≠j,(19)∑ℓ∈Ndiℓ≥dij(p−1)wiℓ≤∑ℓ∈Ndiℓ≥dijxℓℓ∀i,j∈N:i≠j,(20)∑ℓ∈N∑q∈Ndℓj<dℓqhℓ(wℓq+xjj−1)+∑ℓ∈Ndℓi<dℓjhℓ(wℓj+xii−1)≤bjxjj∀i,j∈N:i≠j,(21)xjj∈{0,1}∀j∈N,wij∈{0,1}∀i,j∈N.Given two different sites i and j, the corresponding constraint (18) is trivially satisfied when∑ℓ∈Ndiℓ≤dijxℓℓ≥2,i.e., when there are two or more centers inside a radius dijaround i. Otherwise, if∑ℓ∈Ndiℓ≤dijxℓℓ∈{0,1},constraint (18) forces some of the variables in the first term to take value 1, that is to say, it forces the distance in the objective function to be greater than dij.To complement (18), and due to the capacity limitations, it is necessary to add some other constraints preventing i for being allocated to a center further than the second closest center. Constraints (19) have this effect. The trivial case is∑ℓ∈Ndiℓ≥dijwiℓ=0. Otherwise, if∑ℓ∈Ndiℓ≥dijwiℓ=1,it means that the reference center of i is not inside radius dij. Since the total number of center is p, this would only occur when the number of centers at least at a distance dij, given by the second term of (19), isp−1.The combination of constraints (18) and (19) produces the desired allocation to the second closest center. Similar constraints were used in (Belotti, Labbé, Maffioli, & Ndiaye, 2007) in the context of obnoxious location.In order to establish the limit on the capacity of the centers using this reduced set of variables, constraints (20) are incorporated into the formulation. Each constraint in this family takes care of the capacity of center j if center i fails. The first case is whenxjj=0,i.e., j is not going to be a center. In such a case, the addends of the first term will bewℓq−1,which are less than or equal to 0, and the addend of the second term will again bexii−1less than or equal to 0, and the constraint is trivially satisfied. The interesting case is thenxjj=1. Replacing xjjby 1 in the first term, it becomes∑ℓ∈N∑q∈Ndℓj<dℓqhℓwℓq. Since j is now a center, a variablewℓq=1when q is outside a radius dℓjaround a site ℓ means that j must be the closest center with respect to ℓ. Then the first term sums up the demand of the sites with j as the closest center, to be taken always into account when limiting the capacity of j. But the capacity of j must also be enough to cover the demand of some sites after the failure of another center, represented in (20) by i. When i is actually a center, variable xiiwill take value 1 (otherwise the second term will be negative). Note that the second term only considers those sites ℓ closer to i than to j, and variables wℓjtaking value 1. The combination of both situations implies that, in case of failure of i, the demand of ℓ will be satisfied by j, and this demand given by the second term must be added to that of the first term to be bounded by bj.Although we have introduced (P2B) with all constraints that can be considered intuitively necessary, not all of them are needed to obtain a correct formulation, as we show in the following result.Proposition 3.1Constraints (17) are implied by constraints (9), (11), (18), (19) and (21).Assume that, for i ∈ N and j ∈ N∖{i},wij=1holds.Replacing wijby 1 in (11) and using (21) it follows thatwiℓ=0∀ℓ such that diℓ > dij. Now, replacing these values in (18),∑ℓ∈Ndiℓ≤dijxℓℓ≥2.Taking (9) into consideration, the last inequality is equivalent to(22)∑ℓ∈Ndiℓ>dijxℓℓ≤p−2.On the other hand, replacing wijby 1 in (19) and using (11) again, it follows thatp−1≤∑ℓ∈Ndiℓ≥dijxℓℓwhich, by the assumption of no ties in the distances from the same point, can be re-written as(23)p−1≤xjj+∑ℓ∈Ndiℓ>dijxℓℓ.Finally, bringing together (22) and (23),p−1≤xjj+∑ℓ∈Ndiℓ>dijxℓℓ≤xjj+p−2,and xjj≥ 1 trivially holds.□The remaining constraints are not implied by the others. Consider the instance given in Example 2.1. After removing constraints (18), the solution obtained is depicted in Fig. 5. Notice that, in order to reduce the objective value, second allocation is made to centers which are closest with respect to a given site. For instance, site 7 is allocated to center 3. Removing families of constraints (19), we obtain solutions with wrong allocations. To show this, considern=4,p=3,distance ℓ1, points in coordinates (2, 9), (1, 1), (7, 6), (10, 7), demands 2, 2, 1, 1 and capacities 8, 6, 6, 7. The solution has opened centers 1, 2 and 3 andw12=w21=w31=w41=1,where we can see that site 1 is not allocated to its second closest center, site 3 (see Fig. 6).Several variables can be fixed at zero in (P2B). The second closest center w.r.t. i will never be one of thep−2furthest sites nor the closest one (itself), thenwij=0,∀i,j∈N:dij>dn−p+2i,wii=0,∀i∈N.Formulations (P2A) and (P2B) are both of interest from a theoretical point of view due to the following result.Proposition 3.2The linear relaxations of (P3), (P2A) and (P2B) do not dominate one another.To prove the thesis it suffices to show two examples of instances in which the linear relaxation of each formulation gives a larger value than the linear relaxation of the other. For both examples we take a set of six points in the plane,p=3and the ℓ1 norm is used to compute distances between points.In the first example, the points are (1, 8), (5, 0), (9, 9), (5, 2), (6, 2) and (4, 9), with demands 3, 2, 3, 3, 2, 5 and capacities 16, 3, 11, 14, 4, 15 respectively. Centers in the optimal solution are 3, 4 and 6. The two closest centers with respect to each site are (6, 3), (4, 6), (3, 6), (4, 6), (4, 6) and (6, 3), respectively. The optimal value is 10 (distance from 2 to 6, see Fig. 7, left hand side). The optimal values of the linear relaxation of (P3), (P2A) and (P2B) are 8, 6.04 and 5.77, respectively.In the second example, the points are (6, 4), (0, 9), (1, 6), (4, 0), (4, 4) and (1, 7), with demands 3, 1, 2, 3, 2, 2 and capacities 11, 3, 13, 15, 14, 5 respectively. Centers in the optimal solution are 1, 5 and 6. The two closest centers with respect to each site are (1, 5), (6, 5), (6, 5), (5, 1), (5, 1) and (6, 5), respectively. The optimal value is 9 (distance from 2 to 5, see Fig. 7, right hand side). The optimal values of the linear relaxation of (P3), (P2A) and (P2B) are 4, 4.59 and 5, respectively.□The goal of this section is twofold. On the one hand, to provide the readers a better understanding of the model considering a comparison between the solutions of CpCP and CSpCP which highlights that there are significant benefits in using the proposed model in case of disruption. On the other hand, to compare the three proposed formulations for CSpCP in order to identify which of them is more promising from the computational point of view.It could be argued that the prevention of a disaster that rarely occurs will imply a change in the solution to the problem that leads to some sites being allocated to centers further than the reference centers they would have in the solution of CpCP in order to guarantee sufficient capacity. But this argument would rapidly lead to the invalidation of all kinds of p-center problems, which are based on the improvement of the worst case situation at the expense of making the average situation worse than in the median models. In contrast, when the decision maker decides to use the solution to the CpCP instead of its counterpart with median objective, the idea is to provide an opportunity to everybody (in particular to the furthest one, although it could be a rare case) to reach an emergency center when it is needed. Model CSpCP is nothing but the widening of this humanitarian point of view to the case of disruption.In order to highlight the strengths of taking into account the failure possibility, in the following we provide a comparison of the optimal solutions obtained for a set of instances by using both CSpCP and CpCP with closest assignment (i.e., when sites are served by their closest centers). Besides the optimal values of both problems, we have computed some illustrative measures of goodness of these solutions as follows. In the case of CSpCP, we compute the maximum distance between each site and its closest center, that is to say, the objective value that the optimal solution of CSpCP gives in the CpCP model. In the case of the optimal solution to CpCP, we consider the failure of one of the centers and distinguish between the cases (i) where each site previously allocated to the center that failed is allocated to its second closest center and (ii) it is allocated to any center with enough capacity (this is done by solving an assignment problem between these sites and the remaining centers taking into account the available capacity of these centers). The maximum distance from every site to its corresponding new center is then calculated.We start with an example which shows how inadequate it may be to simply solve CpCP and then re-assign sites when the failure of one of the centers occurs. It is worth mentioning that when an emergency situation occurs, injured people, following a natural and intuitive pattern, try to go to the second closest center, since in this type of situations it is implausible that the information as to which center has enough capacity to cover their demands is available.Example 4.1We are given eight points in the plane with coordinates (0.6, 2.3), (4.4, 4.6), (6.3, 3.7), (2.7, 9.1), (7.0, 8.3), (3.7, 6.8), (5.9, 3.9) and (6.9, 6.5), demands 5, 2, 2, 4, 1, 5, 4 and 4 and capacities 6, 7, 13, 11, 15, 13, 25 and 25, respectively. Taking ℓ1 to measure the distances andp=3,the optimal solution to CSpCP is depicted at the left hand side of Fig. 8. The free capacity in each center is indicated between brackets. The closest center to a non-center point is indicated by a segment. The optimal value (the furthest second closest center with respect to a point in the case of failure) is depicted with a dashed line between site 4 and center 7.Consider now the possibility of using the optimal solution to CpCP and re-assigning sites in case of failure of some of the centers. The optimal solution to CpCP is depicted at the right hand side of the figure. Now, after a disaster center 1 fails, and the demand of 1 must be allocated to another center with enough free capacity, the only feasible solution is to choose center 8, which is not the second closest center with respect to 1. The situation is still worse if the disaster affects 8, since the free capacity of the remaining centers is not enough to satisfy the demand of sites originally allocated to the unavailable center.Observing the left hand side of Fig. 8, the reader can realize that the optimal solution of CSpSp requires the system to have a spare capacity of 29 to accommodate the customers reallocation in case of failure. Although the fact that a real system can afford more than 100 percent extra capacity to deal with potential disruptions which in general are rare could be considered as excessive, this extra capacity does not necessarily have to be too expensive. Nowadays, some hospitals have operating rooms or even corridors (areas of rooms for the patients) that usually are closed and then opened when there is an increase of the demand (epidemics, accidents, etc.). Therefore, the hospital only has to cover the expenses of keeping them in good shape to be used in case of necessity. In the following we give some alternative types of centers where including extra capacity does not necessarily imply significant additional costs:1.The governments have some centers to store oil to address stockouts or to fight against the price fluctuations of the oil. These centers could be used to cover the regular demand of a region (gas stations, airports, etc.), but in addition have an extra capacity to cover the aforementioned special situations.Centers of staple products, blankets, tents, machines to get potable water, non perishable food, snowplows etc. that are used to cover small incidents (like storms) can have an extra capacity to replace the damaged material of other center in case of a bigger disaster (like an earthquake or a hurricane).A reservoir to store water for consumption to cover the demand of a region could also be used to cover the demand of additional cities if, suddenly, they have supply problems by an unexpected reason like contamination of the water in the reservoir that initially cover those cities.Summarizing, our model could become a useful tool for the decision-maker or system-planner to evaluate whether it is recommendable to establish a strategy to prevent possible incidents in one of the centers or on the contrary, it is not feasible from a financial point of view. Therefore, this model provides the decision-maker with a quantitative rule to select the best option relative to foresee emergency situations.Table 1 reports the results of the comparison between CpCP and CSpCP for a set of instances. Columns “OV” give the corresponding optimal values. Given the optimal solution of CpCP, column “OV_F” provides the maximum distance from each site to their second closest center. The number in brackets shows the number of times in which it is not possible to re-assign sites to their second closest centers (because they do not have enough capacity) when one of the centers in the optimal solution to CpCP fails. Column “F_N2C” provides the maximum distance from sites to a center with enough capacity (not necessarily the second closest one) when the closest one fails. Column “Pos” reports the position of “F_N2C” in the ordered sequence of distances between the site for which the maximum distance is achieved and the centers, whereas “WPos” gives the worst position of the distance between each site and the center that would cover this site if its closest one were to fail in the ordered sequence of distances between this site and the centers. Column “OV_NF” reports the maximum distance between the sites and their closest center for the optimal solution of CSpCP (when no center fails).Column Imp_F givesF_N2C−CSpCP_OVF_N2C×100,i.e., the improvement percentage, with respect to the maximum distance from each client to its center if one of these centers fails, by considering the optimal solution of CSpCP (values in column CSpCP_OV) instead of the optimal solution of CpCP (values in column F_N2C; observe that in this case is not a fair comparison because we have not assumed the closest assignment, otherwise in all the cases except the last one this solution would not be feasible). Conversely, column Wors_F reports the worsening percentage, with respect to the maximum distance from each client to its center if one of these centers fails, by considering the optimal solution of CpCP instead of the optimal solution of CSpCP, i.e.,CSpCP_OV−F_N2CCSpCP_OV×100.Analogously, column Imp_NF givesCSpCP_OV_NF−CpCP_OVCSpCP_OV_NF×100,i.e., the improvement percentage, with respect to the maximum distance from each client to its closest center, by considering the optimal solution of CpCP (values in column CpCP_OV) instead of the optimal solution of CSpCP (values in column CSpCP_OV_NF). Conversely, column Wors_NF reports the worsening percentage, with respect to the maximum distance from each client to its closest center, by considering the optimal solution of CSpCP instead of the optimal solution of CpCP, i.e.,CpCP_OV−CSpCP_OV_NFCpCP_OV×100.The instances considered in the comparison are L & S (n=90,p=10,where the 10 sites with the largest demand have been removed, see Lorena and Senne, 2004), Orlib_50 (n=50,p=5,with all capacities equal to 150, see Osman and Christofides, 1994), Orlib_50b(this instance is Orlib_50 where one of its points has been removed, i.e.,n=49,p=5) and Orlib_80 (n=80,p=10where the 10 sites with the largest demand have been removed, see Osman and Christofides, 1994) and some instances with points randomly generated in the plane (using ℓ1 to measure the distances); demands and capacities are randomly generated asU{6,…,15}and[n/p][(h1+maxihi)/2]+[U(0,10·type)],respectively, withtype=5,10: 45_5 (n=45,p=5,type=5), 45_10 (n=45,p=5,type=10), 75_5 (n=75,p=5,type=5), 75_10 (n=75,p=5,type=10), 100_5 (n=100,p=7,type=5) and 100_10 (n=100,p=7,type=10).The difference between n_5 and n_10 is simply how the capacity of the centers (type 5 or 10) is generated. It can be observed in column OV_F of CpCP that all the instances except the last one are infeasible when sites are assigned to their second closest center if the closest one fails). Columns Pos and WPos show that there are sites that should be allocated to centers sorted between the third and the fifth positions.From column Imp_F we see the clear advantage of considering the failure foresight which provides a significant improvement (25 percent on average) of the objective value with respect to the CpCP when a center fails.Although the comparison between the solutions of CpCP and CSpCP highlights that there are significant benefits in using the proposed model in case of disruption, sometimes this comes at the cost of a deterioration of the objective if failure does not occur. This could be measured by comparing columns Imp_F and Wors_NF, but it is worth mentioning that this is not completely fair, since closest assignment in case of failure was not assumed to obtain the values in column F_N2C (otherwise, this solution would not be feasible). Ignoring this point, we can see that the improvement percentages in case of disruption (Imp_F) are smaller than the worsening percentages (Wors_NF) in the first five problems and the seventh one, but quite the opposite in the other cases. Therefore, depending on the cases, the difference of the maximum distance from the clients to their centers for the optimal solution of CpCP and CSpCP when a disruption occurs could be bigger or smaller than the difference of these values when no disruption occurs. Just taking into account these percentages, the prevention against failure of some of the centers might not be advisable in the first five examples and the seventh one. However, in the other cases, to foresee the failure of one center is highly recommendable.An extreme case of the above comparison could be the second instance in Table 1, Orlib_50. In this case, the largest site-center distance drops from 675 to 593 when using our model as compared to a standard p-center model, i.e., an improvement of 12.1 percent (see column Imp_F). However, the maximum distance in normal conditions increases from 59.44 to 571.22, i.e., a worsening of 861 percent (see column Wors_NF). A deeper analysis of this data set allows us to recognize that there is an isolated point, a, which is quite far away from the remaining points. Indeed, the coordinates of this point area=(70,719)and the 49 remaining points are in the rectangle [4, 100] × [4, 234]. The optimal solution of the CpCP contains a as a center; for this reason the optimal objective value of this problem is relatively small (59.44). However, if we consider the possibility that a center fails, due to the particular configuration of this example, the maximum distance from a center to its closest available center will increase extremely (we can see that this maximum distance for the optimal solution of CpCP increases to 675, even assuming that the sites are not assigned to the closest available center because otherwise this solution would not be feasible). Therefore, the reason for these large differences of percentages in the improvement and worsening of the objective is due to the particular configuration of this problem. Indeed, we have solved the same instance deleting this isolated point, Orlib_50b, and the results are more reasonable, see the third row of Table 1.In addition, from the comparison of columns Imp_NF and Wors_F, we can see that in the first three problems, the improvement percentage (considering the optimal solution of CpCP instead of the one of CSpCP when no disruptions occurs) is bigger than the worsening percentage (considering the optimal solution of CpCP instead of the one of CSpCP when a failure occurs). However, the behavior is quite the opposite in the remaining cases.In conclusion, taking into account both comparisons of these percentages, it seems to be recommendable not to prevent the failure of one of the centers for the first three problems. On the other hand, it is highly recommendable to foresee it in the last five problems except the seventh one. For the fourth, fifth and seventh problems, depending on the utility function of the decision-maker for the differences of these percentages, it may be advisable one or the other choice. Moreover, from the comparison we can conclude that considering the possibility of failure in this kind of model may result in a significant improvement with respect to not considering it. In particular, if failure foresight is not considered, after a disruption in a center, sites may not be allocated to their closest centers (with a high social and political cost, in the case of emergency centers after a natural disaster) resulting in a hardly implementable solution (in an emergency situation, people demanding attention would not know which center would be available to attend them). Moreover, from all these reflexions, we can conclude that independently on whether or not the solution of the CSpCP is implemented by the system-planner/decision-maker, it is indubitable that this model provides an objective and quantitative rule to support his/her decision.Table 2gives a comparison of the number of binary variables and constraints of the three previous formulations. We can observe that formulation (P2B) is the one with the lowest number of variables and constraints while (P3) has the highest number. Note that, in what follows, all possibilities of fixing variables at zero in all formulations have been carried out.Before trying to improve the performance of the previously studied formulations, we will compare them by means of a simple computational study. The formulations were implemented, as they have been presented in the previous sections, in the commercial solver Xpress IVE 1.22, running on a 3.40 gigahertz PC with 16 gigabytes of RAM memory. The cut generation option of Xpress was disabled in order to compare the relative performance of the formulations cleanly.In order to produce a set of test instances, we generated random points in the plane. Demands and capacities were randomly generated asU{6,…,15}and[n/p][(h1+maxihi)/2]+[U(0,10·type)],respectively, wheretype=3,4,5,10. The distance considered was ℓ1. We compared the three formulations on a testbed of five instances for each combination of (i) type of capacity, (ii) n in {15, 20, 25, 30, 35, 40, 45} and (iii) different values of p in {3, 5, 8, 10}.Tables 3and 4report the results of formulations (P3), (P2A) and (P2B). For each size n ∈ {15, 20, 25, 30, 35, 40, 45}, the first column of these tables stands for the different values of p and the second for each one of these three formulations. The remaining columns are grouped in five blocks of four columns. The first four blocks provide the results for the different types of capacity generated (3, 4, 5 and 10) and the last one for the averaged results of these four blocks. In each block, the column u provides the number of unfeasible instances, t gives the average time in seconds of the overall solution process, gap reports the average gap in the root node, and nod represents the average number of thousands of nodes (the above averages refer to the five instances analyzed). The number of instances that exceed the time limit (two hours of CPU) is indicated with a superscript and the averaged times in these cases were calculated by fixing the times of these instances to 7200. As expected because of a lower overall capacity, almost all the instances of type 3, 4 and 5 forp=3were unfeasible. The symbol “-” in the tables represents that either all the instances are unfeasible or, if some of them are feasible, all these instances need more than two hours of CPU to be solved.In Tables 3 and 4, we can observe that the running times of formulation (P2A) are much shorter than those of formulation (P2B) and the times of formulation (P2B) are much shorter than the ones of (P3). Actually, the running times of formulation (P3) exceed the time limit for some instances of size greater than or equal to 25 and for almost all instances of size greater than or equal to 35. Regarding the influence of the capacity on the running times, as a general trend the running times for the instances withtype=10are smaller than the running times of the rest of the values of type, in the cases of small and medium values of p. On the other hand, for large values of p the running times among the instances with different types of capacities are quite similar.Concerning the gaps of these three different formulations, we can see that the average gaps for (P3) (in the cases where all the instances are solved before reaching the time limit) are greater than those of (P2A). Moreover, the gaps provided by formulation (P2A) are always greater than those provided by (P2B). In addition, the average gaps for each of these formulations over the instances with different types of capacities are almost identical.Observe that, although the gaps of formulation (P2A) are worse than those of (P2B), its running times are smaller. A possible explanation of this is given by column nod which shows that the number of nodes checked by (P2A), in most of the instances, is much lower than those of (P2B) and (P3).In this section we develop a heuristic algorithm to address the problem under consideration. The main idea of this procedure is to generate new solutions iteratively through local movements. Depending on whether the current solution is feasible or not, we make an improvement movement or a feasibility movement, respectively. This means that we move from a current solution to another one in its neighborhood, in such a way that, hopefully, it will have a lower objective value when the current solution is feasible, or it could, otherwise, be feasible. The detailed pseudo-code is depicted in Algorithm 1.In the improvement movement, given a current feasible solution with open centersCS={j1,…,jp}and objective value f(CS), we choose jmin  ∈ CS and imin  ∈ N such thatd(imin,jmin)=f(CS). Then, we look forjmin′,the closest node to jmin  such that (i)jmin′∉CS,and (ii)d(imin,jmin′)<d(imin,jmin). SetCS′=(CS∖{jmin})∪{jmin′}. Hopefully, this movement would decrease the current objective value whenever this solution was feasible and would not imply an excessive increase in remaining distances between sites and their corresponding second closest centers.In the feasibility movement, given a current solution, for instance(x^,w^)for (P2A), with open centersCS={j1,…,jp},we choose jmin  ∈ CS maximizing the gap of the capacity constraints, i.e.jmin:=argmaxj∈N(maxs∈Njs≠j∑ℓ∈Ndℓjs<dℓjhℓ(w^ℓj+x^jsjs−1)+∑ℓ∈Nℓ≠jhℓx^ℓj−bjx^jj).Then we look forjmin′,the closest node to jmin  such that (i)jmin′∉CS,and (ii)bjmin′>bjmin,i.e., the closest node with larger capacity. SetCS′=(CS∖{jmin})∪{jmin′}. Hopefully this movement would have generated a new solution where the maximum gap of the capacity constraints have decreased and it could be feasible if this gap is less than or equal to 0 for each pair of centers.If one of the previous movements is not possible, we randomly choose the new place to locate a centerjmin′. Whenever these local movements cannot generate a new solution which has not been generated previously, a completely new random solution is generated.We checked the heuristic on the same testbed as the initial computational study. The algorithm needs around 8, 25, 59 and 125 seconds for sizes 45, 75, 100 and 125, respectively, to carry out 1000 iterations. Fig. 9illustrates the efficiency of this heuristic approach. The three graphs on the left report the instances which are optimality solved (gap=0) and the numbers at the top of the bars providing the percentage of instances where the heuristic does not solve optimally the problem (gap > 0) report the average gap. The three on the right part show the iteration where the heuristic algorithm reaches the best solution (using a limit of 5000 iterations). In both cases, the graphics represent the percentage of instances as a function of n (top), types of capacity (center) and p (bottom), respectively. In the first case, we can see that the percentage of instances solved optimally decreases when n increases. However, the types of capacity and p do not have a large influence. In the right part, we can observe that the percentage of instances that find the best result before the first 100 iterations is quite high, especially for small values of n. Again, we can see that this behavior is quite similar for different types of capacity and p. Therefore, we can conclude that the most influential aspect in the results of the algorithm is the size of the instances analyzed.This section is devoted to improving the preliminary computational results obtained in Section 4.2. Since (P3) is not a very efficient formulation from the computational time point of view, we concentrate on improving the performance of formulations (P2A) and (P2B). Different techniques were studied but we only show those which provide the best running times. After these improvements, we will see that formulation (P2A) again reports the best computational times.In order to solve our problem using (P2A), we tested several families of valid inequalities and a variable fixing strategy based on the best value found by the heuristic given in Section 5. This will be a successful approach which, for most of the instances, will significantly reduce the computational times given in Tables 3 and 4.The first sets of valid inequalities that we try to use to reinforce formulation (P2A) are those coming from formulation (P2B), i.e., (18)–(20). Our first result shows that (20) will not improve formulation (P2A).Proposition 6.1Constraints (20) are implied by constraints xjj≤ 1 ∀j ∈ N, (14) and (15).We consider two cases for j, ℓ ∈ N. First, we assume that there exists q ∈ N such that dℓq> dℓj. In such a case, fromxjj−1≤0∀j ∈ N it follows that∑q∈Ndℓj<dℓq(xjj−1)≤xjj−1⇒1+xℓj−xjj+∑q∈Ndℓj<dℓq(xjj−1)≤xℓj.Now from (14)∑q∈Ndℓj<dℓqwℓq+∑q∈Ndℓj<dℓq(xjj−1)≤xℓj.This inequality trivially holds in the second case, i.e., dℓq≤ dℓj, ∀q ∈ N. Thus, for all j, ℓ ∈ N it holds that∑q∈Ndℓj<dℓq(wℓq+xjj−1)≤xℓj.For a given j ∈ N we can linearly combine these inequalities with non negative weights hℓ to obtain∑ℓ∈N∑q∈Ndℓj<dℓqhℓ(wℓq+xjj−1)≤∑ℓ∈Nhℓxℓj≤[from (15)]hjxjj−∑ℓ∈Ndℓi<dℓjhℓ(wℓj+xii−1)+(bj−hj)xjj=−∑ℓ∈Ndℓi<dℓjhℓ(wℓj+xii−1)+bjxjj.The inequality between the first and last terms matches (20).□Consequently, among the constraints of (P2B) we will only consider (18) and (19) as valid inequalities for (P2A). Additionally, we will incorporate the following two families of inequalities:(24)∑ℓ∈Ndiℓ>dijxiℓ+∑ℓ∈Ndiℓ≤dijwiℓ≤1∀i,j∈N,(25)z≥∑ℓ∈Nℓ≠id^iℓxiℓ+d^jixji+djiwji∀i,j∈N.Hered^iℓ:=minj∈N{dij:dij>diℓ},i.e.,d^iℓis the distance immediately larger than diℓ from site i to another site.Constraints (24) act as follows. If∑ℓ∈Ndiℓ>dijxiℓ=1,it means that i is allocated to a closest center further than j. Thus, the second closest center of i is further than j, or equivalently,wiℓ=0∀ℓ∈N:diℓ≤dij. If∑ℓ∈Ndiℓ≤dijwiℓ=1it means that i is allocated to a second closest center no further than j; then, i is not allocated to a center further than j, or equivalently,xiℓ=0∀ℓ∈N:diℓ>dij.The meaning of inequalities (25) is the following. Ifxji=1,thenxiℓ=0,∀ℓ ≠ i andwji=0,∀j ∈ N. Thus, the second closest center from site j is at leastd^ji. Ifwji=1thenxji=0andxiℓ=0,∀ℓ ≠ i. Thus, the objective function is at least dji. Ifxiℓ=1for some ℓ( ≠ i) ∈ N thenxji=wji=0. Moreover, the second closest center from site i is at leastd^iℓ.In what follows we see that valid inequalities (24) are stronger than valid inequalities (18) when we consider them to enforce formulation (P2A).Proposition 6.2Constraints (18) are implied by (11), (12) and (24).Using (11) and taking into account thatwjj=0∀j ∈ N, constraints (24) can be rewritten as:∑ℓ∈Ndiℓ>dijwiℓ+∑ℓ∈Ndiℓ≤dijxiℓ≥1.Hence, applying (12) we obtain∑ℓ∈Ndiℓ>dijwiℓ+∑ℓ∈Ndiℓ≤dij(xℓℓ−wiℓ)≥1,and this is equivalent to (18)□Let then (P2AI) be the formulation resulting from adding constraints (19), (24) and (25) to (P2A). We see now that all these constraints make a contribution to the lower bound given by the linear relaxation of (P2AI).Proposition 6.3None of the sets of constraints(13)–(15),(19),(24)and(25)are implied by other constraints in Formulation (P2AI).To prove the thesis it suffices to show an instance in which the linear relaxation gives a larger value without any one of the sets of constraints (13)–(15), (19), (24) and (25) than the linear relaxation of the whole set. We take a set of seven points in the plane,p=3and the ℓ1 norm is used to compute distances between points. The points are (0, 1), (3, 5), (5, 7), (4, 9), (10, 6), (1, 1), (10, 7) with demands 3, 3, 2, 3, 0, 3, 2 and capacities 9, 1, 6, 1, 9, 2, 9, respectively.Centers in the optimal solution are 1, 5 and 7. The two closest centers with respect to each site are (1, 5), (1, 5), (7, 5), (7, 5), (5, 7), (1, 5), (7, 5), respectively. The optimal value is 15 (distance from 1 to 5, see Fig. 10), and the linear relaxation of (P2AI) takes value 7.648. The optimal values of the linear relaxations of (P2AI) when relaxing (13),–(15), (19), (24) and (25) are 7.217, 7.63, 6.604, 7.618, 7.39 and 7.026, respectively.□In order to fix wij-variables we will take advantage of our heuristic approach presented in Section 5. Indeed, since this approach gave very good computational times either to solve the problem or to provide good solutions, in this section we will use it to obtain feasible solution and consequently, the upper bounds on the optimal value of our problem. Hence, it allows us to fix wij-variables as follows. Ifvoh*is the best objective value obtained by the heuristic approach, we can fix at 0 wij-variables and xij-variables such thatdij>voh*. In addition to this preprocessing phase, in the methodology that we have developed, every time that a feasible solution is found in the branching tree, we have again applied a process of fixing variables, such that if this feasible solution provides a better objective value than those obtained so far, we can fix at 0 all the wij- and xij-variables such that dijare greater than this objective value. Thus, the dimension of the problem decreases iteratively and, consequently, the process is sped up.Table 5reports the results of the methodology described above when some of the families, subfamilies or combinations of valid inequalities (19), (24) and (25) are added to formulation (P2A). We have attempted cut-and-branch and branch-and-cut methods with all the inequalities. Only the families of constraints which provided the best results are shown. We have fixed the parameter in the Heuristic atit=1000and since the different ways of generating the capacity do not make a significant influence in the running times, as shown in Tables 3 and 4 and Fig. 9, in this table we only consider the type of capacity 5. For each size n ∈ {45, 75, 100, 110, 125}, the first column of these tables stands for the different values of p. Thus, nine blocks of two columns provide the average times and the gaps of the five instances solved by adding a family of valid inequalities to formulation (P2A). Namely, block OUR reports the results of solving our problem with formulation (P2A) using the above methodology without adding an additional family of valid inequalities and blocks “19”, “24” and “25” mean that inequalities (19), (24) and (25) are added, respectively. On the other hand, blocks “19ij”, “24ij” and “25ij” report the results of solving formulation (P2A) using a Cut & Branch procedure including the most violated constraint of families (19), (24) and (25) for each i, j ∈ N, respectively. Finally, blocks “19ij& 24ij” and “19ij& 24ij& 25ij” report the results of the respective combinations of valid inequalities in a Cut & Branch procedure. The best running times have been boldfaced for each n and p. In the particular case of size 125, the number of instances where the CPU times exceeds two hours is indicated as superscripts. As a general rule, to compute the average times of the five instances analyzed for each n and p, we have taken 7200 seconds as the running times of those instances that exceed the time limit.In Table 5, we observe that the use of this methodology to solve our problem has reduced the computational times needed to solve the instances withn=45by more than two orders of magnitude and we have been able to solve all the checked instances of size lower than or equal to 110 in less than two hours. Moreover, none of the families of valid inequalities analyzed dominates the others. For small-sized problems, i.e.n=45and 75, “19ij&24ij&25ij” and “19ij&24ij” provide the best average computational times, respectively. However, for larger instances it seems that “24” and “24ij” present a better trend. We can observe that all the approaches provide similar gaps. Finally, in order to check the limit of our solution approach we have repeated this analysis, takingit=10,000and we have been able to solve the five instances tested for problems of size 170 in less than two hours.Following the same ideas developed for (P2A), we propose several improvements for (P2B). In this case, although the improvements in formulation (P2B) are worthwhile from a theoretical point of view, we have not reported the computational times because the results obtained with (P2A) are much better than those obtained using (P2B) (for instance, forn=100these improvements of (P2B) are not able to solve most of the instances studied in less than two hours, whereas with the ones in (P2A) we were able to solve these problems in approximately 12 minutes).We have studied different families of valid inequalities as follows.1.Consider i, a, t ∈ N(i ≠ a, t) such that (i) dit< diaand (ii) dtr≥ max {dti, dta} for all r ∈ N such that dir> dia. We have the following two sets of constraints(26)wia+xii−1≤wta,ifdti<dtawia+xii−1≤wti,ifdti≥dta.Constraints (26) have an effect only ifxii=wia=1. In this case, the closest center to site i is itself and the second closest one is a; this means thatxjj=0for any j ≠ i such that dij< dia. Thus,xtt=0. Moreover, since dtr> max {dti, dta}, for all r ∈ N such that dir> diathe closest and second closest centers of site t will be, respectively, (i) i and a if dti< dtaand (ii) a and i if dti≥ dta. Therefore, in the first case we will have thatwta=1and in the second case thatwti=1.Following the same arguments, we can reinforce the second family of valid inequalities of (26) as follows:(27)∑a∈N:dti≥dtadit<diadtr≥max{dti,dta},∀r:dir>diawia+xii−1≤wti,∀t,i.Constraints (26) have been obtained for any i, a, t ∈ N with i ≠ a, t and dit< dia. Now, following similar arguments, we extend these constraints to the case where dit≥ dia. Consider i, a, t ∈ N with i ≠ a such that (i) dit≥ diaand (ii) dtr≥ max {dti, dta} for all r ∈ N such that dir> dia. We have the following set of constraints:(28)wia+xii−1≤wta+wti.The last set of constraints of this family is(29)xii+wia−1≤wai+∑k∈Ndak<dai,dik>diaxkk∀i,a∈N.Constraints (29) act as follows. Ifxii=wia=1,this means that∑dij<diaxjj=xii=1. Then, the second closest center to a should be either i or a center such that the distance from i is larger than dia. In the latter case, a should be closer to that center than i.

@&#CONCLUSIONS@&#
Emergency services are vulnerable to disruptions caused by large natural disasters, terrorist attacks or sabotage. The consequences of a failure in this type of services are often disastrous despite their rare occurrence. For this reason, it is worth taking into account this aspect in the design phase for locating these types of facilities. Moreover, although most of the existing papers in the literature considering reliability issues in supply chain design have avoided the capacity constraints, because they increase the complexity of the models, in order to be more realistic it is relevant to consider these constraints also. Therefore, in this paper we have presented several linear integer formulations for the problem of locating emergency services with capacity constraints taking into account the possibility of a failure. Some have been improved by means of valid inequalities and preprocessing techniques for fixing variables. A heuristic has been developed which can also be used in the preprocessing phase of a methodology that we have provided to obtain an optimal solution. This latter approach provided the best results, reducing by more than two orders of magnitude the running times forn=45and allowing all the instances tested with n ≤ 110 to be solved in under two hours.