@&#MAIN-TITLE@&#
Variance reduction in large graph sampling

@&#HIGHLIGHTS@&#
We derive an upper bound for the variance of RE sampling.We show that variance of RN sampling grows with data size for scale-free networks.Thereby RE sampling excels when data size is large.We support the analytical results with simulation studies and 18 real networks.

@&#KEYPHRASES@&#
Uniform random sampling,Random walk,Graph sampling,Online social network,Scale-free network,Harmonic mean,

@&#ABSTRACT@&#
The norm of practice in estimating graph properties is to use uniform random node (RN) samples whenever possible. Many graphs are large and scale-free, inducing large degree variance and estimator variance. This paper shows that random edge (RE) sampling and the corresponding harmonic mean estimator for average degree can reduce the estimation variance significantly. First, we demonstrate that the degree variance, and consequently the variance of the RN estimator, can grow almost linearly with data size for typical scale-free graphs. Then we prove that the RE estimator has a variance bounded from above. Therefore, the variance ratio between RN and RE samplings can be very large for big data. The analytical result is supported by both simulation studies and 18 real networks. We observe that the variance reduction ratio can be more than a hundred for some real networks such as Twitter. Furthermore, we show that random walk (RW) sampling is always worse than RE sampling, and it can reduce the variance of RN method only when its performance is close to that of RE sampling.

@&#INTRODUCTION@&#
The data on the Web or online social networks can be often viewed as a graph. The graph in its entirety may not be available for various reasons. It can be distributed over many machines (e.g., the Web and P2P networks), hidden behind searchable interfaces (e.g., search engines and online social networks), scattered among a larger graph (e.g., various communities in online social networks). Regardless of the causes, a common challenge is to reveal the properties of such graphs when we do not own the entire data. In the past, extensive research was carried out to explore the profile of search engines (Lawrence & Giles, 1998) and other data collections (Broder, 2006; Callan & Connell, 2001; Si & Callan, 2003). Most of them focused on obtaining uniform random node (RN) samples, such as uniform random web pages from the Web (Henzinger, Heydon, Mitzenmacher, & Najork, 2000) and search engines (Bar-Yossef & Gurevich, 2008), and uniform random bloggers from online social networks (Gjoka, Kurant, Butts, & Markopoulou, 2009). Once uniform random samples are obtained, network properties, in particular the attributes of the nodes including average degree, could be estimated with statistical guarantee.In many cases, RN sampling works only in theory. The majority of real world networks are scale-free (Barabási & Albert, 1999), whose degree distributions follow a power law. Such scale-free networks often induce a large variance of the degrees. In theory, the variance does not exist when the exponent of the power law falls in certain range. In practice, the variance can be extremely high for very large networks. For instance, the coefficient of variation of the Twitter user network collected in 2009 (Kwak, Lee, Park, & Moon, 2010) is as high as 35.95. To understand the impact of such a high coefficient of variation, let us have a quick calculation for the sample size needed to reach 20% accuracy for its average degree 70.51. More precisely, to make sure that the estimation is within the range of70.51±14.10with 95% confidence, the relative standard error RSE should be around 0.1, and the required sample sizen=35.952*/(0.1)2=129,240. In addition, uniform random samples are obtained with high cost because they are not provided directly by the data sources. Costly sampling methods, such as rejection sampling, have to be employed to obtain uniform samples. In the process, many samples are retrieved and rejected as invalid. The actual samples retrieved are many times larger than129,240, depending on the sampling methods allowed. Considering the network traffic involved and the daily quota imposed by the service provider, it is prohibitive to use uniform random sampling to obtain meaningful estimations. With increasingly more applications of big data analyses, there is an urgent need to find a method to reduce such a large variance.Recent developments made empirical observations that simple random walk (RW) sampling or its extensions can improve degree estimator performance for P2P networks (Rasti, 2009), Facebook user network (Gjoka et al., 2009), Twitter user network (Lu & Li, 2012), and term-document bipartite graphs (Wang, Liang, & Lu, in press). Similar empirical observations are made for node size estimation (Katzir, Liberty, & Somekh, 2011; Kurant, Butts, & Markopoulou, 2012). We find that these observations are data dependent. Random walk can be much worse than uniform random sampling for other datasets, even when the graph is scale-free and the variance is very high as we will show in Section 4.3.We find that it is random edge (RE) sampling, not RW sampling, that reduces the variance for graphs with large degree variation. In addition to this empirical observation, we explore the reason why RE outperforms RN sampling, and why RW does not. While it is easy to understand that uniform random sampling does not work well for scale-free networks, it was not clear whether RE sampling works better.This paper shows that the variance of the RE estimator is bounded from above by a polynomial in the average degree and sample size. It implies that the performance of RE sampling does not deteriorate with the growth of degree variance of the graph, thereby it guarantees the superiority of RE sampling when degree variance is large. This result is particularly important for large graphs whose variance becomes larger compared with smaller data with the same distribution. Improvement ratios as high as 100 are observed on Twitter and other networks. Such a large gap has implications for both practitioners and researchers. Practitioners can greatly save the estimation effort and give a worst case error bound. Researchers can devise new sampling methods that approximate RE sampling when it is not directly supported by the data source under investigation. For instance, random walk with restart (Avrachenkov, Ribeiro, & Towsley, 2010) can succeed because it is similar to RE sampling and exploits the large gap between RN and RE sampling.The major contribution of the paper is our development of the upper bound of the variance of RE estimator. The result holds independent of degree distribution and graph topology. We verify the result using both simulated datasets and 18 real world networks. A direct consequence of the upper bound is the improvement ratio between RN and RE methods. To illustrate that the ratio can be very large, we first demonstrate that degree variance (consequently RN estimator variance) can be in the order ofO(N/ln2N)under the assumption of the power law distribution. Now that RE variance is upper bounded, the improvement ratio tends to be infinite when data size goes infinitely large. Finally, we show that random walk sampling can approximate the performance of RE sampling only when the conductance of the graph is not very small, or, when the graph is well-enmeshed.In the following sections, we first introduce the background of the research in Section 2, including the sampling methods and their corresponding estimators, the related work, and its applications. Then in Section 3 we derive the variances of RN and RE estimators. By giving the upper bound of the variance of the RE estimator, we quantify the performance ratio between RN and RE methods. In Section 4, we verify our result on 18 real networks, and demonstrate that the performance of RW sampling depends on both degree variance and graph conductance.Given an undirected graphG(V,E), where V is the set of nodes, and E the set of edges. Let|V|=N. Nodes are labeled as1,2,…,N, and their corresponding degrees ared1,d2,…,dN. The volume of the graph isτ=∑i=1Ndi, the average degree is〈d〉=1N∑i=1Ndi=τ/N. The varianceσ2of the degrees in the population is defined as:(1)σ2=〈d2〉-〈d〉2,where〈d2〉=∑i=1Ndi2/Nis the second moment, i.e., the arithmetic mean of the square of the degrees in the total population. The coefficient of variation (denoted asγ) is defined as the standard deviation, or the square root of the variance, normalized by the mean of the degrees:(2)γ2=σ2〈d〉2=〈d2〉〈d〉2-1.Suppose that a sample of n elements(dx1,…,dxn)is taken from the population, wherexi∈{1,2,…,N}fori=1,2,…,n. Our task is to estimate the average degree〈d〉using the sample. Table 1summarizes the notations used in this paper.There are different ways to take the samples, notably by RN, RE, and RW samplings. In RN sampling, each node is sampled uniformly at random with replacement. In RE sampling, edges are selected with equal probability and two nodes incident to a random edge are collected. In this way, RE sampling is a kind of PPS (probability proportional to size) sampling in that each node is sampled with probability proportional to its degree. RW sampling selects the next node in the current neighbourhood uniformly at random. Its node selection probability is proportional to the degree asymptotically.Different sampling methods require different estimators. The arithmetic mean is an unbiased estimator for RN sampling:(3)〈d〉^RN=1n∑i=1ndxi,In RE or PPS sampling, the arithmetic mean estimator tends to overestimate the average degree〈d〉by a factor of(γ2+1). Instead, the harmonic mean should be used for these samples:(4)〈d〉^RE=n∑i=1n1dxi-1.We refer to Salganik and Heckathorn (2004) for the detailed derivation of this estimator. RW sampling assumes that the sampling probability is proportional to the degree, therefore the same estimator is used. What we are interested in this paper is the variance of the RE estimator, particularly the comparison with the variance of the RN estimator.The sampling and estimation methods can be illustrated using Fig. 1. The average degree of the graph is 2. The sample degrees taken by RN, RE, and RW sampling methods are (1,1,1,1,2,8), (1,8,1,8,2,4), and (4,3,8,1,8,1), respectively. The estimations for RN, RE, and RW samples are:〈d〉^RN=1+1+1+1+2+86=2.5,〈d〉^RE=611+18+11+18+12+14≈2,〈d〉^RW=614+13+18+11+18+11≈2.11.To develop intuition about the high variance of RN sampling, and the variance reduction enabled by RE sampling to be discussed in the next section, consider a pedagogical example depicted in Fig. 2. It is a star graph that has a large node connecting with every other node (degree=N−1), while all the remaining (N−1) nodes connect with the large node only (degree=1). Such a graph in a much larger scale is also found as a subgraph in the real NotreDame web graph as shown in Fig. 11. The average degree is(N-1+N-1)/N≈2, assuming1/N≈0. Most of the uniform random samples will include the small nodes only, even when the sample size is close to N. Thus most of the estimations will be 1, while occasionally there are very large estimations when the large node is sampled. When RE sampling is used, both small and large nodes are sampled, resulting in sampled degree sequence(1,N-1,1,N-1,…). For these sampled degrees, the sample mean isN/2, which over estimates grossly because a node is sampled with the probability proportional to its degree. Such samples need a different estimator, i.e., the harmonic mean instead of arithmetic mean. The harmonic mean of four sample degrees is4/(1+1/(N-1)+1+1/(N-1))≈2. This approximates the true value very well.Graph sampling has been widely studied (Leskovec & Faloutsos, 2006; Wang et al., 2011), and finds its applications in online social networks (Gjoka et al., 2009; Papagelis, Das, & Koudas, 2013; Dasgupta, Kumar, & Sivakumar, 2012; Ribeiro & Towsley, 2010), real social networks (Salganik & Heckathorn, 2004; Wejnert & Heckathorn, 2008), web graphs (Henzinger et al., 2000), search engine indexes (Bar-Yossef & Gurevich, 2008), and deep web data sources (Lu & Li, 2010). The norm of the practice is to use uniform random samples whenever possible. Quite often, uniform random sampling is not directly supported. Other methods, such as Metropolis Hasting Random Walk (MHRW) (Metropolis, Rosenbluth, Rosenbluth, Teller, & Teller, 1953) and rejection sampling, are utilized to approximate uniform random sampling (Bar-Yossef & Gurevich, 2008). When uniform random samples are not available, numerous sampling methods are proposed, in particular RW (Lovász, 1993) for unequal probability sampling.Recently, there are empirical observations that RW sampling can outperform MHRW sampling (Rasti, 2009; Gjoka et al., 2009). Although MHRW does produce uniform random samples, it incurs additional cost, and is not the same as the direct RN sampling. Therefore, it is easier to observe that RW can be better than MHRW sampling. Rasti et al. observed that random walk sampling can outperform MHRW in the context of peer-to-peer networks Rasti (2009). Gjoka et al. showed that RW (called re-weighted random walk in their paper) and MHRW are comparable Gjoka et al. (2009). This paper claims that, it is RE sampling that is better than RN sampling for large and scale-free networks. RW sampling, on the other hand, is always inferior to RE sampling, and can be much worse than RE and RN sampling when the graph conductance is very small.Our earlier work on the comparison between RW and RN samplings on the Twitter data (Lu & Li, 2012) motivated the studies conducted in this paper. Lu and Li (2012) found that, on the Twitter data, RW sampling is much better than RN sampling. Wang et al. (in press) experimented RW sampling on bipartite graphs representing term-document relationship in search engines. On such bipartite graphs, the performance of RW sampling does not have an obvious advantage over RN sampling. Our further study on dozens of other datasets also generated mixed results. Thereby, this paper tries to answer the question as for when and why RW is better than RN sampling. We identified two orthogonal factors influencing the sampling method: the degree variation and the conductance. High degree variation will guarantee that RE sampling works well, and the lack of loosely connected components ensures that RW sampling can approximate RE sampling.The harmonic mean estimator was first derived and studied in depth by Salganik and Heckathorn (2004) to estimate the properties of hidden populations such as drug-addicts. The degree sampling of networks, which is the focus of this paper, has also received special attention. Stump and Wiuf studied the sampling of degree distribution Stumpf and Wiuf (2005) for two sampling schemes, i.e., random sampling and the degree dependent sampling of the nodes. For average degree estimation, both (Feige, 2004 & Goldreich & Ron, 2004) used uniform random sampling of the nodes. Feige (2004) discussed the lower bound of the estimation. Based on this result, (Goldreich & Ron, 2004) proposed a sampling scheme that put more weight on the nodes that have less probability of being sampled.The impact of sampling methods on the discovery of graph properties has also been studied in Leskovec and Faloutsos (2006), Stumpf, Wiuf, and May (2005), Stumpf and Wiuf (2005), Lee, Kim, and Jeong (2006). They cover a wide range of network properties, and focus on the properties of the derived sub-graph, instead of the estimation of the properties of the original graph. For instance, (Leskovec & Faloutsos, 2006) investigated several network characteristics like the distribution of connected components. Lee et al. (2006) showed that random node sampling performs better than random edge sampling in approximating the clustering coefficient of the graph.Graph properties need to be estimated when the graph in its entirety is not available. This happens when the graph is distributed without central data deposit, such as the Web, or, when it is hidden behind searchable web interfaces, such as search engines, online social networks, and millions of textual corpora hidden behind HTML search boxes. In either case the direct calculation of the property is impossible. Next, we highlight the importance of average degree estimation, and practical implications of RE sampling.Average degree is an important metric for any graph (Kolaczyk, 2009), and has many incarnations in the real world: when the graph is the Web, the average degree is the average number of in/out-links, which is an important property to characterize the Web (Broder et al., 2000); when the graph is an online social network, the average degree is the average number of friends, messages and followers (Gjoka et al., 2009); when the graph is a term-document network implemented by a search engine, the average degree is the average document size and average query matches (Callan & Connell, 2001; Bar-Yossef & Gurevich, 2008); when the graph is an email network, the average degree is the average number of email contacts.The applications can go beyond computer science to other disciplines such as finding the average degree (friends) of drug addicts (Salganik & Heckathorn, 2004). Furthermore, average degree estimation can be generalized as the problem of estimating the expectation of a random variable. RN and RE samplings correspond to uniform sampling and PPS sampling, respectively. Thus our results can be extended to other scenarios without a graph representation. In this paper, we discuss the problem in the setting of graph so that the RW sampling can be compared within the same framework. Besides, graph representation gives us a tangible illustration and straightforward implementation for the sampling process.What is more important is that average degree can be used to derive other properties such as the variance and the data size. The variance〈d2〉-〈d〉2, or equivalently,γ2=〈d2〉/〈d〉2-1, is dependent on average degree〈d〉. More interestingly, it can be estimated usingγ2=〈dE〉/〈d〉-1, where〈dE〉is the average degree of the samples obtained by RE sampling.γin turn can be used to estimate the number of nodes byN^=(γ2+1)n22C(Lu & Li, 2013; Lu & Li, 2012), where n is the sample size, C is the number of collisions in the samples.γ2can be also used to measure the ratio between the number of friends of your friends, and the number of your friends. As the saying goes, your friends have more friends than you do on average. To be more precise, your friends haveγ2+1times more friends than you do. Along the same lineγ2can be used to quantify the diffusion of messages that is borrowed from epidemiology. In particular, it can be derived that the threshold for the occurrence of large component, or the occurrence of epidemics (Jackson, 2008) (Eq. 7.8) isπ=(γ2+1)〈d〉-2(γ2+1)〈d〉-1, whereπis the proportion of the nodes that are immuned uniformly from the network.The performance of estimators can be evaluated in terms of bias and variance. The RN method is unbiased, and the RE method has a small bias that can be ignored compared with the variance when sample size is large (Salganik & Heckathorn, 2004). Therefore, we focus on the comparison of the variances of the two methods.The variance of the RN method depends on the variance of the degrees, which varies from data to data, and typically grows with the size of the data for a given degree distribution. On the other hand, we find that the variance of the RE method has an upper bound that does not depend on the degree variance. This upper bound guarantees the reduction of the variance of the RE method for very large data.We develop the upper bound in three steps: first we useV1, a value that is obtained from Taylor expansion, to approximate the RE estimator. We demonstrate that such approximation is accurate using simulated data and real networks of various topologies.V1contains the variance of the reciprocal of the sampled degrees, which is difficult to quantify and compare with. Therefore,V2is derived as an upper bound ofV1, by exploiting the fact that all the degrees are greater than one, and that most of the nodes are of very small degrees in scale-free networks. In a typical scale-free network with exponent one, we show thatV2≈2V1. In real networks, we observe that the ratio betweenV2andV1varies widely between 1.19 and 7.55.V2can be simplified further intoV3when the average degree is large.The variance of the arithmetic mean estimator〈d〉^RNfor RN sampling is:(5)var(〈d〉^RN)=σ2n=γ2〈d〉2n,where n is the sample size. Sometimes, it is easier to interpret the variance relative to its true value using RSE (relative standard error) as defined as below:(6)RSE(〈d〉^RN)=var(〈d〉^RN)〈d〉=γn.Although〈d〉^RNis an unbiased estimator, its variance can be very large for some scale-free networks. The degrees of most real life networks are close to Zipf’s distribution (Newman, 2005), inducing a large variation of the degrees. However, it is hard to quantify the variance exactly because real data do not fit exactly the Zipf’s law, and the exponent and cut-off value vary from data to data. Nonetheless, we can assume a distribution to gain some understanding of the variance.Whendifollows the power law,di=A/iα, where A is a normalizing constant that satisfies∑i=1Ndi=A∑i=1N1/iα≈Aζ(α)=N〈d〉,whereζ(.)is the Riemann-zeta functionζ(α)≈∑i=1N1/iαbased on the assumption that N is a very large number. That is,A=N〈d〉/ζ(α). Note that this exponentαis for the degree-rank plot. The corresponding frequency-degree plot has slope-(α+1)(Newman, 2005). Since the vast majority of networks have degree-frequency slope around-2(Newman, 2010), in the following we derive the variance when the slope is exactly-2, i.e.,α=1in the degree-rank equation. Note thatζ(1)≈lnN, andζ(2)≈1.6. Therefore,(7)∑i=1Ndi=∑i=1NAi=Aζ(1)≈AlnN,(8)∑i=1Ndi2=∑i=1NA2i2=A2ζ(2)≈1.6A2.By the definition of variance, we can derive the variance of the degrees as below:(9)var(d)=〈d2〉-〈d〉2=1N∑i=1Ndi2-1N2∑di2=1.6A2N-A2ln2NN2=〈d〉21.6Nln2N-1.Therefore, when exponentαof the Zipf’s law is 1, the coefficient of variation is:(10)γ2=1.6Nln2N-1.The intuition of this equation is that the variance grows almost linearly with data size N, in the order ofO(N/ln2N). The sample size n needs to be in the order ofO(N/ln2N)so that satisfactory estimates can be obtained. When the data is very large, almost all the nodes need to be checked before an estimation can be made. That is equivalent to saying that the estimation is infeasible for very large scale-free graphs using uniform random sampling.For instance, Twitter hasN≈5×108users in 2012. If the degree distribution followed the power law as we assumed, its coefficient of variation would beγ2=1.6N/ln2N=2.0×106. According to Eq. (6), this means that we would need a sample sizen=γ2/0.12=2.0×108so that the RSE could be 0.1. To achieve the 95% confidence interval5×108±108, the sample size is already in the same order of the total population. For the downloaded Twitter data in 2009 that contains4.1×107users, we find that the sample size needs to be 129,240 so that RSE is 0.1.To verify our derivations, we generate 10 synthetic datasets with the same distribution (α=1) but different data size N ranging between105and106. Panel (C) in Fig. 3shows the observedγ2values along with the ones projected by Eq. (10). Clearly,γ2grows almost linearly with the data size, and the projection is rather accurate. Panels (A) and (B) plot the degree distributions whenN=105. Panel (A) is the degree-rank plot with slope −1, i.e.,α=1. (B) is the frequency-degree plot for the same data. We can see that the slope of the frequency-degree plot is-(α+1)=-2. Panel (D) compares the estimator variance for RE and RN methods when the sample size is 100. It shows that, for the same data distribution, the performance of RE method remains almost constant. But compared with the increasing variance of RN method, RE sampling becomes better whenN>50,000, and the advantage becomes larger with the increase of data size.Given a set of degrees{dx1,dx2,…,dxn}obtained by RE sampling, recall that the harmonic mean estimator is:(11)〈d〉^RE=n∑i=1n1dxi-1.Let random variablesv=1/dxi, andV=∑1n1/dxi. By the harmonic mean estimator, we haveE(v)=E(1/dxi)=1/〈d〉, andE(V)=n/〈d〉. Our first approximation to the variance is obtained by applying the Taylor expansion of〈d〉^REaroundE(V). The result is:(12)〈d〉^RE=nV=n1E(V)-V-E(V)E(V)2+…By applying the variance on the first two terms of the Taylor expansion, we obtain an approximate variance of〈d〉^RE(denoted byV1) as follows:(13)V1=n2var(V)E(V)4=〈d〉4var(v)n.Next, we need to find a bound forvar(v). By the definition of variance,(14)var(v)=E(v2)-(E(v))2=E1dxi2-1〈d〉2.Sincedxiis obtained with probabilitypxi=dxi/τ, whereτ=∑i=1Ndi,(15)E1dxi2=∑i=1Npi1di2=∑i=1N1τdi=1N〈d〉∑i=1N1di.∑i=1N1/divaries from data to data, but a safe upper bound isN>∑i=1N1/disince everydi>1. In scale-free networks,∑i=1N1/diis not far away from N, as we will show in the simulation study and in real networks. Therefore we derive an upper bound forvar(〈d〉^RE), which is calledV2as defined below:(16)V2=〈d〉4n1〈d〉-1〈d〉2.When〈d〉is a large number, the second term1/〈d〉2can be neglected, resulting in a simplified upper boundV3,(17)V3=〈d〉4n1〈d〉=〈d〉3n.In summary,var(〈d〉^RE)≈V1<V2<V3. Thus, we derive the following theorem:Theorem 1The upper bound for the variance of RE sampling is〈d〉3/n. Or,(18)var(〈d〉^RE)<〈d〉3n.We highlight two points regarding this result. First, the upper bound does not depend on the degree distribution or other topological characteristics like graph conductance. As long as the nodes are selected with probability proportional to their degrees, the result holds no matter whether it is a scale-free graph, or has tightly knit communities. On the other hand, the performance of RW sampling depends on graph conductance as we will explain in Section 4.3.Second, the upper bound is surprisingly simple, involving only average degree and sample size. Unlike the variance of RN sampling that is associated with the degree variance, the variance of RE sampling is bounded from above by a constant determined by average degree. Recall that the variance for RN estimator isvar(〈d〉^RN)=〈d〉2nγ2. Comparing the variances for estimators〈d〉^RNand〈d〉^RE, we have:Corollary 1RE sampling reduces the variance at least by a factor ofγ2/〈d〉, i.e.,(19)var(〈d〉^RN)var(〈d〉^RE)>γ2〈d〉.To understand the relationship between the upper bound and the true variance, we demonstrate the variances using synthetic datasets whose degree distributions follow a power lawdi=A/(β+i), where A is a normalizing constantN〈d〉/∑i=1N1/(β+i). This is called Zipf–Mandelbrot law (Montemurro, 2001) that can model the real data better thandi=A/iα. Whenβ=0, it is reduced to the Zipf’s law described in Section 3.1.We experiment with two distributions, and report the results in Fig. 4. The first row is for the distribution withβ=0, and the second row hasβ=100. For both distributions, we generate the degrees satisfying such distribution where the data sizeN=106, and conduct RE sampling 100 times. From 100 repetitions, we record the variance of the RE estimator, along with its approximationsV1,V2andV3. Panels (A) and (D) are the degree-rank plots for the data, giving a visual understanding of the distribution. Panels (B) and (C) are the plots for the variances (V1,V2,V3, and observed variance) over various sample sizes ranging between 100 and 1000. Panels (C) and (D) are the corresponding log–log plots.We make the following observations from the simulation study:•V3vs.V2: According to our analysis in the previous subsection, the ratio betweenV3andV2should be that of1/〈d〉and1/〈d〉-1/〈d〉2, which is〈d〉/(〈d〉-1). In this particular data,〈d〉=10, and we can see that the ratio betweenV3andV2are very close to 10/9 as expected.V2vs.V1: The difference betweenV1andV2is determined by the difference of∑i=1N1/diand N. Whenβ=0,(20)∑i=1N1/di=1A∑i=1Ni=lnNN〈d〉N(N-1)2≈N2.That is,∑i=1N1/di=0.50N. ThereforeV2/V1is approximately two as shown in panels (B) and (C).Whenβ=100,∑i=1N1/di=0.29N, which is smaller than the previous case. Therefore, the gap betweenV2andV1is larger.V1vs. Observed Variance:V1is obtained from Taylor expansion of1/Vby ignoring the third term in Eq. (12). While the approximation varies from data to data, it shows that the gap is really negligible in these two simulated data, and in 18 real network as we will show in Section 4.We conducted experiments on 18 real networks, most of them are from the Stanford SNAP graph collection (Leskovec & Faloutsos, 2006). Due to space limitation, for some network categories only one graph is reported if they have similar behaviour. For instance, citation graphs have similar degree distribution, similar coefficient of variation, and similar error ratios between RN, RE, and RW samplings. For these categories, we choose only one graph for each category. In the category of the Web graph datasets, RW sampling deviates greatly from RE sampling. To investigate the cause for such deviation, we investigated several Web graphs on the domains of Notre Dame, Stanford, and Berkley-Stanford. The Facebook data is one of the few exceptions where RE sampling is inferior to RN sampling. Therefore, we include two Facebook graphs. Complete data description and programs can be found at http://cs.uwindsor.ca/jlu/degreevar. Their statistics are summarized in Table 2, sorted according toγ, the coefficient of variation of the degrees.We make several observations on the datasets. First, most of them are scale-free networks as shown in Fig. 5. The frequency-degree slope is around 2, their corresponding degree-rank slope shall be around 1, the same slope we selected in our simulation studies. Some datasets, such as Facebook and Citation networks, have a curve that is reflected by the Zipf–Mandelbrot law we used. One exception is the RoadNet network that is closer to normal or log-normal distribution. There are irregular data distributions, such as Flickr and Amazon that have broken lines. Also, Web graphs (sub-Figs. 3, 5, 8) do not form a straight line in the upper part of the log–log plots, indicating irregularity in the graph structure. Albeit the varieties of the datasets, we will show that our result withstands without exception.Second, it is interesting to note that two representative social networks Twitter and Facebook are in the two extremes of the spectrum ofγvalues, due to the way the networks are formed. Twitter dataset is much larger, and allows unlimited number of followers, while Facebook has an upper limit for the number of friends. Therefore Twitter is a scale-free network with large degree variation, while Facebook has a sharp dropping curve causing a lowγvalue. Besides, Facebook datasets are much smaller. Because of their structural difference, for Twitter data RE is a hundred times better than RN sampling, for Facebook data RE and RN samplings are similar.One technical detail needs to be mentioned is the sampling of Twitter data. It is the complete user network collected in 2009 (Kwak et al., 2010), which has billions of edges that cannot fit into computer memory. We use index engine Lucene to store the data in hard drive and use search engine to mimic the random sampling methods. We treat all the neighbours of a node as a ‘document’, and build a index for those ’documents’, or neighbours. Then, graph sampling can be accomplished by searching the index.Despite their variety in degree distribution and topology, all the 18 datasets support our analytical result. We demonstrate this using a fixed sample size first in Fig. 6, then the trend over sample sizes in Fig. 7.Fig. 6 panel (A) demonstrates our main result, i.e., the variance ratios between RN and RE samplings have an almost linear relation withγ2/〈d〉, whose Pearson’s correlation coefficient is as high as 0.9867. In addition, the ratios are consistently higher thanγ2/〈d〉, indicating that〈d〉3is indeed an upper bound of the RE variance. The plot is in log–log scale so that the points are spread out along the axes. For this experiment, sample size n=100, and the variances are obtained with 20,000 repetitions. There are only five datasets whose RN/RE ratio is slightly below one, i.e., RE sampling is slightly worse than RN sampling. A closer inspection of these datasets shows that they all have small degree variations as shown in Table 2 and Fig. 5. Both of the Citation and RoadNetwork are at the lower end of theγvalues. The RoadNetwork has maximal 12 degrees, and its degrees follow a log-normal distribution. The Facebook network has an upper limit on the number friends, thus the maximal degree is abnormally small compared with its size. The Flickr network has an irregular degree distribution that has a large bump around degree 100.Panels (B) and (C) in Fig. 6 are plotted to corroborate our conclusion. Panel (B) shows thatV3is indeed the upper bound for the RE variance. For all the 18 datasets,V3is consistently larger than the observed variance. For some datasets such as Epinion and Slashdots, the upper bound is rather close to the true variance. Panel (C) verifies thatV1, the approximation obtained by the Taylor expansion, is very close to the real variance.Fig. 7 shows the trend of the variances over various sample sizes, and reconfirms the relationship between variancesV1,V2,V3, and the real one. It demonstrates thatV3>V2>V1≈observedvarianceas expected. Overall,V1is very close to the observed variance, as the Taylor expansion can approximate the original function well.V2andV3are also close in general, since their difference is dictated by〈d〉/(〈d〉-1). When average degree〈d〉is small, as in RoadNet, WikiTalk and EmailEU, the difference betweenV2andV3is noticeable. The largest gap is betweenV1andV2, which is determined byN/∑i=1N1/di. As we have shown in simulation studies in Section 3.3,N/∑i=1N1/diis around two when the exponentα=1and average degree is 10. That is,V2is about twice as large asV1. In real datasets,N/∑i=1N1/divaries from data to data, ranging between 1.19 (WikiTalk) to 7.55 (Flickr).Another perspective to understand the reduced variance of RE sampling is the sample distributions that are depicted in Fig. 8, where the sample size is 8000. It shows that most of the sample distributions have a “V” shape, indicating that the small nodes still follow a power law as in the original data, while the large nodes can be sampled many times. In RE sampling, the sampling probabilityP(k)of degree k is determined by k and its frequencyf(k). Bearing in mind thatf(k)∝k-α, whereαis normally around two, we have:(21)P(k)∝k×f(k)∝k×k-α=k-(α-1).Therefore, the sampling probability still follows a power law with the exponentα-1. Same as the power law for degree distribution, the formula is accurate only when k is small. When k is large,f(k)≪1in the formula. In real data,f(k), the frequency, cannot be a fractional number. Instead,f(k)must be zeros in most cases so that in average they can follow the power law. Whenf(k)is a non-zero number such as one,P(k)amplifies it by a factor of k, thereby generates the ascending branch in the sampling frequency plot.In other words, both small and large nodes are sampled multiple times but for different reasons. Small nodes are sampled because there are many of them. Although each individual small node has a very small probability of being sampled, collectively the large number of small nodes will guarantee that some will be sampled. On the other hand, large nodes are sampled because they have higher probability of being hit by random edges, even though there are only a few of them. Therefore both small and large nodes are well represented in the sample, resulting in small variance of the estimation. In RN sampling, large nodes are included by chance, inducing a large variance in estimation.The datasets that do not have the “V” shape in RE sampling happen to be the ones not in favour of RE sampling. They do not have nodes that are large enough to be sampled many times. Their RE sample distributions are just similar to the original data, or to RN sample distribution. Therefore RE sampling does not have an advantage in this kind of data.Two of the representative online social networks are Twitter and Facebook. It is interesting to see that they favour different sampling methods, one RE sampling and the other RN sampling. Moreover, their RN/RE ratios happen to be on the two extremes of the spectrum. Twitter has the third highest RN/RE ratio because it is scale-free and the largest network in our experiment. Facebook-2 has the lowest RN/RE ratio because it has a cap on the number of friends.RW sampling can be regarded as an approximation to RE sampling in that asymptotically the node sampling probability is proportional to its degree. The sampling probability is not exactly PPS, yet the PPS estimator is used. Therefore, the bias of the estimator can no longer be omitted in our evaluation. Both bias and variance should be considered, and they can be measured by RRMSE (Relative Root MSE) as defined below:(22)RRMSE(〈d〉^)=1〈d〉1n∑i=1n〈d〉^i-〈d〉2where〈d〉^is an estimator,〈d〉is the true average degree,〈d〉^iis the estimation obtained in the i-th run. In our experiments, all the RRMSE data are obtained by 5000 independent runs, except for Twitter data that has 2000 runs due to its large size and the long computation time of the sampling. Fig. 9shows the comparison of three estimators.Our first observation is that RW is worse than RE consistently as expected, since it is an approximation of RE sampling. To understand exactly how much worse RW is, we plot RW/RE ratio in Fig. 10along graph conductanceΦ(Sinclair & Jerrum, 1988), which can reflect mixing time of random walk. Very small graph conductance indicates the existence of loosely connected components. For datasets with small conductance such as NotreDame, Stanford, BerkStan and Flickr, RW is worse than RE sampling by a factor of ten in terms of RRMSE. In terms of variance, it is worse by a factor of a hundred. To develop the intuition for such poor performance, we plot their random walk traces when the estimations have large bias in Fig. 11. Each RW trace contains104steps. All four datasets, especially Flickr and NotreDame, have an extremely dense component that dangles loosely from the main component. This shows that RW sampling depends not only on the variation of the degrees, but also the topological structure of the graph. In the Flickr graph, there are two almost disconnected components. Random walks will happen mostly either in one of the component, and the corresponding estimations are the average degrees for one of the components, not the entire graph. In the NotreDame data, there is a very large star on the right that resembles the graph in Fig. 2, indicating many nodes are only connected to the centre of the star. When a random walk is trapped inside this star, the estimated average degree will be around two as shown in the example in Section 3.1, no matter what the true value is.Given this relationship between RW and RE sampling, our second observation is that RW outperforms RN only (1) when RE outperforms RN (or the degree variance is large); (2) when there is no loosely connected components (or the conductance is not very small). When the RE is worse than RN, RW will be also worse than RN. Therefore there is no need to test RW method or improve RW with its various extensions. When there are loosely connected components, we can modify the simple random walk sampling so that it can approximate RE sampling, e.g., by uniform random restart.

@&#CONCLUSIONS@&#
The size of the data, compounded by the power law distribution, is changing the landscape of sampling practice. Uniform random sampling is no longer the method of choice. This does not happen until the data size reaches a threshold for a give degree distribution, as illustrated in Fig. 3 Panel D. The gap between RE and RN samplings grows almost linearly as the data size. It can be infinitely large in theory, and is orders of magnitude in observed data. Such a large difference is particularly important for web-based networks, such as online social networks and the deep web, where the sampling process is costly because of network traffic and daily quota.It is remarkable to notice that it is uniform random node (RN) sampling that is on the downside of the comparison. In the past, great efforts are devoted to obtain uniform random samples using methods such as Metropolis–Hasting Random Walk and rejection sampling (Bar-Yossef & Gurevich, 2008). During the sampling process many nodes are visited, examined, and rejected. In the end these precious uniform random samples can be much worse than the samples obtained using low cost RE or RW methods.While it is easy to understand that uniform random sampling has large estimation error for data with large variance, it is not straightforward to see whether RE sampling can reduce the variance for data of various distributions. We show that the variance of RE estimator has an upper bound〈d〉3/n. This upper bound is derived independent of the data distribution, and is close to the real variance when the data follows a power law distribution. We generate several synthetic scale-free networks to verify and explain our derivations, and use 18 real networks to support our result.The upper bound of the variance implies that RE reduces the variance of RN sampling when the graph is large. First, the variance ratio between RN and RE samplings is at leastγ2/〈d〉. Although the derivation involves several approximations, it is remarkable that the observed RN/RE ratio has a high linear correlation withγ2/〈d〉. The Pearson’s correlation coefficient is 0.9867 among the 18 real networks we studied.Second, the comparison between RN and RE depends on the values ofγ2and〈d〉. For a typical scale-free networks (degree vs. frequency power law slope is −2), we show thatγ2grows almost linearly with data size for the same data distribution. When data size is small (N<6×104),γ2can be smaller than〈d〉. However, when the data size grows,γ2is much larger than〈d〉. In other words, RE is much better than RN for large graphs. Empirically we demonstrate the improvement ratio is greater than a hundred for Twitter, EmailEU, and WikiTalk. In theory, we project larger improvement ratio can be found. The dependency on data size may also explain why such variance reduction was not observed in the literature. Variance reduction happens only for very large data that are available only recently. If the data is not very large, RE may not be as good as RN even if the data is scale-free.When RE sampling is not possible, we can use RW to approximate it in that both methods sample nodes with probability proportional to its size. The difference is that RW is a PPS sampling only asymptotically. Thus the performance of RW sampling differs from data to data. Our experiments show that in general RW sampling performs a little bit below RE sampling as expected, but sometimes it can be much worse, even worse than RN sampling when there are loosely connected components in the graph characterized by graph conductance.In retrospect, RE sampling is not widely studied, probably because that in most real situations, nodes are the primary objects – they are represented explicitly, and can be searched, queried, and crawled. In other words, nodes can be sampled in various ways. Edges, on the other hand, come as secondary objects that reside in nodes, and can be accessed from the nodes only. In the Web, web pages (the nodes) can be sampled using various methods, while the edges are only revealed as a by-product when we crawl the Web from one page to another. In social networks, we sample people (the nodes), while the relations between people can be accessed from people, not the other way around. In software component networks, classes and objects are represented explicitly, while the relations between the classes can be obtained from those objects or classes.New developments in the digitalized world are making RE sampling more common. When using random queries to sample documents, long documents are sampled more often. It is a PPS sampling, or RE sampling when we view the queries as edges connecting the documents. When using random messages/emails to sample users, it is a RE sampling for user network connected by messages/emails. In the semantic web, edges are explicitly represented as RDF triples.