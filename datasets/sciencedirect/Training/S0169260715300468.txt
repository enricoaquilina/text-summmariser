@&#MAIN-TITLE@&#
A real-time method to reduce ballistocardiogram artifacts from EEG during fMRI based on optimal basis sets (OBS)

@&#HIGHLIGHTS@&#
A real-time OBS was proposed for the real-time removal of ballistocardiogram artifacts.The real-time OBS performed better than rtAAS in the real-time removal of BCG artifacts.A real-time analysis during a simultaneous EEG–fMRI acquisition is essential to achieving neurofeedback.

@&#KEYPHRASES@&#
Simultaneous EEG–fMRI,Ballistocardiogram artifacts,Real-time optimal basis sets,

@&#ABSTRACT@&#
BackgroundThe simultaneous acquisition of electroencephalogram (EEG) and functional magnetic resonance imaging (fMRI) provides both high temporal and spatial resolution when measuring brain activity. A real-time analysis during a simultaneous EEG–fMRI acquisition is essential when studying neurofeedback and conducting effective brain activity monitoring. However, the ballistocardiogram (BCG) artifacts which are induced by heartbeat-related electrode movements in an MRI scanner severely contaminate the EEG signals and hinder a reliable real-time analysis.New methodThe optimal basis sets (OBS) method is an effective candidate for removing BCG artifacts in a traditional offline EEG–fMRI analysis, but has yet to be applied to a real-time EEG–fMRI analysis. Here, a novel real-time technique based on OBS method (rtOBS) is proposed to remove BCG artifacts on a moment-to-moment basis. Real-time electrocardiogram R-peak detection procedure and sliding window OBS method were adopted.ResultsA series of simulated data was constructed to verify the feasibility of the rtOBS technique. Furthermore, this method was applied to real EEG–fMRI data to remove BCG artifacts. The results of both simulated data and real EEG–fMRI data from eight healthy human subjects demonstrate the effectiveness of rtOBS in both the time and frequency domains.Comparison with existing methodsA comparison between rtOBS and real-time averaged artifact subtraction (rtAAS) was conducted. The results suggest the efficacy and advantage of rtOBS in the real-time removal of BCG artifacts.ConclusionsIn this study, a novel real-time OBS technique was proposed for the real-time removal of BCG artifacts. The proposed method was tested using simulated data and applied to real simultaneous EEG–fMRI data. The results suggest the effectiveness of this method.

@&#INTRODUCTION@&#
Simultaneous recording of electroencephalogram and functional magnetic resonance imaging (EEG–fMRI) provides high spatial and temporal resolution when examining brain activity [1] and has been applied in numerous studies [2–11]. A real-time analysis during a simultaneous EEG–fMRI acquisition is important in studying neurofeedback [12] and monitoring brain activity on a moment-to-moment basis. For example, in a study on neurofeedback, the real-time feature extraction of both EEG and fMRI data was shown to be essential to neurofeedback training [12]. However, artifacts induced by the MRI environment severely contaminate the EEG signals, making the real-time analysis of multimodal signals unviable. The removal of such artifacts is essential for a real-time fMRI-EEG analysis.There are two major types of artifacts [13]. One is a gradient artifact caused by the MRI gradient switching and radiofrequency pulses. This type of artifact can be removed easily using some existing real-time algorithms based on the stability and strict periodicity [13,14]. The other is a ballistocardiogram (BCG) artifact induced by heartbeat-related movements of the electrodes inside the static magnetic field of the MRI scanner. BCG artifacts therefore have an evident interpersonal variance. Furthermore, BCG artifacts are time-variant because their periodicity is subject to the variability in the heart rate and the presence of drift artifacts [15]. The amplitude of a BCG artifact is scaled in proportion to the magnetic field strength inside the MRI scanner [16,17], and its shape varies considerably over time [18]. These factors make BCG artifact variations difficult to predict or characterize. Therefore, the removal of BCG artifacts is often more challenging than the removal of gradient artifacts when analyzing EEG data recorded in an MRI environment [19].BCG artifact removal approaches mainly include spatial-pattern removal techniques and waveform removal techniques. To reduce artifacts, the spatial-pattern removal techniques use the statistic signature of the spatial pattern of the artifacts. Such spatial filtering schemes for artifact reduction are based on a principal component analysis (PCA) and an independent component analysis (ICA) [5,6]. Waveform removal techniques use the periodical nature of the heartbeat to reduce artifacts. This class includes averaged artifact subtraction (AAS) [15], optimal basis sets (OBS) [20], moving general linear models (mGLMs) [21], and adaptive filtering techniques [22]. Compared with spatial-pattern removal approaches, waveform removal approaches usually consume less time, and their performance is independent of the user experience. Furthermore, a reference-free harmonic regression technique [23], cyclostationary source extraction (CSE) [24], orthogonal matching pursuit (OMP) [25], short- and long-term linear predictor [26], and a method combining an ICA with a clustering technique [27] are also widely used to remove BCG artifacts. However, each of the above methods has been applied to the removal of BCG artifacts in offline post-processing mode.For the real-time removal of BCG artifacts, researchers have developed a method called real-time AAS (rtAAS), which averages multiple prior artifact segments (according to the ECG data) to predict ongoing artifacts (BrainVisionRecView software of Brain Products GmbH, Munich, Germany: http://www.brainproducts.com/). Although rtAAS is popular owing to its simplicity and effectiveness, the technique of overlaying and averaging it employed to calculate BCG artifact templates may be low in sensitivity and unable to reflect the changes of BCG artifacts over time [28]. Finding better options for real-time BCG artifact removal remains a challenge in EEG–fMRI studies.Previous studies on offline analyses have suggested that the OBS method performs better in BCG artifact removal than the AAS method [20,29]. The OBS method employs PCA to generate a BCG artifact template obtained using the optimal basis sets to effectively capture the variations in artifacts, and then subtracts this template from the original EEG trials. Namely, the OBS method employs a statistic method to construct a template used for presenting more artifact information and is robust to disturbances. Accordingly, the OBS method may also be a more effective candidate for real-time artifact removal. However, in previous studies, the OBS method has mainly been applied to offline post-processing instead of a real-time analysis. In the present work the main goal is developing a convenient real-time method for BCG artifact removal in simultaneous EEG–fMRI studies.In this article, a novel method called real-time OBS (rtOBS) is introduced for real-time BCG artifact removal. Using real-time AAS (rtAAS) applied to simulated data as a reference, the efficacy of the rtOBS method was tested. Next, rtOBS was applied to real data. The results for both the time and frequency domains show that our rtOBS is efficient in the real-time removal of BCG artifacts from EEG data acquired simultaneously using fMRI.The rtOBS method for BCG artifact removal includes three major steps. First, the R-peak (peak of the electrocardio signal) of the current heartbeat in an ECG signal is detected. Second, the optimal basis sets denoting the estimation of the BCG artifacts are constructed and updated on a moment-to-moment basis. This step adopts EEG segmentation according to the R-peak detection results and the sliding window technique [30]. Third, the optimal basis sets are fitted to and subtracted from the current EEG segment to remove BCG artifacts in real-time. The details of each step are as follows.For the real-time detection of ECG R-peaks in an MR environment, simple thresholding detection methods [15] are impractical owing to their time-consumption and inaccuracy in such an environment. Thus, a combined adaptive threshold algorithm [31] is introduced here for the real-time detection of ECG R-peaks. For this detection method, three thresholds, (1) the steep-slope threshold (M), (2) the integrating threshold for high-frequency signal components (F), and (3) the beat expectation threshold (R), are used together for R-peak detection. An R-peak is defined as the local peak with the signal magnitude being greater than the sum of these three thresholds (see Eq. (1)):(1)MFR=M+F+RThe timings of the R-peaks are detected using a real-time procedure based on the combined adaptive threshold algorithm.For consistency of the compare between methods, we apply this R-peak detection method for both rtAAS and rtOBS for the real-time detection of ECG R-peaks. Therefore, we can exclude the possibility that the difference between rtAAS and rtOBS in performance is because of different methods of R-peak detection.The EEG data are segmented based on the detected ECG R-peaks. PCA is then employed on these EEG segments to construct the optimal basis sets. For a real-time process, the interval of the R-peaks varies over time, and thus it is necessary to adopt an adaptive EEG segment length (Lrt). Furthermore, to achieve a real-time analysis, a sliding buffer window is applied to the EEG segments. According to the above procedure, three parameters are critical for the real-time construction of the optimal basis sets: (1) the EEG segment length (Lrt), (2) the buffer window size, and (3) the number of principal components (PC number). In the following, the details of these parameters are introduced.In an offline OBS method, the EEG segment length (L), which is constructed using the entire dataset, is computed as the mean of all ECG peak intervals [20]:(2)L=1n−1∑m=2n(Rm−Rm−1)where n is the number of all ECG R-peaks, and Rmis the time point of the mth ECG R-peak. Notably, all ECG R-peaks are used in the offline OBS.However, in real-time segmentation, the foregoing procedure is no longer valid. For a real-time analysis, the time interval between two neighboring artifacts often varies over time. BCG artifacts induced by heartbeat-related electrode movements inside the static magnetic field of the MRI scanner are time-variant because their periodicity is subject to the variability of the heart rate and the presence of drift artifacts [15]. Fixed-length segmentation will cause a mismatch between the EEG segment lengths and induce additional residual artifacts [32]. Therefore, for the rtOBS method, an adaptive segment length (Lrt) for the real-time segmentation of EEG data is adopted. Instead of using all R-peaks detected offline, k R-peaks detected online are used to obtain the adaptive EEG segment length (Lrt). A buffer RR (see Eq. (3)) was set to contain the k latest detected ECG R-peaks:(3)RR=[R1R2R3…Rk−1Rk]where k is the buffer size (the number of EEG segments included in the sliding window, which will be shown in next section), Rkis the time point of a newly detected ECG R-peak, and R1, R2, R3, …, Rk−1 are the time points of the k−1 detected ECG R-peaks before the newly detected ECG R-peak. As the real-time analysis progresses, RR is updated by excluding the earliest ECG R-peak but including the currently detected ECG R-peak.For the current RR, the lengths of the k−1 peak intervals are averaged to yield Lrt:(4)Lrt=1k−1∑i=2k(Ri−Ri−1)where Lrtis the updated EEG segment length. The above process is repeated once a new ECG R-peak is detected.For the current RR, the EEG data are then divided into k EEG segments according to Eq. (5).(5)Ri+Rdelay−12Lrt,Ri+Rdelay+12Lrtwhere Lrtis the adaptive EEG segment length, Riis the time point of the ith R peak in RR, and Rdelay is an empirical time delay of 210ms between the occurrence of the pulse artifact in ECG and the artifact's influence observed in EEG signals [15].In an offline OBS, PCA is employed for the construction of the optimal basis sets using all EEG segments [20], which is impractical for a real-time analysis. To achieve a real-time analysis, we apply PCA using the k (number of EEG segments included in the window) EEG segments included in the current sliding window. The size of the sliding window also affects the construction of the optimal basis sets. An inadequate number of EEG segments may provide insufficient information regarding the BCG artifacts, whereas an excessive number may be overly time-consuming. To address this issue, different buffer sizes (5, 6, 7, …, and 60) were tested to determine an appropriate buffer size (see Section 4).The number of principal components (PC number) selected to construct the optimal basis sets is another important factor for their real-time construction. If the PC number is too small, the components may be insufficient for extracting BCG artifacts; some information regarding such BCG artifacts may not be conveyed through the optimal basis sets. If the PC number is too large, more redundant information will be contained in the buffer window, making the buffered data larger and unnecessarily increasing the computational load, which prolongs the estimation procedure. Furthermore, the information in the original EEG signal may be included in the optimal basis sets and thus incorrectly removed. A series of simulated data with different PC number was adopted to investigate the suitable parameters (please see Section 4).After determining the buffer size and PC number, the first n (which is the PC number) principal components are taken as the optimal basis sets denoting the estimation of BCG artifacts found through the rtOBS method.For each update (window), after the construction of the optimal basis sets using PCA, the optimal basis sets (B) were then fitted to and subtracted from each BCG artifact occurrence [20]. A BCG artifact occurrence (Yer) can be written in terms of the optimal basis sets (B) as:(6)Yejr=Bβj+εj,where βjis a vector of weights estimated by the least squares when fitting B toYejr, and ɛjis the error term for each artifact occurrence.Next, when a new ECG R peak is detected, it indicates a new BCG artifact. The occurrence of this new BCG artifact and the occurrences of the previous k−1 BCG artifacts are aligned in a matrix, and PCA is applied again. A new optimal basis set is then constructed, fitted to, and subtracted from the BCG artifact occurrence. Each step is repeated for the next detected ECG peak. In our study, the input of the rtOBS removal was based on the real-time output of the Brain Vision Analyzer 2.0.1 (Brain Products corporation) which removed the gradient artifacts (GA) using a fixed-length window setup according to the stability and strict periodicity (TR=2s) of GA. Specifically, Brain Vision Analyzer adopted a standard procedure similar to rtAAS which subtracted the averaged GA from the signals. In our work, GA removal and BCG removal were two separated procedures.To evaluate the rtOBS method in terms of BCG artifact removal, a series of simulated data (S-Data) is generated through the addition of varying BCG artifacts to the original EEG data (see Fig. 1A, and Section 3.2 for more details), and by comparing the results after BCG artifact removal with the original EEG data before adding the BCG artifacts.There are three steps used to construct the S-Data. First, a BCG artifact template is generated through the averaging of all artifact trails from a real data set (see Fig. 1B and Section 3.2). Second, we both randomly and independently scale the BCG artifact template in terms of amplitude and time span using rates of 85–115% to simulate the varying BCG artifacts from trial to trial (Fig. 1C). Third, the scaled BCG artifacts are added to the original EEG data to generate the S-Data (Fig. 1D). In this way, both the interval between the peaks and their amplitude are randomized.The original EEG data were recorded using a 64-channel amplifier system (BrainAmp MR, Brainproducts, Munich, Germany), which is the same system used for recording the EEG–fMRI data but in the absence of an MRI environment. The system is capable of making recordings from 63 equidistant scalp sites mounted in a cap system (Easycap, Falk Minow Services, Herrsching, Germany). The EEG electrodes are referred to as REF and are placed between Cz and Fz on the scalp according to the international 10-10 system. The ground electrode GND is placed between Fz and Fpz. The wires in the coil are fixed using plastic clips and paper tape to avoid artifacts caused by movement.One healthy subject with no history of neurological or cardiological disorders participated in this EEG experiment. The subject was instructed to lie still and awake with their eyes closed. The subject conducted no specific tasks.The EEG–fMRI and ECG data were recorded using a 64-channel amplifier system, which was especially designed for an MR environment (BrainAmp MR, Brainproducts, Munich, Germany, described above). Functional images were acquired on a 3T MR Siemens scanner with a T2*-weighted EPI sequence (TR=2000ms, TE=30ms, 32 slices; matrix size=64×64; acquisition voxel size=3.125mm×3.125mm×3.84mm; flip angle (FA)=90°; field of view (FOV)=190–200cm) using a standard head coil. 300 TR data were collected. The head of each subject was immobilized with a vacuum pad to reduce involuntary movement during the entire experiment.For the simultaneous EEG–fMRI experiment, eight healthy subjects (20–35 years in age, right-handed, four females, four male) with no history of neurological or cardiological disorders were used. The subjects were instructed to lie still and awake at rest inside the scanner with their eyes closed. No specific tasks were assigned to them.

@&#CONCLUSIONS@&#
In this study, a novel real-time OBS technique was introduced for the real-time removal of BCG artifacts. In this framework, a real-time ECG R-peak detection procedure was employed, and a sliding window was adopted; in addition, by applying the sliding window, the artifacts were removed using the OBS in real-time. The results of both simulated data and real EEG–fMRI data demonstrate the effectiveness of rtOBS in both the time and frequency domains. A comparison between the rtOBS and rtAAS methods also suggests the efficacy and advantage of rtOBS for real-time BCG artifact removal.