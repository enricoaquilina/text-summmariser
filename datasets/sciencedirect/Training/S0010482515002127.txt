@&#MAIN-TITLE@&#
Maximum sphere method for shell patency measurements in viviparous land snails based on X-ray microcomputed tomography imaging

@&#HIGHLIGHTS@&#
A new method of measuring cavities is proposed.Described algorithm shows its unique behavior steering by selected settings.The method proves usability of solution in measuring snail’s shell patency.The definition of snail’s shell can be successfully carry on based on XMT images.Results of have been shown using land snail samples and test models.

@&#KEYPHRASES@&#
Gastropoda,Three-dimensional morphometry,X-ray microcomputed tomography,Digital image processing,Snail׳s shell,

@&#ABSTRACT@&#
This article presents the working principle of an algorithm designed for the purpose of examining a section of the snail shell canal. The procedure of scanning the specimens is described as well as the tests performed using the proposed algorithm. Also, the digital models used for testing the algorithm are described. The article contains a description of the initial processing of the data, including segmentation and detection of the edges of the image. A flowchart of the algorithm is presented together with its implementation. The data obtained in the course of the microtomographic scanning of one of the snails and a digital model of a canal created for this purpose were subjected to the application of the measurement algorithm. This algorithm was aimed at conducting a spatial analysis of the varying dimensions in the canal section. The process of applying the algorithm and the measurement errors are presented and discussed on the basis of the results.

@&#INTRODUCTION@&#
Measuring physical dimensions of biological structures can be difficult due to their complex shape. While 2-D measurements can be done manually, three-dimensional structures require a novel approach. Microscopic methods can be applied for analysis of 2-dimensional sections; however, this approach requires destructive sectioning of the sample. For objects that can be observed using X-rays, radiography and more advanced methods can be applied, like X-ray tomography and microtomography (high-resolution tomography) [1]. The biggest advantage of X-ray microtomography is its high resolution and its ability to avoid destruction of the inner structure. Utilization of XMT images is usually followed by digital image analysis, including segmentation of the object from images and further structure analysis. What is important here is not only the technical skills required to perform the measurements but, above all, knowledge of the purpose of the measurements.An example of a complex three-dimensional structure is a snail shell. Shell morphology analysis often provides crucial information used in evolutionary, taxonomic, and paleontological studies; however, very few features of the morphological shell structure occur with a discrete morphology. More frequently, the spatial structure is important as it is used for identifying species [2].In the past, snail shell measurements were limited mainly to 2-D measurements. It was not until 1966 that a breakthrough study on theoretical shell morphology [3] allowed for simulation of its growth by means of four geometric parameters. The first studies on the theoretical shape of snail shells were performed as late as 1971 [4,5]. Also, other researchers dealt with the theoretical shell model [6–8]; however, all the created models are merely approximations. In particular, the shell aperture is generalized in these models.In 2009, a method of measuring the snail shell canal was proposed based on its skeletonization and cross-sectioning of the skeleton [2]. In our studies, we tested the skeleton-based approach, but due to the vast number of samples and wide range of shell morphology types, this approach provided poor results. It required numerous parameters to be set before the measurements, and thus could not be applied by untrained personnel. Also, there was a problem with numerous branches appearing as a result of image noise [9–11].In this study, with the application of a specially designed algorithm [12], the changes in a section of the snail shell were measured. In contrast to the simple external structure, the shape of many snails shells is quite complex in terms of its internal structure [6,12]. It is particularly noticeable in snails of the Clausiliidae family, in which there are rigid projections on the internal walls of the shell canal called “denticles” and a special flexible spoon-shaped plate, which closes the shell canal when the snail withdraws and which is ajar while the animal is active. Because of a danger of drying out, or a predator attack, the shell canal is narrow in the Clausiliidae, and the closing mechanism with the spoon-shaped plate closes the shell aperture tightly. Because there was no ready-to-use procedure (e.g., software method or plug-in) for measuring the size of the shell channel, a new algorithm was written, implemented and tested. We could not compare our results with other working solutions without implementing those other methods ourselves. Thus, instead of implementing known methods, we focused on finding one solution that could also be applied to other channel-like systems in the near future.Among snails from the Clausiliidae family, there are also viviparous species (giving birth to offspring with firm oval or spherical shells); therefore, it was hypothesized that the change of the reproductive strategy in these snails was associated with the necessity to increase shell patency and to adjust it for the passage of offspring during labor [13]. During delivery, the shelled embryos travel along the coiled shell canal, whose width is further limited by the protruding denticles.Due to the need for a method of measuring shell patency in several Clausiliidae species, a method was proposed that consists of following the route along the shell canal and measuring the maximum radius of a sphere (i.e., a shape resembling a snail embryo) that could be inscribed into this canal at a fixed point. This algorithm solves a problem similar to that which was proposed by Chaudhuri [14]; however, in our approach, the user is able to set parameters in such a way that the algorithm can select a path along the forward direction and omit the local maxima of canals occurring to the side of the main path. In case of our study, we encountered a problem, where, sometimes, depending on how the parameters were set, the algorithm provided us with different paths. In such cases, the proposed approach allowed us to easily change the settings and force the path of the measurement to coincide with the actual path of a nascent snail [15].The aim of the article was to describe the designed algorithm, present the results of its execution on preserved biological material and in model cases, and to analyze its execution time. This algorithm was implemented using the Matlab environment (version 7.02) and its basic functions [16]. The description of the algorithm’s implementation is subjects for a future article.The algorithm was successfully applied for measurements in the study on viviparous snails of the Clausiliidae family [13]. Thanks to this algorithm, results were obtained that proved the proposed hypotheses. The research carried out proved the usefulness of the algorithm in the performance of such measurements.The shells used in the study were of land snails of the Clausiliidae family from central Europe. The snails, coming both from breeding laboratories and field collection [13], were preserved in 70% alcohol. The preservation was conducted so that the soft part of the snail’s body would slide partly out of the shell, resulting in a wide-open shell canal (with the plate ajar) as in the period of a snail’s activity (Fig. 1).In order to create a set of sections, a microtomography scanner (GE Sensing & Inspection Technologies, Phoenix|X-ray, Wunstorf, Germany) was used. The scanning was performed in the X-ray Microtomography Lab, Department of Biomedical Computer Systems, Institute of Computer and Material Science, University of Silesia (Chorzów, Poland).Each specimen was scanned separately, with the shell aperture directed upwards in a vertical position (Fig. 2). Due to the low absorption of X-ray radiation by the snail shell, the fixation was based on using low-density material so as to reduce artifact occurrence at the site of contact between the specimen and the fixing material.During the scanning process, 1000 projections were made for each specimen. The outcome of the reconstruction of these projections, performed with the use of the software delivered with the scanner, Datos|x 2.0, were 8-bit data. These data were also recorded on a disc.The reconstruction algorithm Datos|x 2.0 was used for the reconstruction of cross-sectional images based on the filtered backprojection method. The scanning parameters are presented inTable 1.Scanning of the specimens was the first of the five main stages of the designed algorithm.The initial input data for the algorithm is a segmented three-dimensional image – that is, a set of reconstructed sections representing the snail shell canal – which is subject to measurements.It was assumed that the segmentation process should be separated from the measurement process. This is in accordance with the strategy of designing algorithms so as to ensure their greater universality. The segmentation of the snail shell was done in the Avizo application with the use of basic segmentation procedures such as region growing and global threshold[17].As a result of the segmentation, a mask representing the snail shell was obtained (Fig. 3B).A significant acceleration of calculations with the simultaneous maintenance of full measurement accuracy can be obtained by subjecting the data to edge detection (Fig. 4C). In the case of the algorithm used in the study, this procedure was performed with the aid of the Sobel operator [17] in planes perpendicular to the snail’s central axis.The input data for the algorithm can be either a mask of the segmented shell or just the detected edges of the shell. With the aid of such a mask, the applied algorithm will check the image iteratively in search of pixels representing the canal wall, ignoring those that represent the interior of the shell or the snail’s external environment. At the same time, the outcome of the calculations will be influenced by the boundary pixels of the shell only (its edges); therefore, calculations will take a shorter time if a mask representing the detected edges only is used.The algorithm designed for the purpose of this study is presented as follows.Apart from the image of the edge of the segmented shell, the values necessary to start the algorithm are the first two measurement points understood as x, y, z coordinates. They are required to determine the beginning of the examined canal and the direction in which it will be measured. The other parameters of the algorithm are the number of the inscribed spheres, the step after which the next sphere will be measured, and coefficients of determination of the spheres. Setting these parameters in many cases can be simplified to definite universal values. For instance, the last step by which the shift will be done from the nearest wall should be no bigger than 1pixel, and the distance along which the next center of a sphere is to be shifted should be no bigger than approximately 10% of the diameter of the previously inscribed sphere. Setting these parameters is aimed merely at accelerating the execution of the algorithm or increasing its accuracy. It is important to bear in mind that an increase in accuracy entails an increase in the execution time of the algorithm.Due to the complex shape of the examined canal, the best solution is to inscribe a sphere into the canal. A sphere is the shape most resembling that of a snail’s embryo, which passes through this canal. Thus, the algorithm should measure the diameter of the biggest sphere that can be inscribed into a given point of the canal. This point is taken as a place equidistant from the nearest pixels of the canal walls. The algorithm residual is mainly dependent on the segmentation method. The segmentation process, in this case, is based on a histogram, so it is fairly accurate given that the sample has a relatively high density in comparison to its surroundings. The other measuring error is in regard to image resolution, which is limited by the scanner parameters and size of the object. Our resolution is limited to 4.94µm, and our sample is scanned at the maximum resolution possible by the XMT scanner with a flat panel detector, and assuming a scan time no greater than 20min. The measuring method itself introduces another error as a result of pixel size and user settings. This error is based on the last step involved in moving the sphere, and it is always some fixed distance, measured in number of pixels. Depending on the user, it may be any number, including 10, 5, 1 or even half or a quarter of a pixel. Because it may be a fraction of a pixel, it is negligibly small in comparison to former errors of segmentation and image resolution.The output data of the algorithm is a 3-D image with the measured spheres marked (Fig. 7) and a file containing x, y, and z coordinates for the center of each sphere detected as well as its radius and distance from the previously measured sphere.In the case of the applied algorithm, the output files were saved as .vol for the spatial image and .xls for the measurement data.On the basis of two input points marked A and B (Fig. 5a), the algorithm calculates a collinear point C at a specified distance k (Fig. 5a). Most often, point C has not yet been situated in the local center of the canal; however, in the case of such a situation, the central point of a newly created sphere will start to oscillate around the local center of the canal with each shifting step, and the distance between it and the previous point B will never be greater than the declared shifting step. Having analyzed the whole image, the element (voxel) of the canal wall is detected that is closest to point C on the basis of the Euclidean distance given by:(1)d(A,B)=(XA−XB)2+(YA−YB)2+(ZA−ZB)2On the basis of these two points (point C and its nearest voxel), the algorithm converts the Cartesian coordinates into the spherical system with the assumption that point C is the central point (point 0,0,0). The newly determined spherical coordinates are subject to the following operations:–the coordinate of the position vector is changed into the length of the shifting step k′, which will shift the point away from the nearest part of the wall;180° is added to the coordinate of the angle; andthe sign of the elevation coordinate is reversed.After reconversion to the Cartesian system, coordinates of point C′ are obtained, which is distant from the nearest part of the wall by step k′. This procedure is repeated a specified number of times, which leads to the locating of point C in the local center of the canal (Fig. 5c).Formulas allowing for conversion from the Cartesian coordinate system to the spherical one are as follows [17]:–for the rotation angle:(2)Th=rctgyxfor the elevation angle:(3)Phi=acsinzrFor the position vector r, the formula mentioned above (1) for the Euclidean distance is used. Reconversion to the Cartesian coordinate system is given by [18]:(4)X=rcos(Phi)cos(Th)(5)Y=rcos(Phi)sin(Th)(6)Z=rsin(Th)After a specified number of iterations, point C is assumed to be in its new location in the local center of the canal. It also appears from this assumption that the sphere with its center at point C and radius understood as the distance to the nearest located part of the canal makes the biggest possible sphere that can be inscribed into this place.On the basis of points B and C, a new point D is calculated that is collinear with points B and C, and distant from point C by the length of step k (Fig. 5d). This point, like point C previously, is then shifted iteratively in the opposite direction to the nearest located canal wall (Fig. 5e). Then, using points C and D, point E is determined. Iterative repetition of these procedures is presented in the subsequent figures (Fig. 5f–h)The algorithm can terminate in one of two ways:–after the specified number of spheres has been reached;after an attempt to place the next sphere at a point exceeding the range of data.The algorithm was tested using a model of a simplified canal in order to check the accuracy of the execution of the implemented procedures. The canal model was created by generating a simple digital structure of a square cross-section (length of the square equal to 1001pixel, and length of the canal equal to 900pixel). In addition, a non-linear canal was generated, whose width was 49pixel, and length 1000pixel. The algorithm was started with three different values of step k (5, 2, 1) for moving a sphere (Fig. 6).The model used to present the proceeding of the algorithm in the case of a diverging canal is presented in Fig. 10.The algorithm was designed to perform measurements in non-diverging canals. In the case of a dichotomous canal that divides into branches of equal diameters and the same angle of departure from the original route, the choice of the branch measured by the algorithm will be random, with very little user’s input regarding this choice; however, if the canal divides into two uneven branches, the algorithm due to its method of execution will prefer a canal of a bigger diameter, branching off at a smaller angle to the original route of the canal.The algorithm was used to examine about a dozen specimens, and in each case it returned correct results. In order to illustrate the execution of the algorithm, a Balea perversa snail (Fig. 7) was selected from among these specimens, characterized by having the simplest shell structure and no spoon-shaped plate closing the canal.

@&#CONCLUSIONS@&#
