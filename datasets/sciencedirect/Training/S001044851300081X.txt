@&#MAIN-TITLE@&#
A novel geometric flow approach for quality improvement of multi-component tetrahedral meshes

@&#HIGHLIGHTS@&#
A mesh quality improvement method for multi-component tetrahedral meshes is proposed.A multi-component tetrahedral mesh with non-manifold boundary is more difficult to improve.Both location and connection of mesh vertices are optimized.All tetrahedra are positive and well-shaped after quality improvement.Boundary meshes are smoothed and regularized with shape-preservation.

@&#KEYPHRASES@&#
Multi-component tetrahedral mesh,Mesh quality improvement,Geometric flow,Mesh smoothing,Shape-preserving,

@&#ABSTRACT@&#
This paper presents an efficient and novel geometric flow-driven method for mesh optimization of multi-component tetrahedral meshes with non-manifold boundaries. The presented method is composed of geometric optimization and topological transformation techniques, so that both location and topology of mesh vertices are optimized. Due to the complexity of non-manifold boundaries, we categorize the boundary vertices into three groups: surface vertices, curve vertices, and fixed vertices. Each group of boundary vertices is modified by different shape-preserving geometric flows in order to smooth and regularize boundary meshes. Meanwhile, all vertices are relocated by minimizing an energy functional which is relevant to the quality measure of tetrahedra. In addition, face-swapping and edge-removal operations are employed to eliminate poorly-shaped elements. Finally, the performance of our method is compared with a state of the art technique, named Stellar, for a dozen single-component meshes. We obtain similar or even better results with much less running time. Moreover, we validate the presented method on several multi-component tetrahedral meshes, and the results demonstrate that the mesh quality is improved significantly.

@&#INTRODUCTION@&#
Unstructured tetrahedral meshes for complex three-dimensional domains have been recognized as indispensable representations in various application fields, including computer graphics, finite element simulations, and partial differential equations. Since mesh quality is an extremely critical factor influencing the stability, convergence, and accuracy of the numerical solution, tremendous efforts have been made to achieve better mesh quality. However, it is still a challenging problem to generate quality meshes for complicated structures with non-manifold boundaries. In finite element analysis, research objects are often segmented into multiple regions with respect to different physical attributes, chemical attributes, or material properties. Thus, quality multi-component meshes, with conforming non-manifold boundaries, are needed for partitioned regions. In this paper, we focus on quality improvement of multi-component tetrahedral meshes with boundary surface smoothed and shape preserved.The advancing front technique  [1], octree methods  [2,3], and Voronoi Delaunay-based methods  [4,5] are well studied techniques in unstructured mesh generation. Several mesh generation methods  [6–11] for segmented multiple regions have been developed in recent years. Unfortunately, these techniques cannot avoid the existence of distorted elements efficiently. Therefore, a post processing step is desired to improve quality of the meshes produced by automatic mesh generators.The existing methods for mesh improvement fall into three typical categories  [5,12]: vertex insertion, topological transformation, and geometric optimization (also called mesh smoothing). It is intuitive to eliminate poor elements by inserting vertices into meshes, therefore, the vertex insertion methods are powerful for improving mesh quality. These approaches intend to find the optimal position for a newly inserted vertex to improve local elements  [13]. However, adding vertices will increase the number of mesh elements. Hence, a good insertion technique must result in a low vertex increment. In topological transformation, several operations have been used to reconnect vertices such that a set of adjacent elements is replaced by another set of elements with higher quality. Operations like edge/face swapping  [12] and edge/multi-face removal  [14,15] are usually local, easy to implement, and effective in removing poor elements. The effect of mesh quality improvement is also limited since reconnections are considered within small regions. To alleviate the limitation, a new reconnection way was proposed in  [16] to repartition relatively larger polyhedra composed of 20–40 tetrahedra. There are mainly two types of mesh smoothing methods: Laplacian smoothing and optimization-based smoothing. Laplacian smoothing  [17] is simple and inexpensive, but it does not guarantee an improvement of the mesh quality characterized by a certain quality metric, and may result in degraded or inverted elements. Thus, various optimization-based methods were proposed. In these approaches, the objective function is based on a quality metric such as solid angle  [18], dihedral angle  [14], Jacobian matrix  [19], or condition number  [20]. In addition, Chen et al.  [21,22] defined the interpolation error as the quality metric based on the concept of optimal Delaunay triangulation.Surface smoothing is an important step of mesh improvement, since the generated meshes are often bumpy and irregular on the boundary surfaces. In the process of mesh smoothing, surface features should be well preserved rather than smoothed by being treated as noise. Therefore, shape-preserving approaches were developed rapidly. Geometric flows  [23] have the powerful ability to preserve features and reduce volume shrinkage. The surface diffusion flow which keeps the object volume invariant was used in  [24,25] to remove bumpiness by evolving surface vertices along the normal direction. Moreover, a surface fitting technique and curvature information were applied to surface smoothing in  [26].In this paper, we present an efficient and novel geometric flow-driven method for mesh optimization of multi-component tetrahedral meshes with non-manifold boundaries. Vertices of the input meshes are classified into four groups: fixed vertices, curve vertices, surface vertices and interior vertices. Different vertices are handled by different strategies. For curve vertices, a shape-preserved curve diffusion flow is used to fair curves, and vertices are also modified along the tangential direction to achieve equi-distribution on curves. The averaged mean curvature flow, with the property of volume-preserving, is selected to remove bumpiness of surfaces by moving surface vertices along the normal direction. Meanwhile, an optimization objective function is defined to regularize triangular surface meshes. An optimization-based method, with the objective function reflecting tetrahedron quality, is applied to improve all tetrahedra in the meshes. These approaches can improve the overall mesh quality efficiently, but some poorly-shaped elements still exist, because some vertices have bad valence. Hence, topological transformations like face-swapping and edge-removal are joined into the mesh improvement process. The experimental results demonstrate that the presented method improves mesh quality significantly and preserves surface boundary features efficiently. A preliminary version of this paper has been published in Proceedings of the 20th International Meshing Roundtable  [27].The remainder of this paper is organized as follows: in Section  2, we introduce the problem description and preparation work for mesh improvement; Section  3 presents quality improvement algorithms and implementation details; several application examples are given in Section  4 to demonstrate the effectiveness of the presented method; and conclusions are drawn in the end.This section gives a description of the quality improvement problem for multi-component tetrahedral meshes. Before performing the mesh optimization algorithms, some preparation work is needed.Suppose we are given a multi-component tetrahedral meshTinR3, which is composed of several volumetric components{Ti}conforming at the common boundaries. Our goal is to modify the location and connection of mesh vertices so that all tetrahedra are regularized as much as possible. On the other hand, the given mesh is often bumpy and irregular on the boundary. Hence, we also intend to fair and regularize the boundary mesh with the shape preserved.Quality improvement of segmented multi-component meshes is much more challenging than that of meshes with one single component. Improvement strategies should differ from vertex to vertex, due to the complexity of non-manifold boundary. Several requirements must be satisfied. Vertices on the boundary cannot be relocated freely during the improvement process, in order to keep the boundary shape feature. Since a bumpy boundary is usually introduced by image segmentation or low resolution volume data, the mesh boundary should be smoothed. Meanwhile, boundary smoothing should be volume-preserved, which means each component cannot occupy the territory of its neighboring components. Many applications emphasize the quality of the boundary triangular meshes in particular. Hence, we need to pay more attention to surface smoothing and boundary mesh improvement in this paper.For a given tetrahedral mesh, a position vector and a boundary indicator are given for each vertex, where the boundary indicator indicates if it lies on the boundary or not. Each tetrahedron is expressed by a list of its vertices in order. From the last vertex point of view, if the remaining three vertices are in the counterclockwise order, we say this tetrahedron is positive. If the ordering of a tetrahedron reverses this rule, then it is considered to be negative or inverted. For the input tetrahedral mesh, all tetrahedra are assumed to be positive. In addition, a component index is provided for each tetrahedron indicating which component it belongs to. If a tetrahedron has a triangular face on the boundary, then two component indices are given as well, indicating which pair of components share this triangle.Due to the complexity of non-manifold boundary, we classify the vertices of a multi-component mesh into four groups, such that different improvement strategies can be applied to each vertex group. Before vertex classification, we first introduce the concepts of boundary surface patches, boundary curves, and corner vertices.Boundary surface patches: The common surface shared by any two components is referred to as a boundary surface patch. Besides, the exterior boundary of each component is regarded as a boundary surface patch as well. In Fig. 2.1, the mesh has twenty boundary surface patches, including twelve common surfaces and eight exterior boundaries.Boundary curves: The common curve shared by at least two boundary surface patches is referred to as a boundary curve, which is marked black in Fig. 2.1(c).Corner vertices: The common vertex of at least two boundary curves is referred to as a corner vertex, see the red points shown in Fig. 2.1(c).Then, we categorize the vertices into the following four groups:Interior vertices: Interior vertices are vertices inside one volumetric component.Surface vertices: Surface vertices are manifold vertices located on boundary surface patches, which can move along the normal direction to remove noise, and move along the tangent direction to improve the aspect ratio of elements.Curve vertices: Curve vertices are vertices located on boundary curves excluding end points. Curve vertices can move along the normal direction to remove noise, and move along the tangent direction of the boundary curve during regularization.Fixed vertices: Fixed vertices are corner vertices and other non-manifold vertices, which are fixed during the mesh improvement process.A number of quality metrics have been used to measure the quality of tetrahedral meshes, such as the longest-to-shortest edge length ratio  [3], the minimum dihedral angle  [14] or solid angle  [18], and the element condition number  [20]. Here, we choose the element aspect ratio(2.1)Q=8⋅352V(∑j=16ej2)32introduced by Liu and Joe  [28] to measure the tetrahedron quality. Here{ej}j=16are six edge lengths of one tetrahedron andVis the volume. We refer to (2.1) as the volume-to-length ratio measure. If the oriented tetrahedron is positive, then the aspect ratioQ∈[0,1], and the quality gets better asQis closer to 1.Q=1if and only if the tetrahedron is a regular tetrahedron.Fig. 2.2shows several examples of tetrahedra with poor quality. Tetrahedra (a) and (b) with one or two very short edges, can be recognized by all the above quality metrics. Four vertices of tetrahedra (c) and (d) are almost coplanar, but the ratios of the longest-to-shortest edge length are good. Tetrahedron (e) is slender but the minimum dihedral is far away from 0, so it cannot be detected by using the minimum dihedral angle as a quality metric. In contrast, the volume-to-length ratio measureQcan detect all the poor elements successfully.Another quality measure43A∑j=13ej2, which is referred to as the area-to-length ratio measure, is used to evaluate the quality of boundary triangles. Here,Adenotes the area of the triangle, and{ej}j=13are three edge lengths.Our quality improvement algorithm for multi-component tetrahedral meshes is composed of the following four parts:1.Boundary curve fairing and regularization by adjusting curve vertices.Boundary surface patch fairing and regularization by adjusting surface vertices.Mesh smoothing.Topological transformation.Let[x0x1⋯xn]be a boundary curve of a multi-component tetrahedral mesh, which is actually a polygonal line. Evolving the curve along the normal direction at the speed of curvature is a good approach to fair the curve, but it always results in curve shrinkage. It is known that surface diffusion flow can fair surfaces and keep volume invariant, which motivated us to construct the following curve diffusion flow(3.1)dxidt=−(Δκi)ni,i=1,…,n−1,where(3.2)κi=‖κi‖,κi=ti+1−tisi,ni=κiκi,si=‖xi−xi−1‖+‖xi−xi+1‖2,ti=xi−xi−1‖xi−xi−1‖,andΔis the Laplace operator.niis a discretization of the normal direction at vertexxi, and‖κi‖is the corresponding curvature. The discretization ofniand‖κi‖are obtained from the quadratic curve interpolatingxi−1,xi, andxi+1. The geometric flow (3.1) induces curve vertices to move along the normal direction, in order to fair the curve.It can be proved that for a closed spatial curve, flow (3.1) is arc-length shortening. The shortening stops whenκis a constant. If the curve is orientable, then the curve diffusion flow is area-preserving (see  [29]). Fig. 3.1shows the effect of the curve diffusion flow. The red curve is a given noisy spatial curve, after evolving by flow (3.1), we get a smooth and shape-preserved curve which is drawn in blue. For the soundness of the discretization of the curvature and normal, we cite the following theorem from  [30].Theorem 3.1Letx(u)be a givenC2smooth space curve. Assume that the curve is sampled atui−1,uiandui+1obtaining the curve pointsxi−1=x(ui−1),xi=x(ui)andxi+1=x(ui+1). Then the discretized curvature vectorκiand normalnigiven by   (3.2)   converge to the exact curvatureκ(ui)and normaln(ui), respectively, in the linear rate asui−1→uiandui+1→uiwith fixedui. Furthermore, ifui−ui−1=ui+1−ui, then the convergent rate is quadratic.Eq. (3.1) is solved using the explicit Euler scheme(3.3)xi(k+1)=xi(k)−τΔκini,i=1,…,n−1,whereτis a temporal step-size,xi(0)=xi, andx0(k)=x0(k+1)=x0,xn(k)=xn(k+1)=xn.κiandniare defined in (3.2), by takingxi=xi(k),i=1,…,n−1.Δκiis discretized as(κi+1−κi‖xi+1−xi‖−κi−κi−1‖xi−xi−1‖)/si, withi=1,…,n−1,κ0andκnare taken as zeros.Note that whenκi=0(namely the pointsxi−1,xiandxi+1are collinear),ni=00is not well defined. To overcome this difficulty, we redefinenias(3.4)ni=κiκi+ϵ,whereϵ>0is a small number, we take it as 0.001. Using the definition (3.4), we can show that the discretization schemes (3.2) for curvature and normal are stable, which means that a small perturbation of the points{xi}leads to a small perturbation of the discretized curvature and normal. This fact can be easily observed by noting that the discrete curvature and normal are sufficiently smooth functions of the points{xi}when the perturbation is small and no edge-length‖xi−xi−1‖vanishes.LetL=∑i=1n‖xi−xi−1‖. ThenLis the total length of the polygonal line[x0x1⋯xn]. We intend to regularize the curve such that vertices are uniformly distributed. Therefore we construct the following energy functional(3.5)E(C)=12∑i=1n(‖xi−xi−1‖−h)2,whereh=Lnis the average edge length of the curve. At each free vertexxi(i=1,…,n−1)of the curve, we varyxiasxi→xi+ϵiΦi,Φi∈R3,i=1,…,n−1. Then we obtain the first-order variationδ(E,Φi)=∂E(C,ϵi)∂ϵi|ϵi=0=(‖xi+1−xi‖−h)ΦiT(xi−xi+1)‖xi−xi+1‖+(‖xi−xi−1‖−h)ΦiT(xi−xi−1)‖xi−xi−1‖.To keep the shape features,xiis forced to move along the tangential direction. LetΦi=ei, whereeiis the unit tangential direction atxi, then we construct a set ofL2-gradient flows as follows:(3.6)dxidt+δ(E,ei)ei=0,i=1,…,n−1.The discretization of (3.6) can be written asxi(k+1)−xi(k)τ+(‖xi+1(k)−xi(k)‖−h)eieiT(xi(k)−xi+1(k))‖xi(k)−xi+1(k)‖+(‖xi(k)−xi−1(k)‖−h)eieiT(xi(k)−xi−1(k))‖xi(k)−xi−1(k)‖=0.The initial value is chosen asxi(0)=xi. Eacheiis obtained by computing the unit tangent direction of a fitting quadratic curve with respect toxi−1,xiandxi+1.To regularize a partitioned tetrahedral mesh, it is pre-requested that the volume of each component should be preserved. It is well known that for a compact (closed and finite) smooth surface, the averaged mean curvature flow is volume-preserving. However, the problem here is different because the boundary surface consists of several surface patches with fixed boundary curves. Hence, the volume-preserving property of the averaged mean curvature flow needs to be reconsidered.LetS0be a piece of compact orientable surface inR3with boundary denoted asΓ. A curvature-driven geometric evolution consists of finding a familyS={S(t):t≥0}of smooth orientable surfaces inR3which evolve according to the flow equation(3.7)∂x(t)∂t=vn(x)n(x),S(0)=S0,∂S(t)=Γ.Herex(t)is a surface point onS(t),vn(x)denotes the normal velocity ofS(t), andn(x)stands for the unit normal of the surface atx(t).Theorem 3.2LetV(t)denote the (directional) volume of the region enclosed byS(0)andS(t)(seeFig.  3.2for  2D curve case). Then we have(3.8)dV(t)dt=∫S(t)vndA.ProofThe directional volume enclosed byS(0)andS(t1)is actually the sweeping volume of the evolving surfaceS(t)during the time interval[0,t1]. That is(3.9)V(t1)=∫0t1[∫S(r)n(x)T∂x(t)∂t|t=rdA]dr.Substituting (3.7) into (3.9), we obtainV(t1)=∫0t1[∫S(r)vn(x)dA]dr.By taking its derivative with respect tot1, we havedV(t1)dt1=∫S(t1)vn(x)dA.Therefore, the theorem is proved.□In (3.7), if we takevn(x)=H(x)−h̄(t), whereH(x)denotes the mean curvature ofS(t)atx, andh̄(t)=∫S(t)HdA/∫S(t)dAis the average mean curvature of the surfaceS(t), then we have the Averaged Mean Curvature Flow   [31] (AMCF)(3.10)∂x∂t=[H(x)−h̄(t)]n(x),S(0)=S0,∂S(t)=Γ.The existence proof of the global solution to this flow can be found in Escher and Simonett’s paper  [32]. It follows from (3.8) thatdV(t)dt=∫S(t)(H(x)−h̄(t))dt=∫S(t)HdA−h̄(t)∫S(t)dA=0.Hence the averaged mean curvature flow is volume-preserving, and its steady solution depends upon the initial surface.Fig. 3.3shows the fairing effect of the averaged mean curvature flow. The left surface is a given noisy surface, the projection of its boundary to one plane is a rectangle. Evolving by (3.10), we get a faired and shape-preserved surface. We calculated the volume of the yellow regions in Fig. 3.3(a) and (b) respectively. The original volume is 3675.44, and the volume becomes 3676.83 after surface fairing (<0.04%change). The result demonstrates that the averaged mean curvature flow is volume-preserving.LetSbe a triangular surface patch and{xi}i=1Nbe its free vertex set. For a vertexxiwith valencen,N(i)={i1,i2,…,in}denotes the index set of one-ring neighbors ofxi. Eq. (3.10) is solved for the triangular meshSusing an explicit discretization method, where the discrete approximation of the mean curvature vector, mean curvature and surface normal are required. These approximations can be obtained from the quadratic fitting surface with respect toxiand its first-ring neighbors  [23,33]. Moreover, to computeh̄(t), the integration∫S(t)HdAcan be discretized as∑i=1N[H(xi)AM(xi)], whereAM(xi), as shown in Fig. 3.4, denotes the area represented byxi.A triangular mesh is referred to as regular if all its vertices are uniformly distributed and all triangles are well-shaped. Given a piece of triangular surface patchS, to make vertices on the surface equally distributed, we minimize the following functional(3.11)E(S)=12∑i=1N∑j∈N(i)(‖xj−xi‖−h)2.Here,{xi}i=1Nare free vertices in the triangular surface mesh,N(i)is the index set of the neighboring vertices connected toxi.h=(43A)12denotes the average edge length of the mesh, whereAis the average area of all the triangles in the mesh. At each free vertexxi, we varyxiasxi→xi+ϵiΦi, whereΦi∈R3,i=1,…,N. Then it is easy to deduce the following first-order variation formδ(E,Φi)=∂E(S,ϵi)∂ϵi|ϵi=0=∑j∈N(i)(‖xj−xi‖−h)ΦiT(xi−xj)‖xi−xj‖.Letei(1)andei(2)be two unit orthogonal tangential directions atxi. To preserve the surface shape, all the free vertices are forced to move on its tangential plane. LetΦi=ei(1)andΦi=ei(2)respectively, then we obtain two sets ofL2-gradient flows as follows:(3.12)dxidt+δ(E,ei(1))ei(1)+δ(E,ei(2))ei(2)=0,i=1,…,N.Eq. (3.12) is solved by an explicit Euler scheme for the unknownxi,i=1,…,N. Tangential directionsei(1)andei(2)can be computed from the limit surface of Loop’s subdivision  [34] or the quadratic fitting surface  [33]. The discretization of (3.12) can be written asxi(k+1)−xi(k)τ+ei(1)∑j∈N(i)(‖xj(k)−xi(k)‖−h)(ei(1))T(xi(k)−xj(k))‖xi(k)−xj(k)‖+ei(2)∑j∈N(i)(‖xj(k)−xi(k)‖−h)(ei(2))T(xi(k)−xj(k))‖xi(k)−xj(k)‖=0,withi=1,…,N.Discussion 3.1In the energy functional   (3.5) and (3.11),his a global constant over the curve/surface. Vertices located on the curve/surface tend to be equally distributed as the energy functional decreases. However, for the adaptive meshes with nonuniform vertex distribution, a localhishould be used for each free vertexxi. Then the energy functional   (3.5)   can be written asE(C)=12∑i=1n(‖xi−xi−1‖−hi)2,with localhi=12(‖xi−xi−1‖+‖xi−xi+1‖). Similarly, the energy functional   (3.11)   is replaced byE(S)=12∑i=1N∑j∈N(i)(‖xj−xi‖−hi)2,wherehican be chosen as(43Ai)12, andAiis the average area of triangles surroundingxi. In addition, either the globalhor the localhishould be updated during the iteration process of curve regularization and surface regularization. Note that, for the experimental results in Section   4, we adopt regularizing schemes based on energy functionals   (3.5) and (3.11)   with a global constanth.Remark 3.1To ensure that the vertex relocation will not result in inverted tetrahedra, we perform an explicit check in our mesh improvement algorithms. For each iteration step of geometric PDEs (3.1), (3.6), (3.10) and (3.12), if the vertex relocation inverts any tetrahedron, the step-sizeτof the corresponding discrete schemes is reduced by multiplying a predefined factor 0.618, until no inverted tetrahedron is produced.In the mesh improvement literature, most techniques define an objective function with respect to a certain mesh quality, and use the optimization method to relocate mesh vertices. Summarizing qualities of all the tetrahedra in the mesh is most frequently used for the objective function, since this kind of optimization problem is easy to solve. However, it cannot guarantee all tetrahedra have good quality. Penalizing the bad tetrahedra would be a good idea to overcome the existence of poor tetrahedra. Thus, we come up with the following objective function(3.13)E(x1,…,xN)=∑η∈Tmax(1Qη−q,0)p.Here,{xi}i=1Ndenote all vertices of the multi-component tetrahedral mesh,Tis the set of all tetrahedra in the mesh,Qηis the quality measure (2.1) of a tetrahedronη∈T,qandpare parameters.The parameterq≥1.0is a threshold to judge if the quality of a tetrahedron is good enough or not. All the tetrahedronη∈TsatisfyingQη≥1qare considered as good elements which do not need to be improved. LetTq={η∈T:Qη≤1q}, then we minimize the objective function(3.14)E(x1,…,xN)=∑η∈Tq(Q̄η−q)p.HereQ̄η≔1Qη∈[1,+∞). Note that, the active setTqis updated once a vertex is relocated. Tetrahedronηgets better quality whenQ̄ηis closer to 1, conversely,Q̄ηturns large as the quality ofηgets worse. The adjustable parameterpcontrols the strength of penalty assigned to tetrahedra. Selecting a smallp>0, the penalty for each tetrahedron is not significantly varied. Taking a largep, a tetrahedron with bad quality will be penalized rigorously, so the movement of vertex prefers improving a bad tetrahedron than a good one. In our experiments, the parameterpis chosen as 4, and the thresholdqis taken as10.9.The minimization problem of the objective function (3.14) is solved by updating vertices one after another. The objective function incident to vertexxiis(3.15)E(xi)=∑η∈N(i)∩Tq(Q̄η(xi)−q)p,whereN(i)is the set of tetrahedra sharingxi. Varyingxiasxi→xi+ϵΦ, we obtain the first-order variationδ(E(xi),Φ)=∂E(xi+ϵΦ)∂ϵ|ϵ=0=∑η∈N(i)∩Tq(Q̄η(xi)−q)p−1∂Q̄η(xi+ϵΦ)∂ϵ|ϵ=0.Apart from fixed vertices, all vertices are relocated to minimize the objective function (3.15). Interior vertices are relocated freely, boundary surface vertices are forced to move on the surface, and boundary curve vertices are forced to move along the curve.For an interior vertex of the multi-component mesh, the searching direction ofE(xi)is formulated asdi=−∑l=13δ(E(xi),e(l))e(l),wheree(1)=[1,0,0]T,e(2)=[0,1,0]T, ande(3)=[0,0,1]T.To keep the surface shape, surface vertices are forced to move on the surface. Ifxiis located on the boundary surface, the searching direction should be projected onto the tangential plane. Therefore, we derivedi=−∑l=12δ(E(xi),ei(l))ei(l),whereei(1)andei(2)are orthogonal tangential directions atxi.For a curve vertex, the searching direction is chosen asdi=−δ(E(xi),ei)ei,whereeiis the tangent direction of the boundary curve atxi.The searching direction for a fixed vertex is taken asdi=0.Then, we movexito the new position(3.16)xinew=xi+αdi‖di‖.Here,αis the step size which is properly selected such that the worst quality among tetrahedra sharingxiis improved.Discussion 3.2For optimization based mesh smoothing, the proposed algorithm makes three changes to our previous conference version   [27]. Firstly, the objective function   (3.15)   concerns neighboring tetrahedraηofxisatisfyingQ̄η≥q, which cuts down the computational cost, in contrast to the objective function in   [27]involving all tetrahedra surroundingxi. Secondly, the parameterpis adjustable compared to the fixedp=2in the conference version. Taking a larger parameterp, which imposes more penalty to bad quality elements, can suppress the number of bad tetrahedra. Thirdly, in the proposed algorithm, not only interior vertices are relocated, surface vertices and curve vertices are also modified along their tangential directions to improve their neighboring tetrahedra.Most experiments show that, even after geometric optimization, some less-ideal elements still exist in the mesh. Thus, reconnecting mesh vertices should be considered. Face swapping, as one of the most popular topological transformation, is used in our method for further improvement of the tetrahedral mesh. The following are some basic operations for face swapping.1.2–3 flip (Fig. 3.5(a)): Given two tetrahedra sharing a face, this operation connects the opposite vertices, and replaces the two tetrahedra with three new tetrahedra.3–2 flip (Fig. 3.5(a)): It is an inverse operation of 2–3 flip. The operation removes the common edge sharing by three tetrahedra.4–4 flip (Fig. 3.5(b)): If an edge in the mesh is shared by four tetrahedra, the operation swaps the edge and gets four new tetrahedra sharing the new edge.2–2 flip (Fig. 3.5(c)): If an edge on the exterior boundary is shared by two tetrahedra, the operation removes the edge and connects the opposite vertices on the boundary.These operations are simple and easy to implement. However, those operations only address the removal of edges with valence 3 or 4. For edges shared by more than four tetrahedra, the edge removal method  [15] is effective to remove them. The edge removal operation aims to replace one ring neighboring tetrahedra of the edge by some new tetrahedra with higher quality.The multi-component meshes generated by the octree-based method  [11] usually have structured interior tetrahedra, irregular elements only appear near the boundary. Thus we only need to perform the edge removal operation on boundary edges. Fig. 3.6shows the process of removing boundary edge[AB]. The gray area is an interior boundary. After removing boundary edge[AB], verticesCandDare connected to generate two new boundary triangles. The next step is to find an optimal triangulation for the two polygons that maximize the quality of the worst tetrahedron. The edge removal operation is implemented by performing a sequence of 2–3 flips followed by a single 4–4 flip. For the exterior boundary edge removal with half ring surrounding tetrahedra, the last 4–4 flip in the interior case should be replaced by a 2–2 flip.Algorithm 3.1 presents our topological transformation pseudocode for improving multi-component tetrahedral mesh. The input parameterεis an upper bound of the quality value, topological transformation is performed on the tetrahedron withQ<ε.Lis the maximum loop number. To improve a bad tetrahedron, we try to remove one of its edges or remove one of its faces, then the operation which can mostly increase the worst quality is selected. Note that, the face swapping or edge removal operation is not permitted if the boundary is ruined or the minimum quality of the new tetrahedra becomes worse.The outline of our mesh improvement implementation is presented in Algorithm 3.2. The following are our detailed explanations for such an implementation:1.Curve fairing should be carried out before curve regularization. This is very important because a curve vertex is claimed to move along its tangent direction during the regularization step, while the tangent direction cannot be calculated accurately for a non-smooth curve. Similarly, surface fairing should be performed before surface regularization.Curve/surface fairing and regularization are devoted to improving boundary triangle meshes, and during boundary mesh improvement, tetrahedral elements near the boundary may get worse. Thus, interior vertex smoothing is carried out after each curve/surface fairing or regularization step, see Lines 1, 3, 5 and 7 in Algorithm 3.2.Once the boundary curves and surfaces are smoothed, we concentrate on quality improvement of all tetrahedral elements in the mesh. Apart from fixed vertices, all vertices are relocated to minimize the objective function (3.15).Mesh smoothing and topological transformation are carried out alternately. The probability of getting stuck in a local optimum reduces to a certain extent. Once the mesh smoothing algorithm reaches a local optimum, the operation of topology transformation breaks it, and then mesh smoothing is performed and reaches another local optimum. Since our mesh smoothing and topology transformation strategies are hill climbing, the new local optimum would be better than the previous one.As shown in Line 11 of Algorithm 3.2, the maximum loop number is chosen as 2. The initial threshold for bad quality tetrahedra is chosen as 0.4, meaning that topological transformation is only performed on tetrahedron whose quality measure is less than 0.4. As mesh quality improves, the threshold increases gradually.An explicit Euler scheme is used to solve the geometric flows for curve/surface fairing and regularization, so the step size should be small enough. In our algorithm, at each iterative step, the displacement of each vertex is limited within 1% of the average edge length. If the step size is chosen such that the displacement is beyond that range, we adaptively reduce the step size. For curve/surface fairing, the evolution stops once the bumpiness is removed.In this section, we present several examples to show the efficiency of our proposed method. At first, our algorithm was tested on a dozen of meshes with one single component. The experimental results are compared with the published algorithm in  [35]. Then, we show several application examples of quality improvement for multi-component tetrahedral meshes. Our proposed method was performed on four meshes: two microstructure models, one biological model, and one human brain model. The input meshes were generated by an octree-based iso-contouring method proposed in  [11], with all tetrahedra positive. Our mesh improvement algorithm was implemented in C++, and all the experimental results in this section were carried out on a PC with an Intel Core 2.83 GHz CPU.The mesh improvement problem has been studied for several decades, many state of art softwares, such as Stellar  [35] and Mesquite  [36], were developed for improving the quality of single-component meshes. To the best knowledge of the authors, no existing paper focuses on improving tetrahedral meshes with multiple components. We first apply our algorithm to single-component meshes so that we can compare the performance of our proposed method with other single-component mesh improvement methods. Stellar, which is one of the most famous mesh quality improvement techniques, is selected here for comparison.The software Stellar applies three types of mesh improvement operations: smoothing, topological operations, and vertex insertion. The smoothing operation relocates vertices one after another. It aims to maximize the minimum quality value of the tetrahedra surrounding a specified vertex, here the volume-to-length ratio in (2.1) is selected as the objective quality measure which is consistent with our algorithm. Topological operations, including edge removal and multi-face removal, change the mesh by removing some tetrahedra and replacing them with new ones. The vertex insertion operation inserts vertices in bad tetrahedra. When inserting a vertex to a bad tetrahedron, a star-shaped cavity is created by deleting surrounding tetrahedra, and then the cavity is remeshed with new tetrahedra sharing this newly inserted vertex. Performing vertex insertion, the vertex number of the mesh may increase or decrease, and the probability of getting stuck in bad local optima is significantly reduced.To compare our proposed algorithm against Stellar, twelve mesh data provided by  [35] are tested. The boundaries of those meshes are either smooth or piecewise smooth. However, bumpy boundary curves or surfaces are always artificially introduced by image segmentation or limited resolution volume data. Hence, a randomly generated perturbation is added to the boundary vertices of the input meshes so that the boundary surfaces are rugged. Here, we choose the range of perturbation as 0.2 times the average edge length of the whole mesh. Before performing our algorithm, ridged edges are picked out and they form several curves. Then the mesh boundary is separated into several surface patches. In our algorithm, the vertex number is claimed to be fixed, so vertex insertion/deletion is not allowed here.The dihedral angle distributions of the meshes before and after improvement are shown in Fig. 4.1. In each box, the left histogram is the dihedral angle distribution for the input mesh, the middle one is for the improved mesh obtained by Stellar, and the right one is for the mesh improved by our method. The statistical data are listed in Table 4.1. The volume-to-length ratio measure and the dihedral angles are calculated for each tetrahedron. In addition, the area-to-length ratio measure and the triangle angles are calculated for boundary triangular meshes. Since the perturbation is added to the mesh boundary, the results of Stellar in Table 4.1 is different from that in Ref.  [35]. Based on the dihedral angle histograms and statistics results, we obtain the following conclusions.Firstly, for the mesh size, our proposed method preserves the number of vertices, and with a minor change of the element number. In contrast, to improve the mesh quality as much as possible, Stellar performs vertex insertion operations and changes the mesh size.Secondly, the performance of our proposed method is desirable, and it keeps pace with Stellar for several quality measures, including the minimum dihedral angle and the minimum volume-to-length ratio measure. The average volume-to-length ratio measure for the proposed method is comparable to Stellar for most meshes. For several meshes, such as mesh 4, 9, 10, 11 in Table 4.1, our results are even better than Stellar, due to different objective functions selected for mesh smoothing. Our objective function involves all bad tetrahedra surrounding the vertex, while Stellar just concerns the worst tetrahedron.Thirdly, our algorithm works better on the DRAGON and COW meshes compared with Stellar. DRAGON and COW are semi-regular meshes whose interior tetrahedra are regularly distributed, and bad quality elements just exist near the boundary. In this case, vertex insertion loses its superiority. On the other hand, boundary surface/curve vertices are adjusted along the tangential directions in our algorithm, so as to optimize the elements nearby the boundary. While Stellar does not relocate boundary vertices. Thus, our proposed algorithm is better in addressing meshes with structured interior elements than Stellar.Fourthly, the proposed method is not good at improving horrible input meshes, like mesh 5 and 6 in Table 4.1. RAND1 and RAND2 meshes are generated by inserting randomly located vertices into a cube. Since the quality of random meshes is poor, the proposed algorithm gets stuck in optima easily. Thus, we can deduce that the vertex insertion applied in Stellar is crucial and important for mesh improvement, because inserting vertices often breaks the resistance that cannot be broken by topological operations. However, generalizing vertex insertion to handle multi-component tetrahedral meshes is not straightforward. Most mesh generation approaches produce bad tetrahedra near the non-manifold boundary. Directly performing vertex insertion will ruin the boundary.Fifthly, our algorithm outperforms Stellar in terms of improving boundary meshes. The curve and surface fairing step in our algorithm contributes to yielding quality boundary meshes. Since the boundary is smoothed, a vertex located on the mesh boundary can move along the tangential direction to improve qualities of its neighboring tetrahedra. The algorithm of Stellar did not consider the boundary fairing and regularization problem, and the movement of a boundary vertex is allowed only if the vertex lies on a plane.Finally, for the computational time of the algorithms, we found that Stellar is time-consuming, since the vertex insertion operation accounts for most of the running time. Computational efficiency is the bottleneck of Stellar for large-scale meshes. In contrast, the proposed method is much faster. For mesh smoothing, Stellar only takes the worst tetrahedron into account, while in our algorithm, all bad neighboring tetrahedra are involved in modifying one vertex. Therefore, our algorithm takes more time on smoothing than Stellar. Furthermore, some of the execution time is spent on curve/surface fairing and regularization. Even so, the running time of the proposed method is competitive, compared to Stellar.The proposed method is validated on two titanium alloy microstructure datasets. The two datasets are composed of 92 grains (see Fig. 4.2(a)) and 52 grains (see Fig. 4.2(b)), respectively. Since the outline of the meshes are cuboid, we treat the eight corners as fixed vertices, and treat vertices on the cube edges as curve points which can only move along the edge.Performing our proposed algorithm, we obtain remarkably improved meshes. As shown in Fig. 4.3, boundary curves are well smoothed by the fairing technique introduced in Section  3.1. Curve vertices are faired by moving along normal directions and regularized by moving along tangent directions. Features are preserved for all the boundary curves. The red boxes in Fig. 4.4(b) and (d) indicate that boundary vertices are equally distributed after regularization steps, and sliver triangles near the boundary curves are eliminated. Fig. 4.5shows the improvement of interior boundary surfaces compared to the initial input mesh. It can be observed that, boundary surfaces of the initial meshes are rugged and irregular. After surface fairing and regularization steps, distorted triangles near the boundary curves are eliminated, and smoothness and regularity of surface patches are significantly improved.Dihedral angles and quality measureQfor each tetrahedron are calculated to measure the mesh quality, and the distribution histograms are plotted in the first and second columns of Fig. 4.6. The red bars mark the minimum and maximum quality values in the chart. Blue bars in the histograms denote the truncated bars, since the octree-based method generates structured interior elements so that extraordinarily high frequency comes up in some quality values. In addition, histograms of boundary triangle angles and area-to-length ratio values before and after improvement are plotted in the third and fourth columns of Fig. 4.6, respectively. Those distribution histograms demonstrate that the element quality of the whole meshes is favorable, and the effectivity of the proposed method is verified.The mesh quality statistics in Table 4.2show the improvement of mesh quality by geometric optimization and topological transformation. The improved I mesh in the table is just obtained by geometric optimization operations proposed in Sections  3.1–3.5. Without topology change, some poorly-shaped tetrahedra cannot be eliminated since some vertices with bad valence are never reconnected. In contrast, the improved II meshes derived from both geometric optimization and topology optimization are much better. After mesh quality improvement, we can see that the minimum tetrahedron quality increases to 0.26 and 0.36 for 92-grain mesh and 52-grain mesh, respectively. Meanwhile, the average quality values for both tetrahedra and triangles also increase significantly. The proposed algorithm is not time-consuming, several minutes are sufficient to address the 52-grain tetrahedral mesh with millions of elements.Volume difference for each grain is calculated to verify the volume-preserving property of the proposed method. The sum of absolute difference for 92 grain volumes is 2593.3, accounting for 0.1% of the total 92-grain mesh volume 2.49×106. The sum of absolute difference for 52 grain volumes is 243.5, accounting for 0.09% of the total 52-grain mesh volume 2.54×105.Our mesh improvement method is then validated on a biological dataset named group II chaperonin SubunitATcpnα, which is a type of chaperonin subunit of the Acidianus tengchongensis strain S5T. The tetrahedral mesh ofATcpnαas shown in Fig. 4.7is an 8-fold double ring structure, the two rings are closed and separated.Fig. 4.7 shows two different views ofATcpnαmeshes before and after quality optimization using our proposed method. It is clear that the boundary mesh is smoothed and regularized significantly. Comparison results are given in Table 4.2. The volume-to-length ratio measureQof all tetrahedra are more than 0.33, and the average quality increases from 0.68 to 0.78. The statistics of element quality are plotted in Fig. 4.8. The mesh volume changes from 60593.8 to 60700.0, with a difference of 0.18%.The fairing and regularization methods for boundary curves and surfaces introduced in Sections  3.1–3.4 can be used to optimize surface triangular meshes as well. Here, we give an example for improving triangular non-manifold boundary meshes of a brain model. The brain model is made up of 41 components, and the original triangular mesh consists of 97,295 vertices and 211,222 triangles. We apply techniques presented in Sections  3.1–3.4 combined with the edge flip operation to optimize the mesh.Fig. 4.9(a) and (b) show the exterior boundary meshes for the original mesh and the improved mesh, respectively. Surface patches belonging to different components are represented with different colors. It can be seen that, surface noise is removed successfully and triangles are much more regular. Fig. 4.10shows the improvement performance on interior surface patches. The distributions of mesh angles and triangle quality values are plotted in Fig. 4.11, where the minimum and maximum values are marked by red bars. After improvement, all angles of triangles are between 17.6° and 131.7°, and the average area-to-length ratio value increases from 0.82 to 0.91. The execution time for improving the brain mesh is 206.1 s.

@&#CONCLUSIONS@&#
We have presented a novel geometric flow method for quality improvement of multi-component tetrahedral meshes, with volume-preserving for each component. At first, mesh vertices are classified into four groups, and then each group of vertices is relocated by various optimization strategies. Moreover, face-swapping and edge-removal operations are applied to eliminate poorly-shaped elements by changing the topology of vertices. Finally, the performance of our method is compared with a state of art technique Stellar. Taking much less running time, we obtain similar or even better results compared to Stellar. Moreover, we validate the presented method on four datasets, and the experimental results demonstrate the effectiveness of our method for improving multi-component tetrahedral meshes.