@&#MAIN-TITLE@&#
Analysing, completing, and generating influent data for WWTP modelling: A critical review

@&#HIGHLIGHTS@&#
The literature provides a wide range of solutions for WWTP influent data generation.The challenge consists of selecting the most suitable solution for each situation.QRAs requires of generating influent data under hypothetical uncertain conditions.The phenomenological modelling integrates knowledge about the generating mechanisms.More detailed descriptions of the components in the catchment area are required.

@&#KEYPHRASES@&#
Activated sludge models,Influent generator,Influent disturbance model,Phenomenological model,Probabilistic design,Uncertainty assessment,

@&#ABSTRACT@&#
Graphical abstractSituation 1An engineer has an incomplete dataset (or no data) about the quantity and quality of the influent wastewater. She has some ideas about how the influent of the plant should be. She might also have some data about the catchment area.Situation 2An engineer has information enough about the quantity and quality of the influent wastewater. She would like to translate that into some ASM family model state variables. This is the so-called characterisation problem.Situation 3The engineer has information enough about the quantity and quality of the influent wastewater. However, that is only a single realisation of the problem. She would like to feature the uncertainty around these data and to generate other similar influent profiles.a)Is there any method to interpolate values so as to increase the frequency of some given WWTP influent data profiles?Yes, the method of Devisscher et al. (2006) based on the use of databases, or the ones of Langergraber et al. (2008) or Manina et al. (2011) based on the use of harmonic functions can help to complete some scarce datasets. Also, the phenomenological model of Gernaey et al. (2011) has been used with this propose (Flores-Alsina et al., 2013a; b).b)Is there any tool to derive influent WWTP data given some properties about the catchment area or the distribution of emission sources (households, industries, restaurants, dentists …)?Yes, the generator of Gernaey er al. (2011) provides influent data for urban WWTPs given the population and catchment area characteristics (PE, industrial load, sewer length, rain and temperature profiles, etc.). The generator of De Keyser et al. (2010) provides emission profiles expected from a given urban population (PE for households, road transport, restaurants, etc.). The former describes the effect of soil, first flush, sewer system, etc.; while the later is only concerned about the very source emission patterns providing profiles that can be used as inputs for sewer, WWTP, or surface water models.c)Are there some benchmark influent data profiles or simple models to generate influent data for urban WWTPs?Influent profiles for a WWTP of 100,000 PE are available at http://www.benchmarkwwtp.org/including dry, rain and storm weather conditions.The models of Langergraber et al. (2008) or Mannina et al. (2011) (based on harmonic functions) provide influent profiles for dry weather conditions. The former (Langergraber et al., 2008) is accompanied by a set of parameters among which the modeller can select those corresponding to the desired size of tin WWTP under study.d)Which would be the main references or tools to improve the understanding of the generating mechanisms in a given catchment area and their relationship with the WWTP influent data?Interesting results can be found in the research work conducted by Butler et al. (1995), Friedler et al. (1996a,b) or Almeida et al. (1999) about domestic wastewater generation. This research has been followed by the EU project ScorePP (www.scorepp.eu) (De Keyser et al., 2010) and the work of Ort et al. (2005) analysing the most general patterns of daily, weekly, and yearly emissions. Another good manner of proceed is to use the phenomenological model of Gernaey et al. (2011) and calibrate it for some given experimental data (as shown by Flores-Alsina et al. (2013)); or to study the very recent modelling proposal of Talebizadeh et al. (2014).a)Is there any standard protocol for performing WWTP simulation studies?STOWA (Hulsbeek et al., 2002), BIOMATH (Vanrolleghem et al., 2003), WERF (Melcer et al., 2003) and HSG (Langergraber et al., 2004) are well established protocols defining standard modelling steps such as: definition of objectives, general layout data collection and model selection, data quality control, simulation study, calibration/validation of models, assessment of the modelling application, etc. Improvements are described in Mannina et al. (2011) and Rieger et al. (2012).b)Is there any analytical procedure to characterise the wastewater in terms of ASM model variables?The STOWA, BIOMATH, WERF and HSG protocols include different methods to characterise COD and Nitrogen fractions. The main difference lies in the methods for the estimation of the COD fractions.c)Is there any standard, experience-based, manner to calculate ASM model components from typical experimental measurements (COD, TKN, NH4etc.)?Yes, the Benchmark Simulation Model No. 1 (Copp, 2002) includes a fractionation model in which the soluble and particulate components of the ASM1 model are estimated assuming fixed ratios. As an extension of that, Gernaey et al. (2011) proposes three different fractionation models to derive the state variables of ASM1, ASM2d and ASM3 models.d)Is there any kind of generalisation of the above estimations so as to use all the experimental measurements available (Turbidity, COD, pH, etc.) to derive the state variables of any ASM family model?Yes, Grau et al. (2007) proposed an optimisation algorithm that using as starting point a typical wastewater characterisation, leads to a consistent solution that minimises the difference with the provided experimental measurements. This solution is expressed in terms of an extended list of model components and can easily be translated into any set of ASM family state variables.a)How can the understanding of the uncertainty in the influent profiles be improved by analysing its sources?The main references for they are those of Friedler and Butler (1996) that analyses the uncertainty in the generation of domestic wastewater, and of Ort et al. (2005) that studies the stochastic load variations in sewer systems. While the first one analyses the different wastewater compounds and their relationships, the second one is more focussed on the timing of the emissions.b)In terms of model building, is there any manner to model the uncertainty in wastewater generation from its very source?Yes, the phenomenological mode of Gernaey et al. (2011) includes some uncertainty in definition of the households' pollutant profiles, in the industrial pollutant loads, in the rain generation, the temperature profiles, etc. The generator of De Keyser et al. (2010) also includes uncertainty from the sources by including random variables in the daily, weekly and yearly profile definitions. The approach proposed by Talebizadeh et al. (2014) includes two statistical models for the synthetic generation of rainfall series and the water quality influent profiles during dry weather conditions.c)Once a set of influent wastewater data is provided, is there any method to include some uncertainty over the time series that is coherent with its uncertainty?Yes, Carstensen et al. (1998) propose an Autoregressive First Order model to represent the uncertainty over the response of a second order Fourier model. Similarly, Martin et al. (2007) proposed the use of ARMA models to introduce uncertainty (white and coloured noise) over a set of given time series data. If the influent data profiles are the result of a model, other realisations of the time series data can be obtained by using Bayesian calibration of the parameters of this mode (see Bechmann et al. (1999) or Talebizadeh et al. (2014)).d)How can both approaches (in b and c) be combined?The understanding of the wastewater generating mechanisms and the uncertainty of their sources lead to solutions as the ones presented in b). However, the complexity of the problem will unavoidably lead to synthetic data profiles that do not represent the whole reality of the catchment area. The solutions pointed out in c) allow describing the uncertainty due to the remaining lack of knowledge.

@&#INTRODUCTION@&#
Wastewater Treatment Plants (WWTPs) are urban infrastructures that reproduce the biodegradation processes that naturally occur in rivers in an intensified manner. The high capital and operational costs associated to these facilities (Vanrolleghem et al., 1996; Liu et al., 2011; Rodriguez-Garcia et al., 2011) have fostered the use of simulation models to optimise their performance, and in this sense, the ASM family models (Henze et al., 2000) have become a standard. In the last years, many publications have illustrated the usefulness of simulation models for WWTP design (Bixio et al., 2002; Benedetti et al., 2010; Rivas et al., 2008); operation (Ostace et al., 2011) and control (Ayesa et al., 2006; Nopens et al., 2010; Flores-Alsina et al., 2008; Yong et al., 2006).One of the main limitations for a more widespread utilization of WWTP models is generally related to the scarce data sets measured at the inlet of the WWTP (Rieger et al., 2010a). The high cost (both in terms of workload and financial resources) related to experimental collection of an extended dynamic influent dataset is one of the main reasons. The use of on-line sensors still remains complicated, since the sticky materials of raw wastewater and the heavy deposit of pollutants make their maintenance cost considerable. Moreover, in view of risk analysis, models are generally used to predict the behaviour of the system under some hypothetical conditions (population growth; strong rain events; uncontrolled spills, etc.) for which real data might not exist.Influent data for municipal WWTP modelling consist of time series data of the flow and concentrations of the water quality parameters (COD, TKN, TSS, BOD, NH4, NO3, TP, PO4, etc.). These profiles depend on many factors: size of the catchment, type of the sewer system, number of person equivalents, industrial discharges, soil type, rainfall patterns, temperature, etc (Butler et al., 1995; Bott and Parker, 2010; Schilperoort, 2011). The complexity of the wastewater generation is so big that there is still no clear relationship between the generating mechanisms and the expected water quality profiles. The problem becomes even more difficult if the objective is a modelling exercise because the characterisation of the aforementioned lab measurements in terms of the components of the ASM family models is not straightforward. This paper gathers the solutions found in literature to analyse, complete, and generate influent data for WWTP modelling.This paper makes a critical review of the available techniques for WWTP influent data analysis and generation. It is intended to guide engineers in their particular situation to get the most of their experimental data (if any) in view of performing simulation studies of real or hypothetical WWTPs. The solutions found in the literature are classified according to three situations from engineering practice as shown in Box 1.The solutions in Situation 1 help to understand the information in the available data and to complete it on the basis of the patterns expected or of characteristics of the catchment area (temperature, population activity, etc.). The methods in Situation 2 include several protocols and mathematical techniques able to translate the generally available experimental measurements (COD, TSS, TKN, etc.) into ASM family components (SS, SI, XS, NH4, etc.). In Situation 3, we cover the scientific effort made to characterise the uncertainty of influent data profiles (Friedler and Butler, 1996) and the available techniques to generate other similar data series in a stochastic manner (Benchmann et al., 1999; Rousseau et al., 2001). Situation 1 and Situation 2 appear in any simulation study of a WWTP. Situation 3 follows the other two for simulation-based uncertainty analysis (usually performed by Monte Carlo techniques).Although most of these methods are intended for simulation analysis, some of the protocols for wastewater fractionation (Situation 2) are encouraged to be followed even if no simulation analysis is scheduled. For example, the STOWA protocol (Hulsbeek et al., 2002) presents a wastewater characterisation method that is very helpful for the daily WWTP operation (Roeleveld and van Loosdrecht, 2002) i.e., the authors explain that the soluble COD available will be related to the capacity of the plant for high nitrogen and biological phosphorus removal.Sections 3–5 of the manuscript describe the solutions found in the literature related to Situation 1, Situation 2 and Situation 3 respectively. At the end of each section, Box 2–4provide a list of the most frequently asked questions about the solutions. These boxes, although helpful and illustrative should not draw attention from the text since the manuscript includes more solutions and much more detailed explanations about the available methodologies and their advantages. Finally, Section 6 presents the methods presented in literature for calibration, validation and model performance evaluation of influent generation models; Section 7 discusses the models and methods presented, and Section 8 summarizes the main conclusions.Under Situation 1, we gather the techniques found in literature to analyse, complete, and generate influent data for WWTP modelling. Three groups of solutions have been identified. A first group of solutions consists of methods that are based on the construction of databases (Section 3.1). From these datasets general patterns are identified and used to complete or generate influent profiles of similar characteristics. A second group of solutions is based on the use of harmonic functions (Section 3.2). Under dry weather conditions, the influent wastewater concentrations follow stable trajectories related to daily and weekly patterns. In a third group, we describe those methods that provide a sufficient basis to advance towards the modelling of the wastewater generation mechanisms (phenomenological models) (Section 3.3). This classification follows an increasing modelling/conceptualisation effort from the data driven methods (solutions in Section 3.1) passing by very simple models based on harmonic functions (solutions in Section 3.2) to end up with the phenomenological models (Section 3.3).The most intuitive manner of generating influent data for WWTP modelling consists of gathering experimental data, understanding its main patterns and completing or generating new data on that basis. With regard to wastewater quality and quantity characterization many authors have gathered and analysed data at the very source (Butler et al., 1995; Almeida et al., 1999; Friedler, 2004); in the sewer system (Benchmann et al., 1999; Ort et al., 2005); and at the entrance of WWTPs (Günther, 2000; Siegrist et al., 1999; Petersen et al., 2002; Bott and Parker, 2010; Schilperoort, 2011). In this section we only cover the datasets compiled in view of creating influent generators.From a very practical perspective, Devisscher et al. (2006) proposed an influent generator as part of a methodology to assess the benefits of using advanced control in wastewater treatment plants. The generator is able to provide synthetic data by interpolating values within the same time window of the available data. With that in mind, they define a procedure in which correction factors are applied to represent the weekend and first flush events; available quality data are aggregated in the form of seasonal averages and redistributed on a day-to-day basis using a normal distribution; a daily pattern is applied to the flow rate; and (if necessary) daily flow rate values are generated from Poisson distributions. This pragmatic method results in profiles comparable with the available data and able to provide reliable simulation responses. As an example, Fig. 1shows simulated and real data of ammonium during a 365-day period. The same approach was adopted by Benedetti et al. (2008) in a set of tools to assess WWTP performance in a probabilistic way. The method was also employed as an influent generator (Gevaert et al., 2009) in a dynamic pollutant fate model.Another influent generator was proposed by De Keyser et al. (2010) within a framework of a pollutants release study in urban areas. In this case, the experimental data are gathered from an exhaustive literature review (Gevaert et al., 2008) and typical release patterns are defined based on expert knowledge. The generator is based on the development of a database with a structure and quantitative description of emission sources and their patterns on a typical daily, weekly, and yearly basis. The generator is able to provide profiles of Priority Pollutants (PP), generic pollutants (nutrients, suspended solids and COD), and wastewater flow rates by using: a phenomenological description of the PP release based on individual events which are modelled as random peaks that become bell-shaped by being transported in the sewer network (Ort et al., 2005); typical patterns identified in literature (Gevaert et al., 2008); a dry weather flow generator (based on Gernaey et al., 2006); and adding two different types of stochasticity (Section 5). Fig. 2shows an example of synthetically generated daily profiles for generic pollutant fluxes.The generator of Devisscher et al. (2006) interpolates influent data by increasing the data frequency for given dataset (and given properties of the catchment area). It does not, therefore, have any capacity to adapt the output to different catchment properties (for example, different person equivalents, soil properties, etc.). On the contrary, the generator of De Keyser et al. (2010) generates dynamic influent data profiles by aggregating punctual emissions. The characteristics of these emissions are coherent with the person equivalents in the catchment area, weekly profiles, daily maximum peaks, etc. as specified by the user. The model is based on emission patterns and does not consider (it was never its objective) properties related to the climate, soil or sewer system.Although both approaches propose the use of datasets to generate influent wastewater data, the contexts and scopes are very different. The approach of Devisscher et al. (2006) was motivated by the effort of the Aquafin wastewater utility for managing, monitoring and controlling more than 100 WWTPs in Flanders (Belgium). In this case, the generating approach acts as an ad hoc interpolator for wastewater quality parameters. The generator of De Keyser et al. (2010) is motivated by a European research project that looks for international consensus for controlling the release of priority and common pollutants. In this case, the dataset is based on expert knowledge and bibliographic data. The generating procedure is much more descriptive and can be used even for simulation studies where no experimental data is available.A pioneering approach of using harmonic functions in the context of WWTP modelling was proposed by Carstensen et al. (1998). They used a second order Fourier approximation to feature the daily profiles of the influent flow and to forecast the hydraulic load one hour ahead. Based on a similar idea, other authors (Langergraber et al., 2008; Mannina et al., 2011) have proposed the use of Fourier equations to feature the wastewater quantity and quality at the inlet of a WWTP.The Fourier-based models are generally used to describe the patterns of the wastewater under dry weather conditions. These models are very useful to interpolate hourly values given average daily data (Mannina et al., 2011) or simply to complete the available data (Langergraber et al., 2008). The influent model proposed by Mannina et al. (2011) (already outlined by Mannina and Viviani, 2009) introduces the moving average concept to account for inter-daily variation. The generator provides hourly values for 43 days (based on 43-day average daily data in their case study) by introducing a moving average value that draws a straight line between two given daily averages on top of which the third order Fourier-based dynamics are added. In a simpler Fourier modelling framework, Langergraber et al. (2008) assumed that the overall wastewater results are the sum of different streams (infiltration water, urine with flush water and domestic wastewater without urine) which can be modelled as second order Fourier models. The authors investigated the dependence of the Fourier model parameters on the WWTP size by analysing data from 19 urban WWTPs of different sizes, and they provided approximate values of these parameters for any other plant under study. The model parameters were estimated by using the minimum and maximum values of flow and concentration and their timings as boundary conditions. Fig. 3shows a comparison between the modelled and measured (a) daily flow profiles and (b) daily concentrations of COD and TKN.Spering et al. (2008) used the same approach as Langergraber et al. (2008) to perform dynamic simulation studies during the design of new WWTPs where no dynamic influent data is available. Alex et al. (2007) demonstrate the validity of these designs since they are in agreement with the design solutions proposed by stationary design rules (ATV-DVWK-A (ATV, 2000)). The same tool (Langergraber et al., 2008) is also recommended to perform simulation studies for control and operation of WWTPs (Alex et al., 2009). The authors claim that the method is especially useful when limited budget is available because meaningful results can be obtained with very little measurement effort.The characterisation of the quantity and quality of the wastewater entering a WWTP involves phenomena of very different nature: rain, soil type (permeable or impermeable), invert level, temperature, population activity, industrial discharges, type and length of the sewer system, retention tanks, etc (Butler et al., 1995; Bott and Parker, 2010; Schilperoort, 2011). Trying to define a mechanistic model able to describe all these elements is nearly utopian. A more feasible (although still ambitious) objective consists of developing a phenomenological model able to represent the patterns observed without aiming for a detailed characterisation of the underlying generating mechanisms. Such effort should continuously move forward step wisely, incorporating basic knowledge about the causes and dynamics of the driving forces and behaviours.The household activity constitutes an important contribution to the wastewater received by WWTPs. In this respect, an important analysis of the domestic wastewater was carried out in England in the nineties (Butler, 1991, 1993; Butler et al., 1995; Friedler et al., 1996a,b; Almeida, 1999). The effort culminated in the presentation of a general methodology (Almeida et al., 1999) (previously outlined by Butler et al., 1995) to derive patterns associated with the quantity and quality of domestic wastewater and to assess their uncertainty. The analysis is based on the results of three surveys carried out in the south of England (Butler, 1991, 1993; Butler et al., 1995; Friedler et al., 1996a,b) and a fourth one in Malta (Butler and Gatt, 1996). The main conclusions are:-Daily flow patterns become apparent with a high morning peak and two lower evening peaks corresponding to dinner and bed times. Slight changes might be expected depending on the dwelling occupancy (Butler, 1993) and the geographical region (in Malta later than in England according to Butler and Gatt (1996)). Note that another study carried out in a large Brazilian city demonstrated that social strata too may influence the patterns (Campos and von Sperling, 1996). For instance, the rich areas of cities in developing countries seem to produce the wastewater load later during the weekends (two hours in the Brazilian case study) while the poorer ones maintain the same peak hours as the week-days.The daily patterns of the flow and loads (COD, TSS, NO3 and PO4) follow similar patterns while those of the concentrations present much lower variability (Almeida et al., 1999). The flow and concentration data seem to be quite independent (Friedler and Butler, 1996)The WC generates nearly 40% of the domestic wastewater. It is the major contributor to all pollutant concentrations and especially to ammonia (see Friedler et al., 1996a,b)The resulting values of the pollutant concentrations at the domestic source are higher than those reported at the entrance of WWTPs (Henze et al., 1995). This result outlines the importance of the dilution and biodegradation processes in the sewer systems (Butler et al., 1995)The uncertainties of the pollutant concentrations are featured by skewed distributions that represent not only the uncertainty of their magnitude but also the uncertainty about the timing of their peaks. Given the non-gaussian nature of these uncertainties, the evaluation of their combined effect should be assessed by numerical techniques, i.e. Monte Carlo simulation (Friedler and Butler, 1996)Fig. 4shows the relatively standard pattern observed in domestic daily load (COD, PO4, TSS, NH3 and NO3) and the proportions produced per household appliance.The effort of such an exhaustive analysis (where different appliances and modes of use are distinguished) was intended to gain knowledge about the wastewater generation; and therefore to improve the operation and control of WWTPs. However, the connection of this methodology with the existing WWTP models was not investigated. Note that, the daily patterns (of flow and load) observed at the very source of the domestic generation may no longer be observable at the entrance of the WWTP due to intermediate sewer retention tank storage, different pumping regimes, etc (Ort et al., 2010).The use of simulation models to find improved operation and control of WWTPs has been largely discussed (Flores-Alsina et al., 2008; Benedetti et al., 2010; Guerrero et al., 2011). Good examples of that work are the successful Benchmark Simulation Model No.1 (BSM1) (Copp, 2002) and Benchmark Simulation Model No.2 (BSM2) (Jeppsson et al., 2007) and their numerous applications (over 300 scientific publications) (Jeppsson et al., 2013). While the BSM1 represents the water line (biochemical reactors and secondary clarifier), the BSM2 also includes the sludge line (thickener, anaerobic digester, dewatering unit and storage tank). The protocols define influent characteristics featuring a load of around 100,000 person equivalents or PE (80,000 from households and 20,000 from industrial origin) and fix performance evaluation protocols. The BSM1 simulation platform includes three influent files (Fig. 5), each of them representing 14 days of dynamic influent flow and load featuring: dry weather conditions, one rain event, and two storm events respectively. The BSM2 proposes to evaluate the model performance over one year of dynamic simulation, so that the effect of the temperature and the slow dynamics of the anaerobic digester can be investigated.The phenomenological model of Gernaey et al. (2011) was born out of the BSM1_LT (Rosen et al., 2004) and BSM2 initiatives (Jeppsson et al., 2007). It is a flexible tool that describes the wastewater generation under typical urban conditions. The main objective of the phenomenological generator (Gernaey et al., 2011) is to create model-based influent data for the BSM2 platform in view of process control studies. Nevertheless, any modeller is invited to modify the original structure and include the specific characteristics of the particular case (catchment area, industrial discharges, etc.). The tool is implemented as ‘open source’ freely distributed on request. The first release of the phenomenological model (Gernaey et al., 2005, 2006) already provided influent data with the main characteristics of the most recent version (Gernaey et al., 2011). The main differences between the two of them are: a) the nitrogen load to the plant was reduced (Nopens et al., 2010) since it was discovered during BSM2 simulations that the BSM2 plant was chronically overloaded; b) model verification was conducted by a second, totally independent implementation (Gernaey et al., 2011) leading to full confidence in the results of the generator.The phenomenological model (Gernaey et al., 2005, 2006, 2011) features the influent of a WWTP located in the Northern hemisphere and provides annual dynamic influent flow rate, pollutant concentrations and temperature profiles starting from the 1st of July. The pollutant concentrations can be expressed in terms of the state variables of ASM1, ASM2d or ASM3 models (Henze et al., 2000), as desired by the user. In accordance with the BSM2 protocol the dynamic profiles feature 609 days from which only the last 365 would be used for the evaluation of the simulation results. The generator is implemented in Matlab-Simulink by defining different interconnected modules. As an example, Fig. 6shows the architecture of the flow generator (figure from Flores-Alsina et al., 2012) and the model block describing the wastewater flow coming from households (figure from Gernaey et al., 2005):The main characteristics of the modules implemented in the phenomenological model (Gernaey et al., 2011) are:-Rain generation module: It is an ingenious tool that transforms a random number (stochastic variable) into a rain event, the peak value of which is smoothed down by an exponential function until the next rain event appears. The module allows generating different rainfall patterns in relation with different climate conditions. The number of rain events and their maximum intensity can be manipulated by the user by adjusting different parameters (Flores-Alsina et al., 2013a, b): Qpermm defines the flow rate due to rain, Llrain determines the number of rain events, etc. Alternatively, some studies (Benedetti, 2006; Benedetti et al., 2006) have replaced the output of this module by actual rainfall time series data.Household wastewater generation module: It generates the pollutant load profiles (units of g/m3) by multiplying the average load rates per PE (COD, NH4, TKN, etc.) with the number of PE, and assuming a daily pattern (1 h time step) with two peaks at 8 and 17 h (inspired by Almeida et al. (1999)). The flow generated by the household is also proportional to the PE and follows three patterns: daily (two peaks at 9 and 19 h), weekly (around 10% lower during the weekends) and yearly (25% lower during summer holidays). By modifying the default pollutant profiles, this module can represent the possible variability of the pollutant profiles with the geographical region (Butler and Gatt, 1996) or among neighbourhoods of different social strata (Campos and von Sperling, 1996).Industrial discharges generation module: The pollutant discharges from industries are represented by a single loading rate (COD, TKN, NH4, etc.) that follows a weekly pattern: a peak on Fridays represents the industrial cleaning and lower pollutant discharges represent the weekend. The wastewater flow generated by the industries presents weekly and yearly profiles: the first one is similar to the one of the pollutants and the yearly one represents two holiday periods (summer and Christmas) where the flow is lower (20% and 30% respectively). With the idea of proposing a simple model description that could be extensively used, the module assumes that the wastewater generated by industries and households can be fractionated according to the same principles. This default fractionation can easily be modified given the availability of the code.Soil model module: The soil is represented by a variable volume tank model to represent the storage of water in the soil. The flow entering the tank is composed of a fraction of the rainfall that falls in permeable areas, and the outflow represents the flow to the sewer system and the aquifers. The infiltration to the sewer system depends of the invert level (the maximum water level that will not cause infiltration in the sewer pipes) which at the same time depends of the temperature variation, as a surrogate for seasonal variation of the groundwater level.Temperature module: Daily and yearly temperature variations are defined by two sinusoidal functions. The yearly sinus has an average of 15 °C, amplitude of 10 °C and frequency of 2Π/364 rad/d. The daily sinus moves around the seasonal one with amplitude of 1 °C and frequency of 2Π/1 rad/d. In Flores-Alsina et al. (2013a, b), the temperature and rain generation are linked by a model that relates temperature with snow melting episodes. The snow melting water is generated by a new module similar to the rainfall module of Gernaey et al. (2011).Sewer model module: The sewer system is defined by connecting a different number of subcatchments (one to eight) to represent more or less complex sewer systems. Each subcatchment is modelled by a tank-in-series approach using variable volume reactors where the outflow of each tank follows an exponential function on the water height. The first flush effect is included by a simple equation with two adjustable parameters to tune its strength. It also assumes an even complexity of all subcatchments by always using three tanks-in-series. Nevertheless, after calibration, the complexity of the sewer model has demonstrated to be sufficient to correctly describe influent profiles with one hour frequency (Flores-Alsina et al., 2013a, b).As result, the influent generator of Gernaey et al. (2011) achieves a simple phenomenological representation of the typical dynamics that are observed in a full scale WWTP influent, being able to feature diurnal phenomena; weekend effects (e.g. lower pollutant load); seasonal phenomena (e.g. decreased infiltration with temperature); holiday periods (e.g. with a lower average wastewater flow rate); rain events; etc. Currently, this generator seems to move forward to a more detailed description of the generating processes beyond the wastewater generation (see for example, the developments carried out in the EU-funded SANITAS project http://www.sanitas-itn.eu/). In this sense, and as a wish list for further developments, the following could be considered: a rain generator in accordance with state of the art models (Thauvin et al., 1998; Willems, 2001; Palynchuk and Guo, 2011); a more descriptive relationship between temperature and rain profiles for different climates (Birt et al., 2010); the building up and wash off of urban pollutants (Egodawatta et al., 2007; Wang et al., 2011); the description of the vertical infiltration in terms of the soil properties, such as specific moisture capacity, capillarity head, effective hydraulic conductivity, etc. (Richards, 1931; Corradini et al., 2011); and so on. In this context, the description of the wet weather flow and composition along the sewer system is still an important challenge but current progress is benefitting from (recently published) high frequency data sets (Schilperoort, 2011; Langeveld et al., 2013). New modelling proposals for influent generation are also better handling wet weather conditions or the sewershed and include a weather generator that can be calibrated on local climate data being able to describe inter-daily variations of flow and TSS (Talebizadeh et al., 2014).Early applications of the phenomenological model (Gernaey et al., 2005, 2006) have shown the usefulness of the tool for the modelling of integrated urban water systems. In some cases, the model is presented as a part of general methodologies: to check the WWTP performance (Ráduly et al., 2007) or to design correction measures in a probabilistic framework (Benedetti et al., 2008). The phenomenological model has also been able to fulfil specific objectives as generating realistic influent data profiles for WWTP of different characteristics (Benedetti et al., 2008); adding new components to the ones in ASM family models (Lindblom et al., 2006); or generating training data with a wide range of influent conditions, such as: rain events, holiday effects, industrial discharges, etc (Ráduly et al., 2007).A Global Sensitivity Analysis of the phenomenological model (Gernaey et al., 2011) has recently been published (Flores-Alsina et al., 2012). The analysis focuses on the influent flow rate and shows that while the main parameters affecting dry weather flow rate profiles are the catchment size and the wastewater flow per person, the ones determining the wet weather profile are the probability of occurrence of a rain event, the catchment size, and the quantity of rain falling on permeable areas. This analysis has been completed with a calibration of the BSM2 influent generator on full-scale plant data (Flores-Alsina et al., 2013a, b) (see Section 6 for further information).One of the clearest advantages of the model is that the user can simply create influent wastewater characteristics according the features of the catchment area: number of PE, percentage of permeable surfaces, flow rate generated per unit of rain, complexity of the sewer network, etc.; or extrapolate to other scenarios by using hypothetical data. In this respect, Flores-Alsina et al. (2013a, b) evaluates three representative cases: the variation of influent flow rate for different rainfall patterns, the effect of parameter uncertainty on the predicted influent biodegradability, and the increase of frequency in a given dataset.In this section we cover the solutions found in literature with respect to the so-called fractionation problem. The translation of the experimental measurements (BOD, COD, TSS, TKN, TN, etc.) into the model components of ASM family models (readily biodegradable substrate, soluble inert organic matter, slowly biodegradable substrate, heterotrophic biomass, etc.) is not a straightforward problem. Indeed, it is a non-identifiable problem since the experimental data is never informative enough to uniquely determine the model components. Different protocols and scientific research have tried to overcome this situation.Henze (1992) presented a summary of methods to determine the fractions of COD, the origin of different nitrogen compounds, and biomass populations. After analysing the wastewater composition of several WWTPs over the world, it seemed that for a specific WWTP the fractions of COD remain quite constant. However, when comparing the fractionation among the different WWTPs it was concluded that the sewer system and temperature variations might influence the composition significantly. Roeleveld and van Loosdrecht (2002) came to a similar conclusion. Motivated by the experience of modelling more than 100 WWTPs in The Netherlands, the Dutch Foundation of Applied Water Research stimulated the development of the STOWA protocol (Hulsbeek et al., 2002; STOWA, 1996; STOWA, 1999). On that effort, special attention was paid to the characterisation of the influent wastewater (Roeleveld and van Loosdrecht, 2002) in order to determine the ASM1 model components. After carefully comparing the COD fractionation results of 21 WWTPs, they found that, except for the fraction of the soluble inert material that remains quite stable, a high variation is noticed in the other COD fractions (readily biodegradable substrate, slowly biodegradable substrate and particulate inert organic matter). This variation was attributed to the type of wastewater (contribution of industrial waters), the sewer system type and length (separate/combined) and the transformation processes in the sewer (pressure main/gravitational). However, the data showed insufficient evidence to draw firm conclusions with this regard. Another important conclusion of this modelling effort was that the wastewater characterisation is very helpful for the daily WWTP operation even if no modelling study is scheduled (Roeleveld and van Loosdrecht, 2002). For example, the authors explain that the determination of the soluble COD available is related to the capacity of the plant for high nitrogen and biological phosphorus removal.Generally, the characterisation problem is related to the calibration/validation of mathematical models and therefore, it is generally presented as part of general protocols for activated sludge modelling, such as the STOWA protocol (Hulsbeek et al., 2002); the BIOMATH protocol (Vanrolleghem et al., 2003); the HSG guidelines (Langergraber et al., 2004); and the WERF protocol (Melcer et al., 2003). An SWOT analysis of the four protocols (Sin et al., 2005) identifies the detailed influent characterization of the BIOMATH and WERF protocols as strength, while it is identified as weakness in the HSG guidelines. One of the main differences with regard to the influent characterization lies in the COD fractionation. The STOWA protocol (Roeleveld and van Loosdrecht, 2002) proposes the BOD test to determine the readily biodegradable soluble COD (SS in ASM models) while the BIOMATH protocol proposes respirometry tests (Sollfrank and Gujer, 1991; Spanjers and Vanrolleghem, 1995; Sperandio and Paul, 2000). Both protocols stress the importance of the wastewater characterization for a successful model calibration. With regard to the data collection, the STOWA protocol insists on the use of mass balances to check the data consistency and the BIOMATH protocol recommends the use of Optimal Experimental Design (Dochain and Vanrolleghem, 2001) to optimize the quality of the calibration results. The HSG guidelines are more flexible (than the STOWA or the BIOMATH protocols) and they recommend to use a COD fractionation based on respirometric tests (as in the BIOMATH protocol) or to combine physical-chemical methods with BOD measurements (as in the STOWA protocol). In the WERF protocol (Melcer et al., 2003) a detailed fractionation method is included in the last (and more sophisticated) type of the calibration procedure together with the estimation of the stoichiometric and kinetic model parameters.Improvements to these protocols are described in Mannina et al. (2011) and Rieger et al. (2012). Mannina et al. (2011) proposed a novel calibration protocol for nutrient removal wastewater treatment models based on combining the use a global sensitivity analysis with the Generalized Likelihood Uncertainty Estimation (GLUE) approach. The most innovative feature consists of using a step-wise approach to define sub-groups of parameters to be calibrated on different model outputs. Rieger et al. (2012) summarizes the keys for good modelling practice in wastewater treatment. The IWA Task group has led important initiatives for standardizing: the qualitative criteria to evaluate simulation results (Hauduc et al., 2011), the notation of activated sludge models (Corominas et al., 2010), the uncertainty assessment (Belia et al., 2009), or the problem of data reconciliation (Rieger et al., 2010a). The effort is culminated with a critical review of wastewater treatment modelling and the presentation of future possibilities (Rieger et al., 2010b; Hauduc et al., 2013).The Benchmark Simulation Model No. 1 (Copp, 2002) includes a fractionation model (inspired by Vanhooren and Nguyen (1996)) in which the soluble and particulate components of the ASM1 model are estimated incorporating influent wastewater characteristics of several studies (Butler et al., 1995; Campos and von Sperling, 1996; Londong, 1994; Verbanck, 1995) and assuming fixed ratios between the most common measurements: for example, 1.33 as the ratio between the particulate COD and the TSS. Following a similar approach, the influent generator of Gernaey et al. (2011), see Section 3.3, proposes three different fractionation models that transform the pollutant load of households and industries into the state variables of ASM1, ASM2d or ASM3 models. The pollutant load is characterized by the soluble COD, particulate COD, TKN and NH4 concentrations for the ASM1 and ASM3 models; and also in terms of PO4 in case of the ASM2d model. The module uses fixed relationships to derive the model state variables.In a very pragmatic and engineering approach, based on the principle of elemental continuity, and without making any recommendation about the most suitable laboratory tests to use, Grau et al. (2007) proposed a mathematical tool for the characterization of the influent wastewater. The algorithm is based on the definition of an extended list of model components (ammonium, ammonia, dissolved carbon dioxide, bicarbonate, monosaccharide, aminoacids, LCFAs, etc.) and their relationship with commonly available analytical measurements (COD, BOD, TSS, TN, TKN, etc.). The algorithm is initialized by defining a typical urban wastewater in terms of an extended list of model components (default solution); and it looks (by minimizing an error function) for another numerically close solution that reasonably fits the available experimental data. The optimal solution (expressed in terms of the extended list of model components) can be straightforwardly translated in terms of any other biochemical model (any ASM family model). By requiring a solution close to an initial estimation, the identifiability problem (caused by the fact that the experimental measurements are never informative enough to uniquely identify the model components) is overcome. De Gracia et al. (2011) presented an application of this methodology in which three types of WWTP sludge (sludge produced in primary clarifiers, sludge produced in secondary clarifiers; a mixture of the first two) are characterised in terms of the components of a generic digester model (de Gracia et al., 2009).The necessity of characterizing the uncertainty around the expected influent data profiles has been repeatedly outlined (Friedler and Butler, 1996; Bixio et al., 2002; Benedetti et al., 2008; Gevaert et al., 2009). However, the difficulty of analysing the uncertainty in real data sets (Friedler and Butler, 1996), the short history of uncertainty analysis in water quality modelling (Belia et al., 2009), and the lack of stochastic formulations of biochemical models (Reichert and Mieleitner, 2009) have not yet given rise to standard methodologies with this in mind. Note that rigorous procedures for generating realistic time series profiles with similar statistical properties would be very useful for uncertainty based (i.e. Monte Carlo based) design and dimensioning of new WWTPs (Bixio et al., 2002; Martin et al., 2012), and also for validating robust control algorithms such as the QFT control strategy (García-Sanz et al., 2006).Friedler and Butler (1996) tried to assess the uncertainty in the quantity and quality of domestic wastewater by analysing the data from two surveys carried out in the south of England (Butler, 1991, 1993). They concluded that the total volumes, pollutant loads and frequency of use are highly uncertain and that their distributions depend not only on the appliance and mode of use but also on the specific user. They explain that the uncertainty of these parameters is in general related to the magnitude of the pollutant profiles but also to their timing. In this sense, the uncertainty in the timing of the pollutant releases is highly skewed due the predominance of zero usage of the appliances. The authors conclude that Monte Carlo simulations would be needed to analyse the combined effect of the uncertainties in downstream elements of the wastewater infrastructure.Rousseau et al. (2001) did also try to characterise the uncertainty found in real experimental data sets. In this case they measured the influent flow and influent load profiles at the inlet of 167 WWTPs in Flanders (Belgium) and certain relationships between the flow and wastewater pollutant concentrations (COD, TKN and NO3) could be identified. These relationships (Fig. 7) together with the available flow data and a fixed fractionation model (of the COD into the ASM1 variables) were used to generate “shots of” dry weather influent profiles. The authors claim that the generated influent data is coherent with the variability observed among the 167 WWTPs but also with the inherent uncertainty of their patterns.The phenomenological model of Gernaey et al. (2011) also follows a simple but effective approach to introduce randomness in the generated data. It uses random number generators (with zero mean and tuneable standard deviation) along the different blocks (households, rain generation, seasonal correction factor, fractionation model, etc.) so that different profiles featuring the uncertainty of the underlying mechanisms can be provided. More descriptive approaches can be implemented by representing some inference from uncertainty analysis of real data. For example, the inclusion of the uncertain correlation among different variables (as observed in Rousseau et al. (2001)) or the uncertainty in the patterns of domestic wastewater generation (Friedler et al., 1996) would be interesting.The influent generator defined by De Keyser et al. (2010) is based on the use of 24 daily patterns, 11 weekly patterns and 14 yearly patterns resulting from an extensive literature review. The stochasticity of the resulting profiles is introduced in two different ways: (i) adding white noise to the obtained time series; and (ii) allowing some pattern parameters to be randomly sampled (so that the daily, weekly and yearly patterns become stochastic structures). The second strategy implies defining some pattern parameters to be random variables. For example, a uniform distribution can determine the time for an emission peak to occur (daily pattern), or the day in the week (weekly pattern), or the weekends in which it repeats itself (yearly pattern).Another interesting manner of introducing uncertainty in the daily or weekly periodic profiles is to introduce the time warping approach (Villez et al., 2009; Gins et al., 2006) in which the profiles are disrupted by introducing the uncertainty of their timings. Fig. 8shows an example in which the daily patterns of the ammonium and soluble organic nitrogen influent profiles of BSM1 model (Copp, 2002) have been manipulated by adding white noise not to their values but to the times at which they occur.For cases in which the influent data of a WWTP is already the result of a mathematical model, different realisations of these data can be generated by using a stochastic formulation of the model. This can be achieved by defining the parameters of a deterministic model by random variables defined by a probability distribution function (Bayesian approach) (see Omlin and Reichert, 1999; Martin and Ayesa, 2010). This method has been used to estimate the COD and TSS mass load at the entrance of a WWTP by using measurements of UV absorption and turbidity along a sewer system (Bechmann et al., 1999). Talebizadeh et al. (2014) uses the same approach to incorporate an urban drainage model (CITYDRAIN, Achletner et al. (2007)) for the stochastic generation of water quantity and quality profiles under wet weather conditions. Another set of solutions to feature the uncertainty on a set of data profiles is based on the use of autoregressive models. This statistical approach does not try to understand the uncertainty in the generating mechanisms (domestic load, permeability of the soil, rainfall profiles, etc). On the contrary, it just tries to reproduce some uncertainty in coherence with the available experimental data or the assumed lack of knowledge. In this line, Carstensen et al. (1998) propose a grey box model to represent the uncertainty around the hydraulic load expected at the inlet of a WWTP. They used an Autoregressive First Order model to generate some randomness over the response of a second order Fourier model (Section 3.2). They found that the inclusion of a first order autoregressive model considerably improves the description of the hydraulic data profile. In a similar way, Martin et al. (2007) proposed the use of Autoregressive Moving Average Models (ARMA) models to feature the uncertainty around given time series data (Bras and Rodríguez-Iturbe, 1985). The main advantage of the methodology is that it allows characterising the white and coloured noise and tuning the magnitude of the uncertainty to be generated by adjusting some of the ARMA model parameters.In general, influent generators, as any other model, need to be calibrated and validated on the evidence of experimental data (Dochain and Vanrolleghem, 2001). However, the wide range of studies and methods presented in this paper do not necessarily follow these general model building steps. The influent generators based on databases (Section 3.1) for example, do not require any calibration. They can directly be used in coherence with the requirements of the user or the characteristics of the catchment area. On the contrary, the influent generators based on the use of harmonic functions (Section 3.2) or the phenomenological model (Section 3.3), do need some calibration of their parameters. The phenomenological model of Gernaey et al. (2011), for example, has been calibrated using experimental data from two Scandinavian WWTPs (Flores-Alsina et al., 2013a, b). The authors follow a step-wise procedure based on adjusting the most influential parameters after a global sensitivity analysis (Flores-Alsina et al., 2012) at different time scales (from yearly profiles to hourly values). They demonstrate the validity of the model results by using a set of data not used during the calibration stage. The performance of the generator and the guidance provided by this calibration experience will facilitate the usage of the influent generator in other case studies or modelling scenarios.In general, the model calibration follows either the Frequentist or Bayesian approach (Omlin and Reichert, 1999). Under the frequentist philosophy the modeller looks for an optimum parameter set that minimises the differences between the experimental and simulated results according to some statistics-based objective function. On the contrary, the Bayesian framework assumes that there is not a single optimum parameter set but an optimal region of parameter values in which the simulation result is reasonably good. An example of Frequentist estimation is the one presented by Flores-Alsina et al. (2013a,b). Examples of Bayesian estimation are the ones presented by Lindblom et al. (2011), Rieckermann et al. (2011) or Talebizadeh et al. (2014). Lindblom et al. (2011) use the Generalized Likelihood Uncertainty Estimation (GLUE) (Beven and Binley, 1992) to calibrate a stormwater surface accumulation-wash-off model based on an extensive measurement campaign of Zn, Cu, Pb and Cd field data. GLUE adopts the Bayesian framework but substitutes the likelihood function by a subjectively chosen objective function or ‘less formal likelihood’ (Beven and Freer, 2001). The reason to use the GLUE approach instead of traditional Bayesian inference is that the latter requires of statistically derived likelihood functions which involve strong assumptions on the model residuals' distribution (generally to be independent and normally distributed). In this case, Lindblom et al. (2011) adapted the classical likelihood function with an extra scaling parameter that makes the likelihood expression more or less sensitive to the residual errors. This scaling parameter is manually adjusted for the different datasets so that the forward propagation of parameter uncertainty covers 95% of the experimental data. The second example of using Bayesian inference is the one presented by Rieckermann et al. (2011) that calibrates a stochastic model describing wastewater micropollutant loads by using three Approximate Bayesian Computation (ABC) methods (Beaumont et al., 2002; Marjoram et al., 2003). ABC methods derive the posterior distribution of parameters without using the likelihood function of model residuals. The article compares three different numerical algorithms to approximate the posterior distribution of a single parameter: the number of wastewater pulses contained in three high-resolution data series of benzotriazole and total nitrogen loads in sewers. The main contribution of the article consists of divulgating the use of ABC methods (not usual in biochemical modelling) since they are simple and with sound statistical properties when compared to traditional Bayesian inference or with the GLUE approach (Mantovan and Todini, 2006). Finally, Talebizadeh et al. (2014) used Bayesian calibration to adjust the output of the open-source CITYDRAIN model (Achleitner et al., 2007), with which it is possible to generate influent wastewater under wet weather conditions incorporating the effect of climate and sewershed characteristics.The validation of any modelling approach should be accompanied by an analysis of the model performance by comparison of the simulated and experimental results. Different authors have suggested standard methodologies and presented appropriate use of metrics in this respect (Beck, 2006; Moriasi et al., 2007; Mattot et al., 2009). This effort has recently moved forward with the presentation of a position paper on water quality models (Bennet et al., 2013) that analyses quantitative and qualitative methods in literature for characterising model performance, and a critical review paper on the use of different objective functions for wastewater models (Hauduc et al., 2011). The former (Bennet et al., 2013) stresses that the adoption or rejection of a model is not only related to the goodness-of-fit measurements but also to other factors such as cost, simplicity, applicability, intelligibility, etc (Giordano et al., 2012; Krueger et al., 2012; Rowan et al., 2012). Based on the use of the objective criteria, Bennet et al. (2013) propose a stepwise performance evaluation method that includes the definition of the modelling objective, the data check, a visual performance analysis, etc. The latter paper (Hauduc et al., 2011) reviews 31 goodness-of-fit criteria generally used in wastewater treatment modelling. The study concludes that most of them are intrinsically correlated, and proposes a two-step cluster analysis using Kendall correlation and dendrograms to select criteria that provide non-redundant information.Other approaches covered in this paper (for Situation 2 and Situation 3) do not need model calibration/validation nor performance evaluation, but they use these methods in different manners. For example, the standard protocols for using activated sludge models (Situation 2, Section 4) define systematic calibration protocols. They recommend step-wise procedures where steady-state and dynamic simulations are compared with experimental data at different stages. Usually, subsequent validation and retrofit model improvement steps are included. On the other hand, some of the methods described to include uncertainty in influent generators (Situation 3, Section 5) are based on the use of Bayesian statistics to calibrate their parameters and assess their uncertainty (Bechmann et al., 1999; Talebizadeh et al., 2014). This approach enables the realisation of different influent profiles coherent with the mechanisms defined in the model structure and the uncertainty of their parameters.

@&#CONCLUSIONS@&#
The state of the art already provides a wide range of solutions for characterising, generating and completing WWTP influent data series. The main challenge for engineering practice consists of being able to select the most appropriate solution for each situation. Some questions that should facilitate that choice are: Do we have enough data to characterize the influent quantity and quality? Do we need to generate influent data by only knowing some general characteristics about the catchment area? Would we prefer some simple approach to generate dry weather influent profiles or do we need to characterise as well wet weather influents? Do we need to translate typical experimental measurements (COD, TSS, TKN, etc.) into the ASM family model state variables? Do we need to perform an uncertainty analysis of the WWTP performance?The influent generators for WWTP modelling and simulation are going to be important in the following years. For instance, quantitative risk analysis of WWTPs or probabilistic design will only be possible if we can generate influent profiles under hypothetical conditions (population growth, strong rain events, uncontrolled spills, etc.) and characterise their uncertainty. That process will increase the awareness about modelling robustness (good behaviour under uncertain conditions) during future projects for WWTP design or improved operation. In that respect, phenomenological modelling for influent wastewater generation should deserve special attention because it can integrate important knowledge about the generating mechanisms. The state of the art should move forward step by step by introducing more detailed descriptions of the different components in the catchment area (build-up and wash off of urban pollutants, soil infiltration, sewer system, retention tanks, etc.) and the stochastic nature of the inputs (rainfall and temperature profiles, run-off generation, industrial and household loads, etc.). The result will be a stochastic model where the mean values are coherent with the catchment properties (hypothetical or real) and the uncertainty of the generated time series coherent with the stochastic nature of the problem. While pursuing that effort, the lack of details in the description of the catchment elements or stochastic inputs (modeller uncertainty) can be represented by using a statistical model (e.g. based on autoregressive functions) on top of the phenomenological core model.