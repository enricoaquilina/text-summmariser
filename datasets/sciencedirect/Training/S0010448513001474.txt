@&#MAIN-TITLE@&#
A method for computer-aided specification of geometric tolerances

@&#HIGHLIGHTS@&#
Automated generation of GD&T specifications for mechanical assemblies.Data-driven identification of most precision requirements from assembly process data.Rule-based selection of datum reference frames and tolerance types on parts.Text-based input and output, discussion of CAD implementation issues.

@&#KEYPHRASES@&#
Tolerancing,Tolerance specification,Geometric tolerances,Assembly requirements,Datum selection,

@&#ABSTRACT@&#
The paper describes a method for the generation of tolerance specifications from product data. The problem is nontrivial due to the increasing adoption of geometric dimensioning criteria, which call for the use of many types of geometric tolerances to completely and unambiguously represent the design intent and the many constraints deriving from manufacturing, assembly and inspection processes. All these issues have to be modeled and explicitly provided to a generative specification procedure, which may thus need a large amount of input data. The proposed approach tries to avoid this difficulty by considering that most precision requirements to be defined relate to the assembly process, and can be automatically derived by analyzing the contact relations between parts and the assembly operations planned for the product. Along with possible user-defined additional requirements relating to function, assembly requirements are used in a rule-based geometric reasoning procedure to select datum reference frames for each part and to assign tolerance types to part features. A demonstrative software tool based on the developed procedure has allowed to verify its correctness and application scope on some product examples.

@&#INTRODUCTION@&#
The way of specifying tolerances on manufactured products has progressively changed during the last two decades. In traditional practice, allowable variation limits were simply assigned to dimensions regarded as critical for fit and function (linear tolerancing). This is no longer sufficient, since the advent of Geometric Dimensioning and Tolerancing (GD&T) has put forward the idea that part features need to be controlled in many different geometric characteristics (size, form, orientation, location, profile, runout). While overcoming the ambiguity, incompleteness and inefficiency issues involved by linear tolerances, this approach forces the designer to become familiar with complex tolerance standards  [1,2] and able to apply them to a diversity of design cases. The difficulty of doing that has encouraged the development of computer-aided tools for the design of geometric tolerances  [3]. They pursue different levels of support (guidelines, interactive procedures, data-driven software) to three main tasks, which are illustrated in Fig. 1on a conceptual example:•tolerance specification: the types of tolerances on functional features and the datum reference frame are chosen for each part;tolerance allocation: the values of all specified tolerances are determined by either refining empirical tentative values or optimizing them according to cost–tolerance functions;tolerance analysis: the stackup of errors allowed by selected tolerance values is evaluated and compared to design requirements (possibly more than once during the allocation procedure).To date, little support exists for tolerance specification and allocation, while software tools for tolerance analysis are available on a growing number of CAD platforms.This paper presents a method for the solution of tolerance specification problems, which was previously reported at an early development stage  [4] and has been extended and implemented into a demonstrative software tool. Specification is less studied than allocation and analysis, because it was not an issue with linear tolerancing and is actually inherent to the geometric approach. It can be viewed as a missing link in the tolerancing chain, which provides the two downstream tasks with a correct and complete geometric description of design requirements in the GD&T language.Compared to available approaches to tolerance specification, the proposed method attempts to streamline the flow of input information, which can be difficult to manage for a designer. This is done by putting most design requirements in relationship with product data, thus avoiding the need to provide them in input to the specification procedure. The method aims also at ensuring that specified tolerances are presented to the designer with a clear representation of the reasoning steps behind them. Both motivations can help to effectively treat complex products and to improve the acceptance of a computer-aided tool in the design environment.As noted in a recent survey  [5], tolerance specification has often been referred to by different names to emphasize its distinction from allocation (qualitative tolerancing) or the need for a modeling of design requirements (tolerancing for function, tolerancing for assembly). Its role within the tolerancing process and its relationships to downstream tasks have been clarified in some early papers  [6,7]. Although it involves detailed part design, it should be anticipated to the earlier stage of assembly design as suggested in[8,9]. Acceptance conditions on the tolerances generated by a specification procedure include the unambiguous positioning of part features  [10,11] and the compliance to syntax rules stated by technical standards  [12]. Tolerance values are not specified as they will be optimized in the allocation task along with possible alternative choices for tolerance types and datum reference frames  [13].The basic input for tolerance specification is the nominal product geometry as it could be extracted from a geometric modeler, although only a few studies report a true CAD integration. The processing of geometric data involves a preliminary selection of the features to be toleranced. In most cases, these are classified according to the types of assembly relations with features of mating parts. The classification adopted here has some resemblance to the one proposed in  [14], based on the number of actual contact points and on the degrees of freedom subtracted to the relative motion of parts. Additional product data considered in the proposed method include the assembly sequence, whose influence has been pointed out and discussed in  [15].Input data can be completed with additional precision requirements set by the designer. In linear tolerancing, requirements are mainly related to tolerance chains as widely discussed in  [16]. In the context of GD&T this concept is better specialized with the definition of key characteristics, delivered by chains of geometric relations identified by means of flowdown procedures  [15]. Alternative ways proposed to represent design requirements include assembly geometric tolerances  [17], pseudo-TTRS  [18], virtual boundary requirements  [19], functional–structural models  [20] and hierarchies of hypergraphs  [21]. The chance to generate some of the requirements from product data, which was explored in this work, has its roots in previous research on the identification of ending gaps of tolerance chains through search in graph-based models of assembly relations  [22–24].Available knowledge for the solution of the specification problem comes from tolerance standards and technical handbooks in the form of rules and application examples. Most of them are concerned with the selection of datum reference frames on parts, a subproblem which is usually regarded as the core of a specification procedure. It involves geometric reasoning on many properties of part features including shape, size, types of assembly relations, relevance for product function, ease of access during the manufacturing process. Datum selection is usually restricted within typical configurations classified in  [25] and connected to designs of machining and inspection fixtures.In an attempt to formalize such knowledge, a major question is how a feature with given geometric properties can be toleranced with respect to one or more datums. It has been pointed out that finite sets of tolerancing cases can be classified. A set of 44 cases is based on the invariance concept, which underlies the Technologically and Topologically Related Surfaces (TTRS) tolerance representation model  [26,27]. Alternative classifications of 31 cases  [10,12] and 27 cases  [28] are based on the complementary concept of feature degrees of freedom. In principle, those results allow to treat individual steps of a specification procedure once the features to be toleranced have been put in a suitable order. Tolerance specification methods proposed in literature integrate classification rules as building blocks into geometric reasoning procedures for the analysis and ordering of part features.The first and most cited method of generative specification is based on the TTRS model of tolerance representation  [26]. By recognizing loops in the graph of assembly relations, an iterative algorithm creates associations between features of individual parts. This results in a hierarchy of feature associations for each part, which are completed with geometric tolerances according to the above cited classification of cases. The method has been further developed into an interactive software tool  [29], enhanced with rules for loop selection  [30] and integrated in commercial CAD packages  [18,31]. Similar approaches have been used to select datum reference frames for individual parts  [32,33] and to transfer geometric tolerances into detailed specifications along the steps of a machining process  [34].Another method connected to a classification of tolerancing cases is based on the degree-of-freedom representation model  [10,12,35,36]. A global model of feature relations is used to generate directional relations between pairs of features, which are later converted into geometric tolerances selected from classified cases. The claimed benefits of the approach include the identification of datum precedences and a better verification of the correct positioning of toleranced features with respect to datums.The method proposed in  [14] is based on mirrors, i.e. planar surfaces involved in assembly relations, which are expected to have a special influence on part tolerancing. Each mirror is selected as a datum and forms the basis for a local cluster of features, which are toleranced according to predefined rules. Clusters are then aggregated in a final step by considering the whole set of assembly relations of the product.In the function decomposition method  [37], the strategy based on assembly relations is combined with an explicit treatment of design requirements. Each functional requirement input by the user is decomposed into a hierarchy of part features, from which a subset of critical features is selected according to reasoning rules on feature types and associated directions. From critical features, other rules allow to choose datums and geometric tolerances on features. The method has been enhanced with rules for the identification of functional requirements from high-level mechanical functions  [38] and for the choice of modifiers from the assembly sequence  [39]. A further extension based on the small displacement torsor concept has also been proposed for the generation of tolerance specifications in the early phases of product development  [40].The method proposed in  [41,42] emphasizes the careful treatment of functional requirements. Each of them is defined as an assembly tolerance, which links a feature to a datum on another part. This is converted into a set of tolerances on individual parts by considering assembly relations, on which user-defined precedences have been set in a proper data structure (positioning table). Generated tolerances are validated by means of rules which are based on the invariances of features on individual parts. The method has been extended and integrated in CAD environment with a partial automation in the construction of positioning tables  [43–45] and a link to automated tolerance allocation  [46].The method of variational loop circuit  [28,47,48] combines the focus on design requirements with an explicit classification of tolerancing cases. For each requirement, a graph-based model links the involved features and the related associated entities (e.g. axes) through parameters and equations. An output graph is built upon it by adding geometric tolerances extracted from the classification, as well as functional equations which can help the integrated treatment of tolerance allocation and analysis.Some considerations on existing methods help to identify opportunities for further work on tolerance specification. They apply to three aspects: the treatment of design requirements, the use of assembly process data and the traceability of generated tolerances.The modeling of design requirements has been already cited as critical for correct tolerancing. In most methods, requirements are identified by the designer and provided in input to the specification procedure. As the number of requirements to be considered can be very high for a complex product, it would be helpful if at least some of the requirements could be automatically identified within the specification procedure. To do that, design requirements can classified into two distinct types:•functional requirements, which allow the product to achieve some mechanical functions (e.g. motion, sealing) with adequate precision;assembly requirements, which are to be satisfied so that the product could be correctly assembled from its parts.Among the two types, only functional requirements must be identified by the designer. Assembly requirements are related to part geometry and assembly relations, and can in principle be generated by a specification procedure without the need of providing them as input data.The assembly sequence is not usually considered among the data needed for specification. Although it simplifies the reasoning logic and makes it independent on process-related decisions, such choice involves possible loss of relevant criteria for the generation of tolerances (e.g. special needs on part precision due to assembly automation). Moreover, the assembly sequence can be viewed as a carrier of assembly requirements: as it will be shown later, each operation can be associated to one or more requirements, which are not canceled by subsequent operations. As a possible disadvantage, the assembly sequence is an additional input for the specification procedure, which could spoil the benefit gained from an automatic generation of assembly requirements; to avoid that, the assembly sequence itself should be automatically generated from product data by one of the methods proposed in literature for computer-aided assembly planning  [49].Regardless of the method, one of the possible limitations of a specification procedure is the limited traceability of generated tolerances, i.e. the difficulty to convey the rationale of their selection to the designer. A “canned” tolerance specification is likely to be of little use in a real-world design environment, where the results provided by a software tool will probably be modified and adapted to corporate standards and practices. The chance of establishing a logical path from the assembly sequence through design requirements to specified tolerances can help to trace specification results back to underlying technical reasons.In accordance with the above considerations, the proposed method has the structure illustrated in Fig. 2. Assembly requirements are generated from a geometric model of the product and from a planned assembly sequence. They are later added to user-input functional requirements and assigned to individual parts. For each part, requirements drive a tolerancing procedure which includes three main steps: an ordering of features according to empirical priority criteria, the selection of a datum reference frame for the part and the generation of tolerance types on each feature.Fig. 3shows a simple wheel assembly which will be used as an example throughout the description of the method. The specification procedure will apply to all parts of the assembly, although only a subset of them (1, 2, 3/4, 7) will have to be toleranced. As discussed before, input data for tolerance specification include geometric data on parts, a valid assembly sequence and possible design requirements imposed by the designer.The drawings in Fig. 4(a) show the features selected on parts for tolerance specification. As a general rule, a feature needs to be toleranced if (a) it has relations with features of mating parts, or (b) it has been assigned at least one functional requirement at design stage. However, in accordance with ASME and ISO standards, even features with no relation or function may be selected if they are easily accessed by fixture elements during machining and inspection, thus becoming candidates as datum features for the part. Such features have to be recognized and selected by the designer, although feature extraction rules could be developed for a CAD-based implementation.Feature data are shown in Fig. 4(b) for one of the parts (axle support). When a feature is a pattern of subfeatures with equal geometry and assembly relations, its description includes the number of subfeatures and the type of pattern (rectangular or polar). The type of feature is indicated by a classification which includes planar (single or multiple), cylindrical (external or internal), threaded (external or internal), width-type (i.e. consisting in pairs of opposed parallel planes, external or internal) and generic features. The direction associated to the feature depends on feature type (normal for planes, axis for cylinders and threads, one of the directions parallel to the planes for width-type features) and is either selected among reference axes or indicated as generic. Feature size is described by the surface area, possibly obtained by query or extraction from a CAD modeler. The ease of access to the feature by fixture elements is evaluated by a score, higher values being given to features oriented along reference directions and close to the outer envelope of the part. The value of such score is currently set by inspection, which require some practice and trial; in future developments, it will have to be calculated by some geometric rule to reduce the effect of subjective bias. The feature is eventually classified by a binary attribute of symmetry with respect to a possible rotation axis for the part. Additional data could be needed as a result of future improvements to the specification procedure.Fig. 5(a) illustrates the assembly sequence planned for the example, which assumes a manual process without positioning fixtures. Each assembly operation consists in placing (and possibly securing) a single part or subassembly on previously placed parts. As shown in Fig. 5(b), each operation creates one or more geometric relations among part features. For the purposes of tolerancing, assembly relations are classified into four types, including relations between features of size and three different types of surface contacts.A relation between features of size involves two cylindrical or width-type features which have opposing surfaces, coinciding derived features (axes or halfplanes) and whose distance between facing points is zero or lower than a conventional small value. The relation is specialized by an additional attribute indicating the occurrence of a clearance (c), press (p) or threaded (t) fit.Contacts between nonsize features are classified as seating, simple or nominal. A seating contact involves two surfaces which are intended to have at least three points of actual contact, which constrain at least two rotational degrees of freedom of relative motion between parts. Two surfaces in simple contact have at least one point of actual contact, which does not necessarily constrain relative rotations between parts. No point of actual contact is required between two surfaces in nominal contact, which are only bound to have distance equal to zero or lower than a given value in the geometric model of the assembly.Functional requirements are defined as relations between features of two parts. Applicable types of relations are classified similarly to assembly requirements, as it will be described in next section. In the example, two functional requirements are defined on the assembly: the gap between wheel and axle to be controlled for smooth relative rotation, and the axis of the wheel rim to be positioned at a precise distance to the supporting plane on the frame.The completeness of a specification procedure relies upon its ability to model all assembly requirements of practical interest. The proposed method assumes that assembly requirements occurring on manufactured products can be classified into four basic types. To illustrate them, the sketch in Fig. 6depicts possible violations of each requirement type on one of the parts of the example (axle support).A first type of requirement, designated as fit, is the need of controlled clearance or interference between two related cylinders or width-type features. The case shown at detail (a) violates a fit requirement since the axle is oversized with respect to the hole on the support, while a small clearance would be needed for the desired assembly condition.A mating is a condition on two surfaces (planes in most cases) whose actual contact area is to be controlled in order to limit orientation errors between parts. In case (b), form errors on either the lower face of the support and the related surface of the plate cause an excessive rotational displacement of the part, thus violating a mating requirement.A gap is an ending dimension with zero nominal value to be controlled on a chain of geometric relations. In case (c), a gap requirement is violated since the interference between the support and the step feature on the plate hampers a correct assembly. Although a different denomination will be maintained, this type of assembly requirement is equivalent to a functional requirement of positioning, which usually controls ending dimensions with nonzero nominal values (e.g. distances between surfaces or axes).As a last assembly requirement, a closure is the need to ensure a nominal relative orientation (a parallelism in most cases) between two planar or curved surfaces. Case (d) violates a closure requirement since the spotface on the support is misoriented to the nut, thus preventing its correct tightening.Assembly requirements are generated through an analysis of the assembly sequence. Each type of requirement is associated to a corresponding type of relation created in an assembly operation. The following associations apply:•a relation between features of size generates a fit, similarly specialized as of either clearance (c), press (p) or threaded (t) type;a seating contact generates a mating;a simple contact generates a closure;a nominal contact generates a gap.Fig. 7gives an overview of the requirements generated by the above rules on the assembly sequence of Fig. 5, showing the requirement type (fit, mating, closure, gap) for each of them. The number of requirements generated by an operation usually grows with the number of parts which come into relation with the placed part or subassembly. Since each operation generates at least one requirement except in few cases, the total number of requirements is close to the total number of feature relations, and can be very high for assemblies of realistic complexity.The whole set of generated assembly requirements and user-defined functional requirements provides a relational structure which links features through design requirements rather than through geometric relations deriving from product data. Such structure is essential for part tolerancing and can be delivered to the designer for an understanding of specification results. In the following, each part will be considered individually with its geometry and types of design requirements, with no further use of relational information.The first step of part analysis builds an ordering of features, which will be followed in the later steps of datum selection and feature tolerancing. The ordering is based on a priority score which represents the importance of the feature with respect to tolerancing. A more important feature will be more likely selected as a datum and will be toleranced before less important features which could reference it as a datum.The score of each feature is evaluated as a linear weighting of partial scores related to priority criteria, whose evaluations are listed in Table 1. The most relevant criterion gives priority to features whose associated directions are parallel to the coordinate axes of the assembly. A second criterion emphasizes the importance of features with larger surface area, with due consideration to the lower area of actual contact for special types of features such as threads and generic surfaces. Symmetry with respect to a possible rotation axis for the part and ease of access to machining and inspection fixtures are two additional criteria, which are directly evaluated by attributes included in feature input data. For a patterned feature, it is assumed that the eligibility as a datum decreases with the number of equal subfeatures. It is also acknowledged that the occurrence of functional requirements on a feature can slightly increase its preference as a possible datum.The last column of Table 1 reports a tentative weighting of the above scores, which has been calculated by the Analytic Hierarchy Process, a supporting technique for multicriteria decision problems  [50]. It consists in building a matrix of quantitative judgments, where the relative importance of each pair of criteria is expressed by a numerical preference rating. The consistency of judgments is then evaluated through the maximum eigenvalue of the matrix, and the priority vector is calculated by normalizing the corresponding eigenvector. The technique is said to provide more reliable decision models than a direct setting of weights, although it is still dependent on empirical and subjective bias. For this reason, calculated weights have been fine-tuned by running the tolerancing procedure on some examples in order to compare results to technically sound tolerancing specifications. The resulting scores for the example are annotated on part features in Fig. 8. Further validation of the method will possibly lead to an improved selection of criteria and related weights.Overlapped to the above feature ranking is the identification of principal features, which are given the highest precedence since they satisfy some special combinations of geometric types and design requirements. Principal features include planes with mating requirements and cylinders or width-type features with fit and gap requirements. They are denoted by ‘P’ in Fig. 8.The datum reference frame of the part is chosen in the subset of principal features by selecting them in priority order. This rule is followed with two exceptions. If the part has two cylindrical features classified as rotation supports (an additional attribute provided in input by the designer), these are chosen as a combined primary datum. If the principal features include one or more planes, the one with the maximum priority score is chosen as a primary datum regardless of the presence of other types of features with higher scores.Not all principal features are necessarily included in the datum reference frame. Some of them could actually be kinematically irrelevant with respect to those previously selected as datums. The recognition of those situations is based on the degrees of freedom (DOF) of each candidate feature, i.e. on the translations and rotations in the directions of reference axes that must be controlled through tolerances. If a feature has an associated direction parallel to a reference axis, its degrees of freedom are evaluated as follows: (a) a planar or width-type feature has a translational DOF in the associated direction and two rotational DOF in the perpendicular directions; (b) a cylinder has two translational DOF and two rotational DOF in the perpendicular directions; (c) a pattern of parallel cylinders has all translational and rotational DOF except the translation along the associated direction. For any feature whose associated direction is not parallel to a reference axis, all translational and rotational DOF are considered for datum selection.An initially empty set of DOF of the part is updated by union with the set of DOF of each new selected datum. A principal feature is ruled out as a possible datum if it leaves the set of part DOF unchanged. As shown in Fig. 8, the features selected as datums are named with letters A, B, C, etc. in order of precedence.Part features are analyzed in the final phase of tolerance generation. For each feature (referred to as a target) one or more geometric controls will have to be identified, each including a type of tolerance, a modifier (for features of size) and possible datums selected among previously toleranced features. Features are toleranced in a sequence deriving from the priority classifications described in the previous section. It divides the features into three classes: (a) datums; (b) other principal features; (c) remaining features subject to design requirements. Within each class, precedence is given to features with higher priority score.The analysis begins by checking two conditions, corresponding to special tolerancing cases. If the target is a feature of size, it is assigned a size tolerance. If the target is a pattern of size features, it is assigned a position tolerance whose single datum is a perpendicular plane selected among principal features in order of priority. The occurrence of feature-relating basic dimensions is reported through a generic indication depending on pattern type (grid distances for rectangular patterns, diameter and angular position for polar patterns). The modifier is chosen according to the assembly requirement associated to the feature: maximum material condition (MMC) for a clearance fit, regardless of feature size (RFS) for a press fit, projected tolerance zone (PTZ) for a threaded fit.Although it is not always required in practice, the proposed method always specifies explicit geometric tolerances on datums rather than relying on general tolerances or envelope conditions. The primary datum is the first toleranced feature and the only one that is assigned a form (unreferenced) tolerance. The remaining datums are controlled to previously toleranced ones at least at an orientation level. For each of them, tolerance type is specified from feature type according to the cases listed in Table 2. In the case of a size feature, the modifier is selected according to the assembly requirement by the already described rule.From the second toleranced feature on, orientation or location controls are specified. For a nonprincipal feature subject to a closure requirement, no location control is needed and feature orientation is controlled by a tolerance which only references the primary datum. The tolerance type is selected according to the characteristics of both target and datum (types of features, geometric relations) by the rules listed in Table 3. Geometric relations between target and datum are easily derived from associated directions.The default case includes all remaining occurrences (principal feature, nonprincipal feature subject to either a positioning functional requirement or a gap requirement). Applicable orientation or location controls are selected by considering all relations of the target to already toleranced datums. These are analyzed in priority order only if they provide additional degrees of freedom to be controlled on the target. This condition is verified as already described for datum selection. The type of tolerance on the feature and possible basic dimensions are selected by the rules listed in Table 4, with a possible MMC, RFS or PTZ modifier according to the type of assembly requirement on the target.Once all datums have been analyzed, the feature has been assigned either an orientation tolerance, or a location tolerance, or a location and an orientation tolerance joined in a composite tolerance frame. In accordance to standards, possible surface profile tolerances can be used with meaning of either orientation or location control according to the referenced datums and to whether they appear in the upper or lower segment of composite tolerance frame.Fig. 9shows the detailed application of the procedure to one of the parts of the example (axle support). Features are listed in precedence order with the same numbering of Fig. 4, indicating the datum identifier or the priority score from Fig. 8. For each feature, the sequence of applied rules is reported in order to justify the selection of tolerance types, modifiers and basic dimensions. These are eventually shown in feature control frames completed with size tolerances when applicable.

@&#CONCLUSIONS@&#
The research work reported in this paper is motivated by the difficulty of assigning correct and complete tolerance specifications to a product. As long as the task of recognizing the many requirements for fit and function is completely left to the designer, it is likely that the some of them are neglected in part tolerancing. Therefore, the definition of requirements is a step that needs to be rationalized and at least partially automated. The proposed approach does that for a large part of requirements, which are directly linked to feature relations created in assembly operations. A software implementation of this logic can help to reduce the amount of input data for the specification tool in the presence of an interactive CAD environment.The direct association between assembly relations, requirements and tolerances is also useful to make the designer more aware of the reasons behind the specifications provided by a software tool. To exploit such a chance, a special effort will have to be put on user interaction. In the input phase, changes to geometric relations and functional requirements will have to be easily made in order to perform what-if analyses on tolerance specifications. In the output phase, text reports or effective graphical presentations will have to be provided to the designer for an easy interpretation of the reasoning steps behind generated tolerances.