@&#MAIN-TITLE@&#
Image time series processing for agriculture monitoring

@&#HIGHLIGHTS@&#
Image time series analysis is of increasing relevance for environmental monitoring.Dedicated tools are needed to process remote sensing image time series.SPIRITS is free software to process image time series for crop monitoring.SPIRITS has a user-friendly interface and is extensively documented.

@&#KEYPHRASES@&#
Remote sensing,Early warning,Environmental monitoring,Yield forecasting system,Crop and vegetation monitoring,

@&#ABSTRACT@&#
Given strong year-to-year variability, increasing competition for natural resources, and climate change impacts on agriculture, monitoring global crop and natural vegetation conditions is highly relevant, particularly in food insecure areas. Data from remote sensing image series at high temporal and low spatial resolution can help to assist in this monitoring as they provide key information in near-real time over large areas. The SPIRITS software, presented in this paper, is a stand-alone toolbox developed for environmental monitoring, particularly to produce clear and evidence-based information for crop production analysts and decision makers. It includes a large number of tools with the main aim of extracting vegetation indicators from image time series, estimating the potential impact of anomalies on crop production and sharing this information with different audiences. SPIRITS offers an integrated and flexible analysis environment with a user-friendly graphical interface, which allows sequential tasking and a high level of automation of processing chains. It is freely distributed for non-commercial use and extensively documented.SPIRITS (Software for the Processing and Interpretation of Remotely sensed Image Time Series)Herman Eerens, Dominique Haesen, Contact address: Boeretang 200, b-2400 Mol, Belgium (herman.eerens@vito.be, dominique.haesen@vito.be)2013PCMicrosoft Windows (XP or later), Java (version 1.6 or higher)C, Java240 MBhttp://spirits.jrc.ec.europa.eu/, https://rs.vito.be/africa/en/software/Pages/Spirits.aspxFree for non-commercial useManual, tutorial with test data, training sessions

@&#INTRODUCTION@&#
The analysis of image time series, particularly those derived from remote sensing, is of increasing relevance for environmental monitoring (e.g. ocean, forests, fires, land use/land cover change, flooded areas, climate change, water bodies, ecology) over large areas, and vegetation and crop monitoring is no exception. In fact, agricultural production depends on a series of factors that are highly variable over space and time. The 2007/2008 food price crisis has brought back to the spotlight the impact of sudden changes in global crop production in a context of growing pressure on natural resources, increasing uncertainty linked to climatic change and high levels of vulnerability to food shortage in politically unstable areas such as the Sahel and the Horn of Africa (FAO, 2009). Remote sensing significantly contributes to agricultural production assessments thanks to its capacity to collect information over large areas and with a high temporal frequency (Atzberger, 2013; Baruth et al., 2008; Zhao et al., 2013). Satellite data made available to users in a timely manner by sensors such as SPOT-Vegetation (VGT) (e.g., Maisongrande et al., 2004), Terra/Aqua MODIS (e.g., Cracknell, 1997), NOAA AVHRR (e.g., Justice et al., 1998), Metop AVHRR (e.g., Eerens et al., 2009) and Meteosat MVIRI/SEVIRI (e.g., Fensholt et al., 2011) play a key role in assessing crop conditions in a qualitative manner and identifying potential production deficits at the end of the cropping season. Methodologies have been constantly improved since the 1980's for using satellite derived biophysical indicators directly as proxy for crop yield (Tucker et al., 1980) or as inputs for quantitative crop growth and biomass estimation models (Baret et al., 1989; Delécolle et al., 1992). A review on this evolution has been published by Rembold et al. (2013). However, to transform the data embedded in these images into useful information for decision support, analysts need a software environment able to manage in an integrated way both the spatial and temporal dimensions of the time series (Rasinmäki, 2003).Most of the available GIS and image processing software packages do not provide a complete range of built-in functionalities to handle time series of images (Babu et al., 2006), and are not optimized for the needs of the crop monitoring community. In the 1990's the Food and Agriculture Organization (FAO) developed the free WinDisp software (http://www.fao.org/giews/english/windisp/), which marked a clear effort in this direction and became a widespread tool in developing countries. Unfortunately the development of WinDisp stopped in 2003 and the tool has become obsolete. Advanced crop monitoring analyses can be conducted with standard image processing software (e.g., IDRISI, http://clarklabs.org/; ENVI, http://www.exelisvis.com/; GRASS, http://grass.osgeo.org/, Neteler et al., 2012), statistical packages (e.g., MATLAB, http://www.mathworks.it/; R http://www.r-project.org/) or spatial databases (e.g., PostgreSQL/PostGIS, http://www.postgresql.org/, http://postgis.refractions.net/). However, these tools are generic in nature and their use for advanced image time series processing requires specific programming skills, remote sensing knowledge and long program development efforts. Such capacities are not always available in institutions dealing with agricultural monitoring and early warning.Some tools partially address the needs of the agricultural monitoring community, for instance the e-station (http://estation.jrc.ec.europa.eu/, Clerici et al., 2013), which focuses on African conditions, and other online platforms such as the Global Agriculture Monitoring (GLAM) (Becker-Reshef et al., 2010), CropExplorer (http://www.pecad.fas.usda.gov/cropexplorer/), the MARS web viewer (http://www.marsop.info/marsop3/) and the interpretation tools of the United States Geological Survey (USGS) portal ADDS (http://earlywarning.usgs.gov/fews/). All these tools are mainly designed to directly provide users with the standard outputs of remote sensing analyses such as Normalized Difference Vegetation Index (NDVI) (Rouse et al., 1974) and rainfall status, anomaly maps and graphs of temporal profiles. However, they generally do not offer a flexible image processing environment that can be used by technicians and involved institutions to adapt the data analysis steps and generate additional and customized outputs.Other online applications offer services related to image time series acquisition and processing, but they are designed for either very specific purposes (e.g., fires, Díaz et al., 2013; habitats, Dubois et al., 2013) or are typically generalised (e.g. visualization tools, Blower et al., 2013).The TIMESAT tool (Jönsson and Eklundh, 2004) is quite flexible but it focuses on the extraction of phenological parameters and it lacks a graphical user interface. TimeStats (Udelhoven, 2011) offers some advanced tools for data mining in long-term remote sensing data archives but is mainly addressed to advanced users (i.e., remote sensing experts). Finally, gro-meteorological modelling packages such as GeoWRSI (FEWSNET, http://chg.geog.ucsb.edu/products/geowrsi/) and AGROMET-SHELL (FAO, http://www.hoefsloot.com/agrometshell.htm) also work with time series of raster data (mainly meteorological data) but they are not optimized for the processing of remote sensing imagery.We can therefore conclude that none of the existing systems provides in one package the highly specific set of time series processing functions to assess crop and vegetation status, including temporal smoothing, detection of phenological stages, computation of long term averages and anomalies, classification based on vegetation seasonal performance, and production of the outputs traditionally used in crop monitoring bulletins (statistics, maps, graphs). For this reason, a flexible and user-friendly interface, targeting both national and international agriculture and food security experts, is highly desirable (Gommes et al., 2011). There is a clear need for dedicated software with optimized functions to efficiently process and analyse large image archives. This is particularly relevant in view of imminent satellite constellations such as the European Space Agency's (ESA) Sentinel program (Petitjean et al., 2012), which will combine both high spatial and temporal resolution making an improved software approach even more urgent. Finally and especially in developing countries, free software can play an important contribution to capacity building for local institutions, which are the main actors in the design and implementation of prevention and response policies to potential food crises.SPIRITS is an integrated, modular software platform that aims at answering the requirements outlined above. The software is extensively documented and distributed freely for non-commercial use.SPIRITS is developed in JAVA and runs under Windows. The version currently available (July 2013) is 1.1.1. Originally it was conceived as a graphical user interface (GUI) around a software called GLIMPSE (GLobal IMage Processing SoftwarE), also developed by the Flemish Institute for Technological Research (VITO). GLIMPSE consists of a set of ANSI-C executables performing a wide range of dedicated image processing tasks. The GLIMPSE modules can only be accessed via a command line interface, but they can be scripted to set up complex processing chains. SPIRITS provides a convenient GUI, which enables to guide the GLIMPSE modules via an up-to-date interface and to run them in the background. However, over the years SPIRITS was extended with many (non-GLIMPSE) modules enabling, for example, the import of imagery in external formats, the generation of maps and the extraction of regional databases. To this goal, it makes use of open source libraries such as GDAL (http://www.gdal.org/), FWTools (http://fwtools.maptools.org/) and HSQLDB (http://hsqldb.org/), which are included in the SPIRITS installer.For each function, SPIRITS provides an adapted GUI that allows users to enter the relevant parameters, assisted by tooltips and an interactive help system. Once the parameters have been set, the tools can be executed for a single input image or in a loop for a complete time series. Extensive error controls provide feedbacks in case of erroneous inputs. Different tasks can be launched and are processed sequentially, whilst a progress bar indicates the evolution of each action. The results of former tasks can be recalled at any time. A typical example of the SPIRITS GUI is shown in Fig. 1.Settings can be saved and reused in order to automate processes that have to be repeated whenever new images become available. Multiple operations can be performed in a sequential way so that complex, multi-step processing chains can be launched at once as subsequent jobs only start once previous jobs have finished. Statistics can be extracted from the images for different administrative regions and thematic units (typically land cover types). These are stored in an internal database and then used to create graphs. Maps and graphs created for the analysis of a particular variable and region can be saved as templates and easily reused for application on complete time series or sets of regions.SPIRITS works with 2D-flat binary image files. “2D-flat” means that the layers of a multi-spectral or multi-temporal set are stored as separate files. The ancillary information (“metadata”) must be present in an additional ASCII-file with the same name as the image but with extension “.hdr”. For the latter, the rules of the ENVI software are followed, although new keywords have been added to provide more information on the image values, their scaling to physical units, the presence of flags (i.e. codes to label special features such as sea, clouds, snow), acquisition date and periodicity (at the moment only daily, ten-daily, monthly and annual images are allowed). The direct interoperability with ENVI is a clear advantage since ENVI is one of the most comprehensive image processing software applications available and it includes an advanced image visualisation environment. Moreover, ENVI-formatted files can be directly read into other software packages like for example ArcGIS and ERDAS Imagine. Other external data can be easily reformatted to the set standards with the SPIRITS import module (see Section 3.1).SPIRITS has been developed for the monitoring of vegetation conditions with medium to low resolution satellite image time series, but many of the tools can also be applied to other types of raster data. In its prevalent use in crop monitoring, common image series contain ten-daily reflectances, vegetation indices such as NDVI or biophysical parameters such as Fraction of Absorbed Photosynthetically Active Radiation (FAPAR) and Dry Matter Productivity (DMP). Also gridded meteorological data derived from atmospheric circulation models (e.g., European Centre for Medium-Range Weather Forecasts – ECMWF) or from geostationary satellites (e.g., METEOSAT) are typically processed.This section briefly describes the main modules available in SPIRITS per functional category. Whenever relevant, all programs can be applied either on a single image or on a time series. The SPIRITS manual (see Software Availability) provides a complete overview and more in-depth discussions of the algorithms.All formats supported by the GDAL library (e.g., Geotiff, HDF4, ILWIS and many others, for a complete list see http://www.gdal.org/formats_list.html) can be converted to the SPIRITS standard format (ENVI with enriched header file). Specific import modules are also included, i.e., for SPOT-VGT, IDRISI, multi-temporal ENVI image stacks, and gridded meteorological data in ASCII format.ESRI shapefiles are rasterised into a user-defined grid.Images belonging to a time series must include their reference date in the file name according to specific rules. This tool helps to rename files to the SPIRITS conventions.This group of modules converts SPIRITS images to the formats of IDRISI and ESRI (.BSQ, .BIL, .BIP). A selected set of images can also be combined into a single multi-temporal layer stack file (according to ENVI standards).A rectangular region of interest (ROI) is extracted from an input image.An input image is resampled to a user-defined output grid (i.e., resolution and extension) in the same reference system.Starting from a high-resolution raster classification with N classes, N low resolution Area Fraction Images (AFIs) are derived with the area fractions of every class in each coarse resolution pixel. The AFIs can be used for the computation of the Regional Unmixed Means (see Section 3.6).An input image is spatially smoothed using a moving window with variable size and one of the available filters (e.g., mean, median, mode).The original image values are rescaled or modified according to a user-defined scheme. Examples of possible actions: modification of data type (byte, short/long integer, float), stretching, histogram equalisation, reclassification.This module allows computing a wide range of vegetation indices, by combining two or three input images via a selected operator.Selected image pixels are masked according to the values in another image (e.g., a crop mask or a country mask).The information of a status mask image (e.g., water, cloud, snow) is transferred as flags into another image (e.g., NDVI).Images with Dry Matter Productivity (kgDM/ha/day) or Net Primary Productivity (gC/m²/day) are derived by applying a Monteith algorithm (Veroustraete et al., 2002) on FAPAR images from remote sensing and meteorological information.Unsupervised classification using an enhanced iso-clustering algorithm (see e.g., Memarsadeghi et al., 2007).The noisy observations (e.g., clouds, snow) in a time series of any vegetation index (e.g., NDVI, FAPAR) are detected and replaced by means of a modified version of the algorithm of Swets et al. (1999).Several input images in a given period (e.g., dekad) are composited using one of the available criteria to select the best available set of observations per pixel (i.e. maximum, minimum, mean), optionally with conditions on other variables (e.g., scan angle, status map). This module generates for example ten-daily or monthly composites from daily data. This module can simultaneously mosaicks images from different adjacent scenes to a fixed output frame.A temporal average or summation is calculated between two given dates.By analysing a 10-daily series of any vegetation index, the dates of the start (SOS) and end (EOS) of the single or double growing seasons are defined, using a modified version of the pixel wise adaptive thresholding technique proposed by White et al. (1997). Different percentage thresholds of the min–max NDVI range can be set by the user. It works both for individual years and LTA.A temporal average or summation is calculated between two (pixel-specific) different dates, the first being the SOS, the second being either EOS or the current date if the season has not yet finished.A multi-annual time series is analysed and for each pixel and period (e.g., the 36 dekads or 12 months in the year) the long-term statistics (e.g., mean, minimum, maximum, median, standard deviation) are derived and written to new images.Actual images are compared with the corresponding long-term statistics (or with the previous year) and new anomaly images are derived using operators such as the absolute, relative or standardized difference. Also the Vegetation Condition Index (Kogan, 1995) and Vegetation Productivity Index (Sannier and Taylor, 1998) can be computed. The complete list of available operators can be found in the software manual.This module compares a time series of the current year with its equivalents of other years in order to detect (per pixel) the most similar year. Also the current year can be compared with the long-term average to define (per pixel) the overall shift (advance or delay) of the current season with regard to the average.This tool assesses crop yields based on the assumption that the yield of the current year will most closely resemble the yield of the most similar year (method of analogues). The module combines the results of the similarity analysis with external information that should be provided by the analyst (database with the official yields of the concerned crop per year and per region).Via a dedicated GUI the user can specify and parameterise all map elements (i.e. image type, title, legend, colours, vectors in overlay, logos). The specifications can be stored in a map template, to be used repetitively for time series of images.By overlaying an image set with the corresponding regions map (e.g., administrative units, ecological zones) and land use map (hard classification or a set of AFIs, see Section 3.2), ASCII-formatted files with regional unmixed means (RUM) are extracted, i.e. the mean values of the concerned image variable, per region and land cover type. The RUM-values are then ingested into an SPIRITS relational database (HSQLDB) previously defined by the user. The final RUM database contains the time series of different variables per region and land cover type.This tool allows for the display of the contents of the RUM database in the form of cartesian graph where X-axis is time and Y-axis can be any variable (e.g., NDVI, DMP, rainfall). Dedicated graphs can be composed and once settings are stored, they can be applied on sets of regions and land unit types. Moreover, the graph composer can display some additional time series (e.g., long-term averages and anomalies) computed on fly from the RUM-values in the database.Via a dedicated GUI, one or more external programs (e.g., files with extension .exe, .bat, .pty) can be declared together with their required arguments. Dedicated processing chains can be established by concatenating different programs and/or internal commands. All definitions are stored as a User Tool, which later can be run as if it were integral part of the SPIRITS software.This section presents three examples of typical processing chains and graphical outputs generated by the SPIRITS software. They provide information that is commonly presented when monitoring crops or drought over large areas. Currently, these SPIRITS outputs are directly used in the agro-meteorological and early warning bulletins produced on a regular basis by a wide range of agencies.The first example concerns the production of a time series of NDVI anomaly maps (absolute deviation from the long term average, in this case calculated for 1999–2010) derived from ten-daily images of SPOT-VGT over the Horn of Africa in 2011. Fig. 2outlines the steps involved in the workflow, while map outputs are shown in Fig. 3. Note that anomalies are reported here on a qualitative scale based on user-defined thresholds. The absolute anomaly values could also be plotted, and map classes and colours could be changed depending on user preferences.In the second example, the FAPAR derived from SPOT-VGT is cumulated over the cropping season of the year 2009 in Niger and northern Nigeria as illustrated in the synthesis map in Fig. 5. It shows the mean anomaly of FAPAR cumulated per pixel from the start of the season to the first of September compared to the historical mean. The progress of the cropping season for each pixel is also illustrated. These outputs are generated via the steps outlined in Fig. 4.The third example concerns the extraction of the average values of NDVI (SPOT-VGT) and 10-daily rainfall estimates (TAMSAT), per administrative unit and land cover type in 2013 in Kenya. In this case, a crop mask is used as land cover type (Vancutsem et al., 2013). The processing workflow is illustrated in Fig. 6, while Fig. 7shows the graphical outputs.SPIRITS is a freely distributed software developed in close collaboration with agro-meteorological and crop monitoring experts to provide decision making processes with science-based information. The user support includes a manual, a tutorial with a “Quick Start” section and test data sets, a website with a forum, a mailing list, a wiki and a data download section, and frequent trainings. SPIRITS integrates a large set of tools to process and analyse image time series and to produce maps and graphs for vegetation status analysis, as typically needed in the production of agro-meteorological bulletins. Although it can be used in a number of different environment-related domains, SPIRITS was primarily developed to analyse low resolution, high frequency satellite images for crop production monitoring. Its use is already consolidated in many institutions such as the Joint Research Centre (JRC) – Monitoring Agricultural Resources (MARS) unit, FAO, VITO, and several African Agencies related to early warning, where it has demonstrated its effectiveness to deal with image time series. The added value of SPIRITS is that it simplifies and significantly speeds up complex processes in a unique environment, giving users without programming skills the opportunity to perform and automate advanced analyses, to quickly process and plot large volumes of image derived statistics managed in the built-in database, to explore different approaches and to tune analyses on their needs.SPIRITS development will continue with support from the JRC and VITO. A number of technical improvements has already been identified. This includes compatibility with new image formats such as HDF5 as well as enlarged functionalities of database operations in the graph viewer such as the computation of standardized differences. Other improvements foresee the implementation of basic image reprojection functionalities as well as a larger choice of time series smoothing algorithms.We believe that the current version of SPIRITS provides a good combination of functionalities and performance in a simple environment. The overall architecture, which combines C-modules, a Java GUI and several existing open source libraries, provides a simple and flexible answer to the needs of raster time series processing. On the longer term adaptations could be considered to increase the multi-platform compatibility and to release the whole package as open source.

@&#CONCLUSIONS@&#
