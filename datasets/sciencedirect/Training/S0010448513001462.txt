@&#MAIN-TITLE@&#
Footwear bio-modelling: An industrial approach

@&#HIGHLIGHTS@&#
We present two interrelated models for shoe customisation.We present a bio-deformable model of the foot.We present a deformable model of the shoe last.Both models are used to successfully make customised shoes.

@&#KEYPHRASES@&#
Deformation techniques,Customised footwear,Footwear production,

@&#ABSTRACT@&#
There is a growing need within the footwear sector to customise the design of the last from which a specific footwear style is to be produced. This customisation is necessary for user comfort and health reasons, as the user needs to wear a suitable shoe. For this purpose, a relationship must be established between the user foot and the last with which the style will be made; up until now, no model has existed that integrates both elements. On the one hand, traditional customised footwear manufacturing techniques are based on purely artisanal procedures which make the process arduous and complex; on the other hand, geometric models proposed by different authors present the impossibility of implementing them in an industrial environment with limited resources for the acquisition of morphometric and structural data for the foot, apart from the fact that they do not prove to be sufficiently accurate given the non-similarity of the foot and last. In this paper, two interrelated geometric models are defined, the first, a bio-deformable foot model and the second, a deformable last model. The experiments completed show the goodness of the model, with it obtaining satisfactory results in terms of comfort, efficiency and precision, which make it viable for use in the sector.

@&#INTRODUCTION@&#
Footwear comfort is one of the most important aspects to be taken into account by footwear production companies  [1,2]. Comfort is perceived by users as directly related to the successful purchase of a product and also the medium and long-term health effects of the product. The perceived comfort analysis of footwear use has been addressed through different approaches  [3–5], many of these focus on the fit analysis of the footwear style, such as in  [6], in which the problem of women’s footwear fitting was addressed, where the aesthetic considerations of the model have special effects on the fit evaluation of the shoe. Footwear users increasingly demand products with improved performance   [7,8] with a variety of designs and renewal of collections on the market  [9]. This market revolution acts as a stimulation for the footwear industry that is being modernised through the introduction of CAD technology in its processes, which allows the sector to save costs and time in the development of a product. The suitability of footwear for a specific foot with any kind of inherent problem, whether this be major or minor, is the main problem for made-to-measure footwear manufacturers, as there is currently no parametric model that is capable of self-configuration of design according to the reference feet.Recent studies define CAD tools used to create custom shoes for general  [10] and specific medical issues, such as for diabetic patients, who suffer from the disease called “diabetic foot” [11,12]. There are a wide range of studies on musculoskeletal models  [13–21]. There are also a number of scientific contributions being made to the study of computer graphics, some exclusively centred around human muscular anatomy and not on dynamic simulation, such as  [22–26]. These authors have developed volumetric muscular models in order to simulate muscle behaviour through active and passive components. In  [27] an elastic linear model is used for muscle simulation and deformation using finite element methods. In  [16,28] a muscular model was created to animate virtual models of the human body (character animation). Musculoskeletal models have also been widely used for facial animation  [29–31]. In  [32] a structural model of the human anatomy is proposed based on deformation through the articulation points of human body virtual models. In  [7] a neuro-muscular control model is used for the simulation of the human knee.The first studies, in which the characterisation and simulation of the lower limbs and the interconnection of the skeletal and muscular behaviours were attempted, were those by  [33], who developed a musculoskeletal model of the human lower extremity to allow computer simulation. This model incorporates the salient features of muscle and tendon, specifies the musculoskeletal geometry and musculotendon parameters of eighteen musculotendon actuators, and defines the active isometric moment about the knee and ankle joints. In  [34], the effect of the human foot’s tendons on the deformation of the foot surface was analysed. This stresses the importance that modelling has, not only of muscles and bones, but tendons as well as there are also certain forces that have effects on the system’s modelling and simulation, affecting the final foot surface deformation. Later research by these authors  [35] widened ligament–tendon modelling using forces related to curves and mass–springs that deform the foot surface, simulating the tendon’s position. There are contributions related to the simulation of plantar pressures obtained through the application of force on a foot  [36] in which, through finite element techniques, a foot is modelled according to the pressures measured on the foot plantar area, taking the influence of the foot’s bones and the application of a certain force into account.In the customised footwear manufacturing process, there is a challenge that makes these models difficult to apply in the industry. In the previously mentioned models, the anatomical information of the bone structure of the limb to be deformed is needed, including the muscular–tendon representation of the foot, and this requires high cost equipment to be available, such as a CT scanner, as well as the software for the reconstruction and later linking of the geometry represented by the skeleton and the foot surface in order to carry out the deformation. It is therefore necessary to include the following constraints in the definition of the model: Efficiency, in the acquisition of the foot geometry with a short timeframe and at a low cost; Effectiveness, for the application of deformation techniques that make the deformation and positioning of the foot possible with the available information and subject to the previous constraint.The models proposed in this paper meet the precision, flexibility and efficiency requirements needed by the footwear industry. The model presents two clearly differentiated aspects to meet the requirements established by the footwear customisation process: first, the deformation of the foot for its adaptation to the sole profile curve (pitch) of the last with which the comparison is made; and second, the deformation of the last according to biomechanical criteria related to the reference foot.This paper is structured as follows: Section  2 analyses the problem of suitability of the last for the foot, critically reviewing various works on the topic; Section  3 defines the geometric models: on the one hand, the bio-deformable foot model, which is characterised in terms of the morphological information of the model and is deformed according to such information, and on the other hand, the deformable last model, characterising the last and defining a group of tools that allow the controlled modification of the last. The deformation and modification operations carried out for the foot and last respectively are then translated to the production of customised footwear. Section  4 presents a real case carried out in real production environments, which proves the goodness of the models.The last, the main element in footwear production, constitutes the base for the footwear lasting process: the way in which the user perceives the necessary level of comfort to wear a pair of shoes and carry out his/her daily activities depends greatly on the last. The last is a geometric body with similar (but not equal) dimensions to those of the foot, and certain factors have to be taken into account which, if correctly defined, allow the design of the last.There is a set of measurements that are obtained from characteristic points or landmarks on the last which allow the approximate definition of the last (see Fig. 1). These measurements characterise the last quantitatively, providing useful information for comparison with feet. However, one cannot be certain that a determined set of measurements provides the best possible last, in terms of fitting, since there are certain external factors, such as the type of footwear being made, the use of the footwear and the type of reference foot, which constitute a source of uncertainty that requires a different kind of analysis. There are a number of requirements related to footwear fit, which means that the shoe does not have to be totally fitted for the foot  [6,37]. The footwear lasts are narrower in certain areas than feet  [38], which does not cause pain or discomfort in the foot due to the foot’s ability to vary its physiological structure and adapt itself to the inside of the shoe. Different authors have attempted different approaches in the last few years in order to parameterise the design of a given last with regard to the surface of the foot. In  [39] the modification of the last through space deformation techniques based on Free-Form Deformation (FFD) was presented, in order to compare certain characteristic measurements of the reference foot with the last. This deformation approach was insufficient, as FFD cannot correctly define the in-shoe deformation of a foot. Also, the last deformation carried out does not guarantee correct fitting as a whole, as the anatomical characteristics of the original last can be lost (see Fig. 2).In other works, systems were inferred to guarantee better fitting between the foot and the last, such as the work by  [40] in which certain measurements were compared through comparisons between a reference foot and a database with feet linked to lasts. In this approach, the digitised reference foot is positioned with regard to the other foot and compared through the calculation of the error function of the weighted distances. This requires a pre-adjustment between the lasts and the reference feet to be compared, although this cannot guarantee that the fitting obtained will be correct. In the work by  [41] the determination of certain key points on the foot sole which need to be taken into account to carry out the fitting is considered. This method establishes a basic definition for the acquisition of the footprint of the sole from the detection of certain characteristic points. The fitting process is restricted to the sole of the foot and does not consider the volume as a whole, thus losing valuable information in the process, which is needed to guarantee correct fitting. In  [42] general volumetric deformation methods are included for the adaptation through distance maps between objects. In this work, the last is deformed according to the distance to the reference foot, deformation which intends to approximate the last to the foot without substantial modifications of the basic structure of the shoe last. This method is not efficient for customised footwear manufacture, in that the resulting lasts can end up being aesthetically incorrect and may not guarantee correct fitting, as a last does not completely correspond to a certain foot’s geometry. In  [43] a basic last is obtained from the foot surface through the transformation of the surface using deformation techniques based on the Laplacian operator  [44]. This method poses the problem of the planar acquisition of the foot geometry and compares it with that of a last the sole of which does not lie completely flat on the ground; hence the information relevant to the fitting of a shoe is omitted. Similarly, in  [45] a method is proposed for the analysis of the suitability of a last to a certain foot, through the comparison of a reduced number of sections obtained from both the foot standing flat and the last. However, it is noticed that in this work, the tests were carried out with a low-heeled last and the aesthetic shape of its toe is characterised by smooth shapes. With this type of approach, through the analysis of a flat foot and a last with low pitch, a wide range of lasts, which are typically highly demanded in high-end footwear, is neglected.In contrast to the previously mentioned works, in which the models are basically static, this paper proposes a different approach for the resolution of the problem with high-level footwear customisation as the fit is achieved dynamically.The foot is normally digitised in a resting position, supported by the ground plane, with no heel height. However, the lasts which are later used to last the footwear do have a heel height, thus making the comparison difficult. Matching a foot to a last if the foot is not adapted to the plantar curve defined by the last is a complex task. It is necessary for the foot to take the sole shape of the last and be placed at the corresponding heel height in order to make a comparison. Making this modification in the foot’s original geometry requires a biomechanical study of the foot, defining how certain areas of the foot deform and articulate. The achievement of the best possible fit between the foot and the last is the goal, as, in the fitting of a shoe, the suitability of the last to the reference foot is a decisive factor when a user decides to buy a pair of shoes and is therefore fundamental in the perception of comfort  [46–48]. To date, it has been impossible to know how the dimensions and footwear shape and its interaction with the foot affect subjective comfort perceived by the user  [2,49].Below, each of the elements that form part of the model is characterised. In an industrial environment, the starting point for the customised footwear production process is the creation of an industrial elementEbase, called the last, which is used as an indispensable and fundamental element for the production of anEfinalindustrial element, called the shoe, that must meet a certain set of quality criteriaCbio-basewhich guarantee the proper suitability of the product to the final user. In order to pass these quality controls,Efinalmust be manufactured usingEbase, which in itself is subject to a set of restrictionsRbasegiven by a biological element,Ebio, called the foot, which belongs to a biological system,Sbio, where a set of restrictions,Rbio, can be found which biomechanically characterise its structure and functionality.Table 1specifies each of the parameters to be considered in the model. Meeting the quality criteriaCbio-baserequires the application of a set of deformations made toEbioandEbase. The set of deformations to be applied toEbioare described byDefbiowhich remains subject to the biological restrictions defined in theRbioset and the set of deformations to be made toEbase, which are described inDefbasewhich in turn remains subject to the restrictions imposed by theRbaseset. It is graphically possible to represent the model according to the flow diagram in Fig. 3.As a link for all the elements indicated above, two models have been developed, which are dynamically interrelated and are capable of meeting the requirements established in the initial description of the problem. These models became defined as•Bio-deformable model,MDbio={Ebio,Rbio,Defbio}.Deformable model for the industrial element,MDbase={Ebase,Rbase,Defbase}.The bio-deformable foot model is defined asMDbio={Ebio,Rbio,Defbio}. The definition of a series of measurements that characterise the foot is necessary in order to be able to apply deformations to the foot and adapt it to the pitch curve of the last, restricting the foot joint movement in the process. These measurements11The characteristic measurements of both the foot and the last have been defined according to the specifications of the Footwear Technological Institute (Inescop), which establish a series of characteristic points and measurements for feet and lasts that are useful for their application in the manufacture of customised footwear. These specifications are currently being analysed and used in various international projects through the technical standardisation committee ISO TC/137 “Footwear sizing designations and marking systems”, with the objective being to convert them into an international standard for footwear so that their formal specification and usefulness are unified and thus can be used by the sector’s companies.are taken as a reference to obtain the anthropometric foot measurements (see Fig. 4).To carry out the deformation of the foot (Defbio), a cage-based deformation method has been used  [50]. This technique, widely used for rigging provides a flexible space control of the geometry to be deformed at a relatively low computational cost. The deformation through three-dimensional control cages developed in  [50] introduced this new approach which is based on the concept of the “Mean Value Coordinates” (MVC) established by  [51] to define the weight functions that govern the deformable space. Initially, Floater introduced the MVCs for two-dimensional polygons as a way to achieve smooth information interpolations in polygons. Later, in  [52] the method was expanded, applying it to three-dimensional triangle meshes. Other works appear in the area of automatic deformation control mesh creation: in  [53] the semi-automatic creation of skinning templates is proposed for use through these deformation techniques.Cage-based deformation techniques provide three characteristics that are decisive for their application in customised footwear:•Speed. Given that the acquisition of the control object should be done quickly and at low computational cost, the amount of interaction of the final user in the foot deformation should be none, with the process being completely automatic. For example, skeleton-based deformation techniques  [54–56] have, as a main problem, the bone and articulation configuration time by the user.Flexibility.The topology of the control object structure should perfectly define the foot articulation points and axes from the morphometric information of the foot. Thus this should allow the dynamic adaptation of the reference foot morphology.Adaptability. Later refinements of the model can be easily incorporated through the adequate characterisation of the control cage.An important aspect of these techniques is the decoupling of the base geometry to be deformed and the control object that manipulates it. These are geometrically different entities, but the control geometry structurally meets the intrinsic characteristics of the base object.Cage definitionThe foot deformation cage is a control mesh that fits the base object, which is wrapped around and characterised by the cage in such a way that the articulation properties of the object are established. More formally, let a cageCbe a polyhedron inddimensions that is a closed (not necessarily convex) volume with a piecewise linear boundary. In three dimensions, a cageCis a closed region of space bounded by planar faces. Constructing a function that interpolates a set of values defined at vertices of a polygonal mesh is a fundamental operation in computer graphics. Such an interpolant has many uses in applications such as advanced shading, parameterisation and deformation of objects. For closed polygons, MVCs have proven to be an excellent method for constructing such an interpolant. In this paper, we apply MVCs to closed polygonal meshes. Given such a meshP, we show that these MVCs are continuous everywhere and smooth on the interior ofP. The coordinates are linear on the triangles ofPand can reproduce linear functions on the interior ofP. Given a closed mesh, formed of triangles with vertices{p1,p2,p3}and associated intensities{f1,f2,f3}, the intensity at pointvon the interior of the triangle can be expressed in the form  [50]:(1)fˆ[v]=∑jwjfj∑jwjwherewjis the area of the triangle{v,pj−1,pj+1}. In this formula, note that each weightwjis normalised by the sum of the weights to form an associated coordinate. The interpolantfˆ[v]is then simply the sum of thefjtimes their corresponding coordinate.Mesh parameterisation methods  [57–61] and free-form deformation methods  [62–65] also make heavy use of interpolants of this type. Several papers,  [51,66–69], have focused on building interpolants for non-convex 2D polygons. In particular, Floater proposed a new type of interpolant based on the “Mean Value Theorem” that generates smooth coordinates for star-shaped polygons. Given a polygon with verticespjand associated valuesfj, Floater’s interpolant defines a set of weight functionswjof the form:(2)wj=tan[αj−12]+tan[αj2]|pj−v|whereαjis the angle formed by the vectorpj−vandpj+1−v. Normalising each weight functionwjby the sum of all weight functions yields the mean value coordinates ofvwith respect topj. In  [51] the interpolant was defined from the application of the mean value theorem,  [70] used a solution to Laplace’s equation and  [71] was based on the Green functions to obtain their interpolant. In this paper, we opted for the solution described by  [51]: Mean Value Coordinates.Obtaining the deformation cageObtaining the deformation cage is an automatic process based on purely morphological aspects of the user’s reference foot. The foot morphology based deformation should be carried out taking the foot’s morphometric information into account. It is necessary to obtain a simplified representation that has the following characteristics:•Anatomical links with the foot. The resulting cage must maintain the anatomical information necessary to carry out the articulation of the foot. This must be based on the characteristic points and curves obtained in the previous section.Simplicity. The resulting cage must be as simple as possible, minimising the number of faces as the computational cost of the deformation algorithm application is directly linked to the number of faces in the cage.Constraint. The resulting cage must enclose the whole of the reference foot to guarantee its correct articulation.Below, the process for obtaining an exoskeleton, which defines the articulation points of the foot, is described; this exoskeleton is based on the acquisition of the characteristic planes from the characteristic foot articulation curves. The creation of the deformation cage defines a valid exoskeleton for the representation of the foot in the sagittal–frontal plane. To obtain this cage, we start from the acquisition of some characteristic foot curves that determine the necessary articulation points for the deformation to take place. These curves are (see Fig. 5)FCd1(metatarsal area),FCd2(instep are),FCd3(back heel area) and yFCd4(heel tread area).As can be seen in the previous figure, the curves have direct relations to the foot articulation key areas. These curves are detected automatically through digitisation and their acquisition does not require complex calculations that increase the time needed for the process. Then we proceed with the offset of these characteristic curvesFCd1,FCd2,FCd3andFCd4, aFMOffset. For this, the following steps are followed:1.The corresponding planes are obtained which contain the curvesFCd1,FCd2,FCd3andFCd4. These arePFCd1,PFCd2,PFCd3andPFCd4.The planesPFCd1,PFCd2,PFCd3andPFCd4are intersected withFMOffset, obtaining the curvesFCdoffset1,FCdoffset2,FCdoffset3andFCdoffset4.In this way, the foot exoskeletonFDEFcagehas been obtained with articulation properties. The foot deformation consists of the rotation of the exoskeleton vertices about the foot’s anatomical rotational axes. The described method has the following advantages:1.Homeomorphism. The automatic method is able to obtain a homeomorphic cage with regard to the original geometry, the foot.Shape preservation. Dependent on the base curves.Automatic. The method is totally automatic and does not need the user interaction, except for some minor adjustment parameters. The user does not manipulate the vertices of the resulting cage at any time.Efficiency. Due to it being an automatic method the resulting cage can be obtained in seconds.Morphology. The acquisition of the cage is completed through the inclusion of parameters related to the morphology of the original object, including all information referring to the anatomy of the foot (see the section on foot points and measurements).Expandable. It can be seen that the method is expandable for the modelling and deformation of other types of base geometries, from which the anatomical information can be obtained.Generality. Obtaining the cage does not solely apply to polygonal meshes, but it can also be extrapolated to different 3D geometric entities, point clouds (with or without normal orientation), NURBS surfaces, curve groups, etc.The foot deformation is achieved through the completion of the necessary transformations to be applied to the deformation cage. For this, first the foot sole curveFCpmust be deformed, in order to minimise the error in the calculation of the distance between the last pitch curveLCqand the foot sole curveFCp(see Fig. 7).The adjustment of the variables that intervene in the foot deformation process implies the finding of three rotation values (R1,R2andR3) and a translation(T). For this, the minimisation of an objective function defined in Eqs. (3)–(5) is carried out through the conjugate gradient method  [72], which provides a valid solution in a time that can be assumed as an indispensable efficiency requirement for the process. A similar approach is completed in the work of  [73] in which the minimisation of an objective function is completed through the conjugate gradient method to obtain a better suitability of a set of points on the last surface. The objective function to be minimised is defined as(3)MinF(x)=Dist(LCq,FCp,R,T,Res)whereRis defined as the sum of the 3 following rotations:(4)R=∪(Ri),i=1,2,3considering the restriction Res as(5)Res=(HL−FL=BDL)withBDLbeing the minimum necessary distance between the furthest back points of the last and foot to allow the correct in-shoe mobility of the foot.The rotationsRiare finally applied as indicated below:•R1. Rotation of rear-metatarsal vertices. The axis defined by a metatarsophalangeal joint. The axisMetFalAxis=v→. The rotational angle of the vertices to be applied in this rotation is defined asθ1(see Figs. 8–10). The set of restrictions defined inRbioprovides the maximum angle to be assigned toθ1.R2. Rotation of heel vertices. The axis defined by the Chopart joint. The axisChopAxis=w→. The rotational angle of the vertices to be applied in this rotation is defined asθ2(see Figs. 11–13). The set of restrictions defined inRbioprovides the maximum angle to be assigned toθ2.R3. Front-metatarsal vertices rotation. Axis defined by a metatarsophalangeal joint. The axisMetFalAxis=v→. The rotational angle of the vertices to be applied in this rotation is defined asθ3(see Figs. 14–16). The set of restrictions defined inRbioprovides the maximum angle to be assigned toθ3.For each of the axes:•AxisMetFalAxis(v→): Defined by theB1FandB2Fpoints.AxisChopAxis(w→): Defined by theNFpoint. Vector perpendicular to theXZplane (see Fig. 17).Finally, the translationTis defined as the translation of the deformed curveFCpin theXZplane, through thet→vector (see Fig. 18).Once the variables of the problem, the rotation angles (θ1,θ2,θ3) and the translation vector(t→)that minimise the distance between the curves have been obtained, these transformations are applied to the foot meshFM. Once the transformations have been applied, the foot is deformed, represented by the polygonal meshFMDef.Foot measurements and deformation errorTable 2shows the deviation incurred in the values obtained after the deformation of the foot. These measurements are compared to measurements taken from the scans of the four foot geometry which has been digitised with different heights, using a support element in the heel area in order to obtain 40, 60 and 80 mm in height. Deformed foot measures are presented with nomenclature FootX(D)−XXmm.Once the bio-deformable foot model has been defined, a deformable last model is defined taking into account the set of restrictions that must be met during the deformation (modification) process of the last, restrictions that are defined by the previously deformed reference foot. The interconnection between both models allows an effective comparison between different entities, foot and last, in order to carry out the ideal modifications on the last based on the structure and morphology of the reference foot. The parameterisation of the last, defined inEbase(see Fig. 19), provides the necessary information (measurements) to begin the comparison with the reference foot and the application of the suitable modifications.There are many studies based on sketching techniques for the completion of volumetric deformation of three-dimensional objects. The objects are mainly characterised by the modification of a three-dimensional object through a specific interface to obtain a specific result. The works based on these techniques allow these surfaces to be doubled  [74–78], and twisted  [79], silhouettes to be modified  [80,81], segmentation  [76,82], free deformation  [83] and finally have the affine transformations applied  [84]. There are also works in which character animation is carried out by this type of technique  [75]. In the case of  [83] articulation points are extracted through image processing techniques such as erosion, applying physical and geometric constraints to avoid invalid poses. In the work by  [84] the deformation is applied through curves defined in orthogonal planes that are modified manually to apply the appropriate deformation. The initial curves are also defined manually before making deformations. In this paper, techniques are used that are inspired by those described by  [85] modifying certain aspects to make them more suited to the modifications to be made to the last. The main contribution comes from the method used to relate deformation curves and the interpolation function used to define the field of action. The parametric curves that characterise the area of the last to be deformed are previously defined through the acquisition of characteristic curves that parametrically define the base last. These areas are those that should be locally modified using control curves. This work introduces the concept of a network of deformation curves, as determined deformations should be made using a set of control curves or, as they are called in this paper, a Network of Deformation Control Curves(NdC2).Network of deformation control curves(NdC2)Each of the curves belonging to theNdC2deforms an area of the surface. We define theNdC2system={Dc,Rc,s,r,f,CM}, whereNis the total number of deformation curves in theNdC2;DciandRciare free-form parametric curves,siis a scalar that controls radial scaling around the curve,riis a scalar value defining a radius of influence around the reference curve andCMis the method of correspondence between any point defined inRciandDci; and the scalar functionf:ℜ+→[0,1]is to preserve the continuity in the deformation according to the radius of influenceri. The functionfshows continuityC1and is monotonically-decreasing withf(0)=1,f(x)=0forx≥1andf′(0)=0,f′(1)=0. In this paper, unlike  [86],fis the Gaussian function represented as(6)f(x)=12πσe−(μ−x)22σ2whereμandσare real positive constants, which control the origin point and the width of the bell respectively.The parameterridefines, for thei–nth control curve, the reach of the deformation on the original object, controlling and guaranteeing the continuity of the deformation through thefparameter. Together with the scaling parametersi, and givenriandf, a control curve is defined by means of the specification of the original curveRciand the copy of the curveDci, in which the shape will be altered to carry out the controlled deformation of the geometry. Each control curve,Rci, specifies a tube-shaped surface around the curve ofri, radius, the deformation influence for points of the object within this surface that is controlled by the density functionf. The deformation at a pointPis related to the deviation of the closest point on the reference curveRci(pR)from a corresponding point on the deformation curveDci. We use a direct correspondence between curvesRciandDcibased on the parameter value (parametric deformation). The correspondence used can be directly varied as a method parameter, defining the three possibilities shown in Figs. 20–22:•Closest. LetC1(u1)∈RcandC2(u2)∈Dcbe the curves defined in the same domain byu1,2∈[0,1]. For any pointP∈ℜ3onC1, letpc2∈[0,1]be the parameter value that minimises the Euclidean distance between pointPand curveC2(u). If there is more than one minimum, we definepc2to be the parameter with the smallest value:(7)pc2∈[0,1]/∀u2∈[0,1];|C2(pc2)−P|≤|C2(u2)−P|.Parametric. LetC1(u1)∈RcandC2(u2)∈Dcbe the curves defined in the same domain byu1,2∈[0,1]. For any pointP∈ℜ3onC1, letpc2∈[0,1]be the parameter value that equals the parameter value of pointPonC1and curveC2(u):(8)pc2=u2/C2(u2)=P;P=C1(u1);u1,u2∈[0,1]Tangent distance. LetC1(u1)∈RcandC2(u2)∈Dcbe the curves defined in the same domain byu1,2∈[0,1]and let the vectorn→be the normal at pointP∈ℜ3onC1, we definepc2∈[0,1]to be the parameter resulting from the intersection of the line generated with vectorn→and curveC2(u). If there is more than one intersection, we definepc2to be the parameter at the closest distance from curveC1:(9)pc2=Intersection(C2(u2)),Straightline(Normal(C1(u1)),P);P′=C2(pc2),P=C1(u1);u1,u2∈[0,1].For any pointPand curveRci, we define the functionF(P,Rci)as(10)F(P,Rci)=f(‖P−Rci(pC)‖ri).From the properties offit is clear thatF(P,Rci)varies from zero for‖P−Rci(pC)‖≥ri(points outside the offset volume defined byRciandri), toF(P,Rci)=1when‖P−Rci(pC)‖=0(Plies onC).F(P,Rci)defines the influence that a curveRcihas on a pointP.As with any deformation, this kind of deformation is a point-wise function mappingℜ3ontoℜ3. For each objectO, letPObe the point-based representation to which the deformation will be applied.POcontains all points necessary to construct or approximate an object’s surface. This method allows the application to any type of geometric entity, such as, NURBS surfaces and curves, polygonal meshes or point clouds. When an objectOis bound to anNdC2, the parameterspRiandF(P,Rci)are computed for every pointP∈PO. Only points on the object within the offset volume of radiusrifrom the curveRciwill be deformed. WhenDciis manipulated and its geometry is altered, the object is deformed for every pointPfor whichF(P,Rci)>0:1.Uniformly scalePabout pointRci(pR)resulting in pointPs. Specifically,Ps=P+(P−Rci(pR))⋅(1+(si−1)⋅F(P,Rci)).LetC′(u)be the tangent vector to curveCatu, and letθibe the angle betweenDci′(pR)andRci′(pR). RotatePsby the angleθi⋅F(P,Rci), around the axisDci′(pR)⋅Rci′(pR), about pointRci(pR). This results in pointPr.Finally add the translation(Dci(pR)−Rci(pR))⋅F(P,Rci). The resulting deformed point,Pdef, is thusPdef=Pr+(Dci(pR)−Rci(pR))⋅F(P,Rci).Objects are not deformed initially, after the creation of the copies of the deformation curves, bothRciandDcicoincide with each other.Points on the object outside the offset volume of radiusrifrom the reference curve (pointsPwithF(P,Rci)=0) are not deformed regardless of the value ofsi.Points on the object that are on the reference curve, when the object is bound to the network of curves, track the deformation precisely as they are directly affected by the reference curve and the implied deformation.The deformation of points on the object between those on the reference curve and those outside its realm of influence is smooth and intuitive. The factorF(P,Rci)controls the attenuation of the deformation, varying from precise tracking for points on the reference curve to no deformation at or beyond the offset volume boundary.Deformation curvesWe use several deformation curves to modify the last. This kind of final deformation is carried out by blending each of the deformations applied by each of the deformation curves from the network. Let a network of deformation curves be defined asNdC2and letPbe a point on the object to be deformed, we definePdef−ias the point resulting from the deformation applied by curveDci. LetΔPi=Pdef−i−P. The deformed pointPdefresulting from the blend of all deformation curves is defined as follows:(11)Pdef=P+∑i=1nΔPi⋅‖ΔPi‖m∑i=1n‖ΔPi‖m.The resulting behaviour varies withm, from a single average of theΔPiwhenm=0, converging to max{ΔPi}for largem. For better control over the network of deformation curves, each curve should have its own exponentmi, giving finer control over its contribution to the final deformation result:(12)Pdef=P+∑i=1nΔPi⋅‖ΔPi‖mi∑i=1n‖ΔPi‖mi.Also, a parameter similar tomis introduced in the above formula which is based on the distance from the deformation curve with regard to the point to be deformed. Depending on the proximity of the point to the deformation curve, its behaviour is modelled throughF(P,Rci)controlling its proximity. The formula used is as follows:(13)Pdef=P+∑i=1nΔPi⋅F(P,Rci)k∑i=1nF(P,Rci)k.The factorkhas a similar effect tomand can be combined with all those parameters defined earlier.Basic last modificationsThese basic modifications are carried out for the particular treatment of the critical areas on the last in order to guarantee the fit with regard to the original foot. These basic modifications do not completely resolve severe problems for feet with marked deformities. The deformation technique used is based on the method described in the previous section,NdC2, with the number of control curves used in Dc and Rc depending on the type of modification to be made. The modified last is calledLSDef. Some of the most commonly used techniques for last modification are shown in Fig. 23.A practical case is presented in which the customisation of the last is carried out for a reference foot with a severe metatarsalgia. The user has a very notable pathology (metatarsalgia, hallux-valgus) in both feet, which causes severe discomfort when using a standard pair of shoes. The patient is an adult female aged 55.Step 1. Selecting the footwear style.As a first step in this practical case of customisation, the base footwear style is selected, which provides the base last on which the ideal modifications are to be made (see Fig. 24). In this case, the model has a low heel height.Step 2. Digitising the user’s feet.Then the reference (right) foot is digitised, which will be compared to the original last which corresponds to the chosen style (see Fig. 24).Step 3. Obtaining the original last and initial foot–last positioning.The original last is obtained from the chosen footwear style. This last has been adequately graded to ensure that its effective length corresponds to the length of the reference foot. This last will be modified considering the measurements obtained from the reference foot (see Fig. 25).The original last and the reference foot are positioned adequately as a prior step to the measuring process. This positioning directly influences the customisation quality (see Fig. 26). In our case, due to the pronounced last pitch, the two geometries are positioned in such a way that the foot metatarsals are aligned with the last’s most prominent points.Step 4. Deforming the foot.The foot deformation process is then started, obtaining the corresponding deformation cage (see Fig. 27).The parameters, corresponding to the deformation that defines the best possible fit with regard to the last pitch curve, are calculated. These have the following values:1.Rot 1: Metatarsophalangeal joint axis→toe area=3°rotationRot 2: Metatarsophalangeal joint axis→instep area=15°rotationRot 3: Chopart joint axis→Heel area=5°rotationThe measurement and comparison of measurements between the deformed foot and the original last are completed in this step, as a base for the decisions to be made for the modification of the last (see Fig. 28).Step 6. Modifying the last.After the analysis of the measurements obtained for the deformed foot and the original last, the ideal modifications are then made on the last. This is carried out in the following manner through theNdC2method:1.Last pitch modification. It is essential that last is supported on theSPLpoint (see Fig. 19), situated at 69% of the last effective length. The original last was not correctly supported on this point due to an alteration of the metatarsal position and an incorrect definition of this position.Metatarsal area modification. The ball girth is increased by 13 mm to provide space for the 5th metatarsal, which is very prominent due to a metatarsalgia (hallux-valgus). The increase requires that the width of the ball curve is increased more for the medial side than the lateral side, as the deformation of the foot is more marked on this side than the other.Heel area modification. It is increased by 3 mm on both sides from the most prominent points of the heel curve. The upper part of the heel curve is left unaltered, as this should conveniently hold the foot tightly at this height, and the selected footwear style is a court shoe, which has a low profile in this area.Modification of the medium instep area. The medial side is reduced to be a bit tighter; the width is increased by 12 mm on both sides, with higher intensity in the medial side than the lateral side.First toe area modification. The first toe height is increased by 10 mm, as this toe needs more height on average than the others. This deformation implies an aesthetic modification of the last.Aesthetic toe modification (I). An enlargement of the toe and an aesthetic re-design are carried out to compensate for the modification made to the metatarsals.Aesthetic toe modification (II). The toe slope is modified to give it a better appearance. Having enlarged the toe, it is possible to reduce the gradient of the last slope and thus improve the general appearance of the last.Ball curve adjustment. A curve girth of 240 mm is to be achieved.The network of deformation curves used to carry out these modifications is shown in Figs. 29–30. In blue, the origin base curves can be seen and the end curves resulting from the deformation can be seen in red.Step 7. Measuring and comparing the modified last.In Table 3, the measurements obtained for the reference foot, the original last and the modified last can be seen. The variation percentage of the lasts is analysed with regard to the foot along with any critical measurements that directly affect the fit.In the Modification column, the modifications made to certain key measurements can be seen, which serve as a guide to guarantee the correct fit. In the column Gap, the difference between the desired measurement and the final measurement in a certain area can be seen. These differences are evaluated by the expert user that must validate the results using his/her experience and then determine whether the modified last will be suitable for the reference foot.Step 8. Fitting test.After the manufacture of the new footwear style with the modified last, a test in which the user evaluates the comfort of the shoe, with regard to the previous (initial) one, is carried out subjectively. The result of this test can be seen in Table 4where the key areas are analysed, these areas being essential for the evaluation of the fit of a last. The modifications made to the last imply a number of dimensional changes on the original last due to the pathology presented by the patient. The considerations of footwear type, the material to be used and the sole for use have been taken into account when making the modifications. All of these considerations have decisive effects on the feeling of comfort experienced by the patient, directly affecting possible subsequent modifications that will need to be made as a consequence.Fig. 31shows the physical modified last and the footwear style made with said last, with which the fitting test was carried out.In Figs. 32 and 33two additional practical cases of the shoe model application are shown. In the first one, for a men shoe, a number of corrections have been made on the original last consisting of a heel-width reduction, medium-instep adaptation and extension of the fingers area to allow better fingers movement on the shoe toe zone. Comfort evaluation of this model is presented in Table 4 (shoe model 2).In the next one, a women model with 75 mm heel height, there have been made a number of adjustments in order to fit the heel area and give a greater amplitude, expand the middle-area of the last, modify medium-instep giving greater scope, increment the area of standard ball and, finally, for aesthetic considerations has been rectified the last tip for a better design of the final customised shoe. Comfort evaluation of this model is presented in Table 4 (shoe model 3).

@&#CONCLUSIONS@&#
The impossibility of implementing different musculoskeletal models in the industrial field of a manufacturing sector, such as footwear, due to the complexity of real time simulation in non controlled environments, such as footwear customisation, was the starting point for this research work.The model presented in this document interrelates two geometric models, the first allowing surface deformations to be made on a digitised foot in order to make it suitable for a last height (height derived from the heel to be incorporated into a future shoe). Foot–last adaptation is achieved through cage-based deformation techniques, using a control structure obtained through the automatic extraction of an exoskeleton from the morphometric information of the foot, which makes it possible to articulate it efficiently.Furthermore, a last modification model has been developed that allows the adaptation of the last geometry to that of the reference foot based on quality and comfort criteria. The modification of the last was carried out through the application of a deformation technique developed in this research work and called “Network of Deformation Control Curves”(NdC2)which allows the precise and controlled modification of the geometry taking the quality constraints inherent to the design of this industrial element into account.Both models have successfully been put in practice, carrying out different adaptations between the foot and last using current footwear design and manufacturing systems. In this work, a real case of footwear customisation is used to describe the adaptation of a standard last to a reference foot which presents certain conditions inherent to the user’s age.In the current system, the last modification is carried out by an expert user, with this person being the decision maker for ideal last modifications. Future works that have been proposed in this investigation will be aimed to complete the automation of the model, providing the model with an expert system which allows the adaptation of the last to the reference foot automatically and without user intervention, basing this on a series of optimisation criteria.