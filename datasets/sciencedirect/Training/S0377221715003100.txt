@&#MAIN-TITLE@&#
Exact and heuristic algorithms for the design of hub networks with multiple lines

@&#HIGHLIGHTS@&#
We study the design of hub networks with multiple lines.We minimize the total travel time while considering a budget design constraint.A Benders-branch-and-cut algorithm and several heuristic algorithms are presented.

@&#KEYPHRASES@&#
Hub location,Hub-and-spoke networks,Lines,Network design,

@&#ABSTRACT@&#
In this paper we study a hub location problem in which the hubs to be located must form a set of interconnecting lines. The objective is to minimize the total weighted travel time between all pairs of nodes while taking into account a budget constraint on the total set-up cost of the hub network. A mathematical programming formulation, a Benders-branch-and-cut algorithm and several heuristic algorithms, based on variable neighborhood descent, greedy randomized adaptive search, and adaptive large neighborhood search, are presented and compared to solve the problem. Numerical results on two sets of benchmark instances with up to 70 nodes and three lines confirm the efficiency of the proposed solution algorithms.

@&#INTRODUCTION@&#
Hub-and-spoke architectures are often used in the design of large-scale networks such as those found in passenger and freight transportation, postal services, telecommunications, and rapid transit systems. In these networks, commodities from different origins are sent to intermediate facilities, known as hubs, which are responsible for the aggregation and distribution of the flows to multiple destinations. This allows the connection of a large number of origin/destination (O/D) nodes with a small number of arcs, reducing the infrastructure and operational cost (O’Kelly & Miller, 1994). Another important advantage of hub-and-spoke networks is that hub facilities can be connected with highly efficient pathways, enabling economies of scale to be achieved on the transportation cost (or travel time) between hubs. Hub location problems (HLPs) consider the design of hub networks by selecting a set of nodes to locate hubs, activating a set of links, and routing commodities through the network while optimizing a cost-based (or service-based) objective function. We refer the reader to Alumur and Kara (2008), Campbell and O’Kelly (2012), Farahani, Hekmatfar, Arabani, and Nikbakhsh (2013), and Contreras, Laporte, Saldanha da Gama, and Nickel (2015) for recent surveys on hub location.Given the inherent difficulty of HLPs, most of the fundamental HLPs consider a fully interconnected hub-level network to simplify the network design decisions. However, it is known that this can be an oversimplification in applications where there is a considerable set-up cost associated with the inter-hub links (see O’Kelly & Miller, 1994). Several HLPs considering incomplete hub-level networks have thus been studied. These problems can be seen from a hub arc location perspective (see Campbell, Ernst, & Krishnamoorthy, 2005a; 2005b; Contreras & Fernández, 2014), in which the location of a set of hub arcs and their associated hub nodes is considered. Motivated by specific applications, some of these models require the hub-level network to have a particular topological structure, such as cycles (Contreras, Tanash, & Vidyarthi, submitted for publication; Lee, Ro, & Tcha, 1993), stars (Labbé & Yaman, 2008), trees (Contreras, Fernández, & Marín, 2009; Contreras, Fernández, & Marín, 2010; Martins de Sá, de Camargo, & de Miranda, 2013), or lines (Martins de Sá, Contreras, Cordeau, de Camargo, & de Miranda, in press). Some other models do not even require the hub arcs to define a single connected component (Campbell et al., 2005a; Contreras & Fernández, 2014).The hub line location problem (HLLP), introduced in Martins de Sá et al. (in press), consists of designing a hub network in which p hubs are located and connected by means of a single line. Contrary to most p-hub median models considering a cost-based objective, the HLLP uses a service-based objective that aims at minimizing the total weighted travel time between O/D pairs. It considers that a high-speed mode of transportation is available on the hub arcs and thus, their travel speed is faster than on the other links of the network. The total travel time when using the hub line takes into account the access and exit times that may exist when using the hub line due to a change in mode of transportation or to waiting because of frequency or congestion related issues. The trade-off between the benefit of using a high-speed mode of transportation to efficiently travel and the added time for interacting with the hub line make the routing decisions more involved. Demand flow must be routed via either a path using a segment of the hub line or with a direct connection between origin and destination, depending on whichever route provides the smallest travel time. Potential applications of hub line networks arise in the location of extensive facilities and in public transportation planning, in particular in the design of rapid transit systems such as a subway, tram or light rail lines. Hub facilities then correspond to stations where a change of mode of transportation is possible. Non-hub nodes may represent districts, bus stops or taxi stations. Users will employ the hub line if there is a reduction in their travel time or they will keep using the shortest route on the existing network. For additional details on the HLLP the reader is referred to Martins de Sá et al. (in press).One of the limiting aspects of the HLLP is that it is only applicable to situations where the hub network will have exactly one line with a predetermined number of hubs. In this paper we generalize the HLLP to the case in which the hub network is composed by more than one line. In particular, we introduce the q-line hub location problem (q-HLLP) which consists of locating a set of q lines that minimize the total travel time between O/D pairs, while satisfying a budget constraint on the total setup cost of the network associated with the location of hub nodes and hub arcs. As in the HLLP, we assume that O/D nodes can be assigned to more than one hub node, i.e. a multiple allocation pattern. However, instead of considering a predetermined number of hub nodes in a line, the q-HLLP considers as part of the decision process the determination of the number of hubs contained in each line, while respecting lower and upper limits on this number and the budget constraint for the total setup cost. In order to properly model the total travel time when using more than one hub line, a waiting time to transfer between lines needs to be taken into account. For instance, when transferring lines at a subway station, the average time spent walking between gates and waiting for the next subway train to pass, which depend on the size of the station and train frequency, could be significant. These transfer times might not compensate the reduction of travel time from using the subway, especially if transferring more than once, and thus users may continue traveling as before. These times make the q-HLLP more general and thus, more challenging to formulate and solve.In the standard version of the q-HLLP, the hub-level network is not required to define a single connected component. An example of a potential application in which this is not a requirement arises in bus transit systems, where sets of express bus lines may be disconnected if they run in very different areas within a metropolitan area. However, in other applications such as in subway systems, the metro lines are always connected. Therefore, we also consider a variant of the q-HLLP in which it is assumed that the hub-level network must be connected.Fig. 1illustrates two different 2-line hub networks that have the same topological structure, but actually represent different systems when transfer times are taken into account. For example, if transfer times are strictly positive, the travel time from hub node 1 to hub node 3 in hub network 1 is smaller than in hub network 2, since the latter implies a transfer from line 2 to line 1 at hub node 2.To the best of our knowledge, the design of transportation networks considering multiple lines has not been previously addressed from a hub location perspective. However, it has been considered in the context of extensive facility location and rapid transit systems design. An extensive facility is a facility considered to be too large for being represented as a single point when comparing its scale with its interaction environment (Mesa & Boffey, 1996). A review of extensive facility location problems can be found in Mesa and Boffey (1996), who also cover multiple path location problems.In the context of the design of rapid transit systems, Bruno, Ghiani, and Improta (1998) address the design of a multi-modal rapid transit line. The problem consists of designing a bi-modal pedestrian–public network and considers a bi-objective function composed of the minimization of the construction costs and the minimization of the total weighted travel cost. It is assumed that the total travel cost associated with each O/D pair is equal to the minimum between the shortest path covered by means of the private system and the shortest path in the pedestrian–public network, which account for the total travel cost to transit between two nodes of the network and the costs associated to the waiting times to boarding and alighting in a station of the rapid transit line. García et al. (2006) address the design of a rapid transit system composed of multiple lines that maximizes the total weighted trip coverage by the system, where the extremities of each line are given. It is assumed that the total cost to satisfy the demand of each O/D pair by the system is equal to the sum of the total travel cost to move in the transit vehicle and the costs associated with transferring from one line to another. In this case, a demand is covered by the system if the total travel cost is lower than the travel cost associated to a competing private system.Another line of research in rapid transit system design focuses on maximizing the population coverage provided by the network, an objective that differs from the one considered in the q-HLLP. For example, Laporte, Marín, Mesa, and Ortega (2007) present a mathematical formulation for the problem of designing a multiple-line network that maximizes the trip coverage in competition with a private mode taking into account a budget constraint. Marín (2007) presents an extension to the problem proposed by Laporte et al. (2007), where stations are not determined a priori and the number of lines is free but has an upper bound. The problem aims to maximize the public coverage (the main objective) and to minimize the routing cost. Marín and Jaramillo (2008) propose a long term planning model that aims to determine a network capacity expansion plan, i.e., to install additional lines or stations. Marín and Jaramillo (2009) present a Benders decomposition algorithm to solve the urban rapid transit design proposed by Marín (2007).As noted by Martins de Sá et al. (in press), the design of hub line networks is a very challenging optimization problem, even for the case of a single line. The best Benders decomposition variant presented by the authors for the HLLP can consistently solve to optimality instances with up to 50 nodes and for some particular configurations of the parameters of the HLLP, it can solve instances with up to 100 nodes in one day of CPU time. In this paper, we present exact and heuristic algorithms for designing hub line networks with multiple lines. In particular, we present a mixed-integer programming (MIP) formulation for the q-HLLP which is used in a Benders decomposition algorithm to obtain optimal solutions for small instances and to provide bounds for larger instances. We also develop three different metaheuristics to provide feasible solutions to large instances: (i) a variable neighborhood descent (VND), (ii) a greedy randomized adaptive search procedure (GRASP) and, (iii) an adaptive large neighborhood search (ALNS). In order to evaluate the efficiency and limitations of our algorithms, extensive computational experiments are performed on instances with up to 70 nodes and three lines.Our intent is to address the general q-HLLP by focusing on its core structure. Hence, although we use several notions related to transit networks to help explain our approach, we have chosen not to consider some of the features that are sometimes found in more specialized rapid transit network design models. For example, the choice of itinerary made by the users of a transportation system is usually probabilistic and is often modeled with a logit function (see, e.g., Canca, De-Los-Santos, Laporte, & Mesa, 2014; Perea, Mesa, & Laporte, 2014). We consider a simpler setting where, for each origin-destination node pair, all demand will follow the shortest path in the network. We also ignore decisions related to the capacity and frequency of each line. Although these aspects are obviously related to network design, we assume here that the decisions will be made in a following step. Finally, to simplify the writing of the model we do not consider the possibility of having circular lines, which are sometimes found in practice (see, for instance Contreras et al., submitted for publication). For more details about the planning of rapid transit networks, we refer to the review paper of Laporte, Mesa, Ortega, and Perea (2011).The remainder of the paper is organized as follows. Section 2 provides a formal definition of the problem and introduces the MIP formulation. The Benders decomposition algorithm and the metaheuristics are presented in Sections 3 and 4, respectively. The results of the computational experiments are reported in Section 5. Conclusions follow in Section 6.Let G = (N, A) be a complete digraph, where N is the set of nodes and A is the set of arcs. We define the subset Q⊆A of candidate hub arcs whose length lies between the minimum and maximum allowed distances between hub nodes. For each pair of nodes i, j ∈ N, we define wijas the amount of flow to be routed from the origin i ∈ N to the destination j ∈ N. Let tij≥ 0 be the travel time defined as the shortest time required to travel from node i to j using one or more modes of transportation, other than the one associated with the hub lines, on the original network. Without loss of generality, tijalso incorporates any average transfer time required when changing modes of transportation from i to j. Note that this definition of travel times ensures the tijvalues will satisfy the triangle inequality property. When a hub arc is used to connect hub nodes i, j ∈ N, the travel time is computed as αijtij, where αijis a reduction factor that models the use of a faster transport technology to connect i and j. Let alsot˜ka≥0andt˜me≥0denote the access and exit times to enter a hub line at node k and leave a hub line at node m, respectively. The access timet˜karepresents both the time required to change the mode of transportation between an access and a hub arc and the average waiting time to access the first hub line on the O/D path at hub k. The exit timet˜meonly represents the time needed to change the mode of transportation at the last hub node m on the last hub line used on the O/D path. Note that in this case, the waiting time associated with the access arc (if any) is already considered in tmj. Lett˜ks≥0denote the transfer time at hub node k, which represents the average time to change from one line to another at hub node k. Furthermore, for k, m ∈ N, let fkand ckmdenote the fixed setup cost to locate a hub node and a hub arc, respectively. Letpandp¯be the bounds on the minimum and maximum number of hub nodes on each line, respectively, and let B denote the available budget to design the hub network.The q-HLLP consists of locating q hub lines, each of them containing betweenpandp¯hub nodes, while allocating every non-hub node to at least one hub in such a way that the weighted sum of the total travel time is minimized and the budget constraint on the total network design cost is satisfied. It is assumed that the demand (i.e. passengers) from origin i ∈ N to destination j ∈ N will use the fastest possible route on the solution network. That is, wijwill travel either directly from i to j using a shortest path on the original network resulting in a travel time of tij, or it will use a combination of access arcs and hub arcs associated with one or more hub nodes, in which case the total travel time is equal to the sum of: (i) the travel time from origin i to the first visited hub k, (ii) the time to access a hub line at hub k, (iii) the travel time between the first hub k and the last hub m connected through a set of hub arcs associated with one or more hub lines, (iv) the transfer time for changing lines at one or more hub nodes, (v) the exit time to leave the hub line at the last visited hub m, and (vi) the travel time from hub m to destination j. Because of the triangle inequality property of tij, a solution network of the q-HLLP will route wijeither with a direct connection between i and j or with a path containing at most two access arcs and at least one hub arc and one hub line. That is, travel times associated with direct connections will always be smaller than or equal to any O/D path containing one hub node and no hub arcs.We next introduce a MIP formulation for the q-HLLP based on the formulation proposed by Martins de Sá et al. (in press) for the single line case. However, the characterization of O/D paths becomes more involved given that we now have to consider the possibility of transfers between two lines at the hub nodes. We define binary location variableszkl,k ∈ N, equal to 1 if and only if a hub is located at node k and is part of line l. We introduce binary hub arc variablesykml,l = 1, …, q and (k, m) ∈ Q, k < m, equal to 1 if and only if a hub arc is located between hubs k and m and is part of line l, enabling flows to be routed in both directions. We also define five sets of continuous routing variables to model various structures of O/D paths arising in the q-HLLP. In particular, we introduce variables aijk≥ 0 and bijm≥ 0 equal to the fraction of the demand wijthat enters and exits the q-line hub network through hubs k ∈ N and m ∈ N, respectively, while variablesxijkml≥0denote the percentage of the demand wijrouted on hub arc (k, m) ∈ Q of line l. We define variables τijkequal to the fraction of demand wijchanging hub lines at hub k, while variables eij, i, j ∈ N are equal to the fraction of flow wijsent directly from i to j. To simplify the presentation, we assume i, j, k, m ∈ N, i ≠ j, (k, m) ∈ Q, and l = 1, …, q henceforth. The q-HLLP can then be formulated as:(1)minimize∑i∑jwij[∑k(tik+t˜ka)aijk+∑l∑k∑m:m≠kαkmtkmxijkml+∑kt˜ksτijk+∑m(tmj+t˜me)bijm+tijeij](2)subjecttop̲≤∑kzkl≤p¯∀l(3)∑k∑m:m>kykml=∑kzkl−1∀l(4)∑k∑m:m>kykml+∑m:m<kymkl≤2zkl∀k,l(5)∑k∈S∑m∈S:m>kykml≤∑k∈S∖{s}zkl∀l,∀S⊆N,s∈S(6)∑l∑m:m>kckmlykml+∑l∑kfklzkl≤B(7)∑kaijk+eij=1∀i,j(8)∑mbijm+eij=1∀i,j(9)aijk+∑l∑mm≠kxijmkl=bijk+∑l∑mm≠kxijkml∀i,j,k(10)aijk≤∑lzkl∀i,j,k(11)bijm≤∑lzml∀i,j,m(12)xijkml+xijmkl≤ykml∀l,i,j,k<m(13)∑mxijkml−∑mxijmkl≤τijk+aijk∀l,i,j,k(14)xijkml,eij,aijk,bijm,τijk≥0∀i,j,k,m(15)ykml,zkl∈{0,1}∀k,m,l:k<m.The objective function (1) minimizes the total weighted travel time. Constraints (2) guarantee that at leastpand at mostp¯hubs are located on each line l. Constraints (3) guarantee that the number of hub arcs on each line is equal to the number of hubs minus one. Constraints (4) enforce a line topology for every l by allowing each hub to be connected to at most two others hubs. Constraints (5) are subtour elimination constraints which guarantee that each hub line does not contain cycles. The budget constraint (6) limits the total network construction cost. Constraints (7)–(9) are flow conservation constraints which ensure that all flow from i to j leaves node i, arrives at node j, and is properly accounted for whenever a hub k is used. Constraints (10) and (11) guarantee that the demand from i to j can only access or leave the hub lines through installed hubs. Constraints (12) ensure that only installed hub arcs can be used. Constraints (13) force the variables τijkto take value 1 if the flow from i to j changes lines at node k. Finally, constraints (14)–(15) are the standard non-negativity and integrality constraints.In some applications, the hub network may be required to define a single connected component. That is, in each line there must be at least one hub terminal acting as a transfer hub between two lines and there should be a path between any pair of hubs in the hub-level network. We can extend our MIP formulation to consider this situation by defining an additional set of decision variables. In particular, we define binary variables hk, k ∈ N, equal to 1 if and only if a hub is located at node k in any line. Then, the following constraints ensure that the hub-level network is connected:(16)zkl≤hk∀k,l(17)hk≤∑lzkl∀k(18)∑k∈S∑m∈N∖S∑l∈Lykml≥hs+hr−1∀S⊆N,s∈S,r∈N∖S(19)hk∈{0,1}∀k.Constraints (16) ensure that hub k is selected if the hub is located on at least one of the lines, while constraints (17) guarantee that hub k is part of at least one line if it is selected. Finally, constraints (18) are cutset inequalities which ensure that, for any partition of the set of nodes into two subsets S and S∖N, at least one hub arc connects these subsets if both subsets have at least one hub.Benders decomposition is a partitioning procedure for solving mixed-integer linear and non-linear programs (Benders, 1962). The main idea is to decompose the original problem into two simpler problems: an integer master problem (MP) and a linear subproblem (SP). In this section, we introduce a Benders reformulation of the q-HLLP, based on the formulation (1)–(19). We then describe a Benders decomposition algorithm to solve the reformulation. Martins de Sá et al. (in press) present a comparison of several Benders decomposition variants for the single line problem based on a similar path-based MIP formulation. In particular, a multiple-cut strategy that adds a cut for each O/D pair showed better performance as compared to the single-cut variant in which only one cut is added per iteration. This version was embedded in a Benders-branch-and-cut scheme (BBC) in which Benders cuts are added within the branch-and-cut tree for every potential incumbent solution as well as at the root node, resulting in a single Benders iteration. Given that this BBC strategy provided the best results, we also adopt it for the q-HLLP.By fixing the variables z = zhand y = yh, we have the following primal linear SPs, one for each pair i, j:(20)minimizewij[∑k(tik+t˜ka)aijk+∑l∑k∑m:m≠kαkmtkmxijkml+∑kt˜ksτijk+∑m(tmj+t˜me)bijm+tijeij](21)subjectto∑kaijk+eij=1(22)∑mbijm+eij=1(23)aijk+∑l∑mm≠kxijmkl−bijk−∑l∑mm≠kxijkml=0∀k(24)−aijk≥−∑lzklh∀k(25)−bijm≥−∑lzmlh∀m(26)−xijkml−xijmkl≥−ykmlh∀l,k<m(27)aijk+∑mxijmkl−∑mxijkml+τijk≥0∀l,k(28)xijkml,eij,aijk,bijm,τijk≥0∀k,m.After associating dual variablesθij∈R,Γij∈R,βijk∈R,uijk≥ 0, vijk≥ 0,δijkml≥0andπijkl≥0to constraints (21)–(27), respectively, the dual linear Benders SP for each i, j can be written as:(29)maximizeΓij+θij−∑k∑lzklhuijk−∑m∑lzmlhvijm−∑l∑k∑m:m>kykmlhδijkml(30)s.t.Γij+θij≤wijtij(31)−βijk+βijm−πijkl+πijml−δijkml≤αkmwijtkm∀l,k,m:k<m(32)−βijk+βijm−πijkl+πijml−δijmkl≤αkmwijtkm∀l,k,m:k>m(33)θij+βijk−uijk+∑lπijkl≤wij(tik+t˜ka)∀k(34)Γij−βijm−vijm≤wij(tmj+t˜ke)∀m(35)∑lπijkl≤wijt˜ks∀k(36)uijk,vijk≥0∀k(37)δijkml≥0∀k,m.It is worth noting that the primal SP is always feasible, since the direct connection between every pair i, j is a feasible solution. Therefore, the dual SP (29)–(37) is always feasible and bounded. Hence, an optimal solution can always be found at an extreme point of the polyhedron (30)–(37). As there are a finite number of such extreme points, it is possible to write the BC to be added to the MP, for each pair i, j, as:(38)ηij≥Γijg+θijg−∑k∑l(uijkg+vijkg)zkl−∑k∑mk<m∑lδijkmlgykml∀g∈Gij,where ηijis an under-estimator variable for the weighted travel time from origin i to destination j andGijis the set of extreme points of polyhedron (30)–(37) associated with the pair i, j.The binary variables and their respective constraints, the ηijvariables, and the BC compose the Benders MP, which can be written as:(39)maximize∑i∑jηijsubjectto(2)--(6),(16)--(18)ηij≥Γijg+θijg−∑k∑l(uijkg+vijkg)zkl−∑k∑mk<m∑lδijkmlgykml∀g∈Gij(40)ηij≥0∀i,j(41)ykm,zkl,hk∈{0,1}∀k,m,l:k<m.The MP is solved by means of a BBC framework in which SECs (5) and cutset inequalities (18) are separated for every potential incumbent solution. Subtours are identified by detecting the connected components of the current line, and violated SECs are then added by considering all nodes of each connected component. Cutset inequalities are identified by detecting disconnected components at the hub-level network. The Concorde callable library by Applegate, Bixby, Chvátal, and Cook (2012) is used to identify these connected components. Furthermore, the Benders cuts (39) are separated for every potential incumbent solution and for every fractional solution at the root node.We next present three different metaheuristic algorithms to obtain feasible solutions for the q-HLLP, especially for large-size instances: (i) a variable neighborhood descent (VND), (ii) a greedy randomized adaptive search procedure (GRASP), and (iii) an adaptive large neighborhood search (ALNS). Before describing these algorithms, we introduce a deterministic constructive heuristic to design an initial q-line hub network that satisfies the design constraints and an efficient combinatorial algorithm to solve the routing subproblem. These two algorithms play an important role in the efficiency and effectiveness of the proposed metaheuristics.A constructive heuristic is an iterative procedure that aims to construct an initial feasible solution. The main idea is to start with an empty solution, and iteratively add new elements to the current solution until a feasible solution is obtained. We propose a deterministic constructive method based on an insertion criterion that takes into account the design constraints, i.e. the set of candidate hub arcs Q that satisfy the minimum and maximum allowed distances between hub nodes, the budget constraint on the total setup cost and the lower and upper limits on the number of hub nodes in each line, to obtain an initial feasible q-line hub network. It is an iterative greedy-type procedure in which at each iteration a cost–benefit ratio function is used to determine which hub node, and associated hub arc(s), should be added to the current solution.Let s be the current solution andskl′the solution obtained by adding hub node k in line l to solution s such that the new hub arcs belong to Q. Also, let C(s) and f(s) be the setup cost and the objective function value associated with solution s, respectively. The cost–benefit of an insertion is measured as the ratio of the increase in the setup cost,C(skl′)−C(s),and the decrease in the objective function value,f(s)−f(skl′),associated with s andskl′when adding hub k in the best feasible position in line l, i.e. the one that minimizes this ratio and does not exceed the budget constraint. Therefore, the insertion cost of hub k in the best position of line l of solution s can be given by:(42)IC(k,l,s)=C(skl′)−C(s)f(s)−f(skl′).LetF(s)denote the set of feasible pairs (k, l) that are candidates to be inserted in the partial solution s, i.e., node k does not belong to line l, the current number of hubs in line l (denoted by pl) is strictly lower than the upper boundp¯,and the setup cost after adding k in the best position in line l does not exceed the budget. In the first part of the constructive heuristic, we iteratively add hubs to the network until we have a feasible q-line hub network satisfying the design constraints. In the second part of the heuristic, we iteratively try to add additional hubs to some lines as long as we are able to keep improving the objective function or until there are no candidates left. The constructive procedure is outlined in Algorithm 1.If Algorithm 1 does not result in a feasible q-line hub network because of the budget constraint, then the insertion cost function (42) is replaced byIC′(k,l,s)=C(skl′)−C(s),which accounts only for the infrastructure cost and the algorithm is repeated.When considering the additional condition that the hub-level network must have a single connected component, the constructive procedure is modified by considering a non-empty initial solution in which an arbitrary node is selected and opened as hub and q hub arcs incident to this node are selected, exactly one in each hub line. This ensures that, if the constructive heuristic produces a feasible solution with respect to the design constraints, the hub level network will be connected. Finally, every node i ∈ N is considered as the initial hub node and the best feasible solution found is then chosen as the initial solution.Once an initial q-line hub network is built, we still need to solve the routing subproblem to determine the optimal paths of O/D pairs that minimize the total weighted travel time. This subproblem can be seen as an extension of the all-pairs shortest path problem where the transfer time between hub lines and the existence of four types of arcs between nodes (access, hub and bridge arcs, and direct connections) needs to be taken into account. In Section 3 we showed how this problem can be formulated and solved as a linear program. However, it can actually be solved more efficiently by using an adaptation of the well-known Floyd–Warshall (FW) algorithm. This adaptation first computes the shortest path between all pairs of hub nodes, taking into account the transfer time between lines, and then computes the shortest path between all pairs of nodes using this information.Letdijkdenote the shortest distance between the pair i, j using only nodes from {1, …, k} as intermediate nodes. In the case of the FW algorithm, the shortest path from i to j using all nodes in a set N,dijn,can be found by means of the recursive equationdijk=min{dijk−1,dikk−1+dkjk−1}. That is, the shortest path from i to j using nodes {1, …, k} is equal to the minimum between the shortest path that has k as an internal node and the one that does not have k as an intermediate node. Moreover, the length of the shortest path from i to j having k as an internal node is equal to the concatenation of the shortest path from i to k and the shortest path from k to j.Our adaptation of the FW algorithm needs to take into account that in the shortest path from a hub i to a hub j: (a) only hub nodes are allowed to be internal nodes, (b) the shortest path length depends on whether an internal hub node k is a transfer node for this path, and (c) hub arcs, with a reduced discount factor, can only be considered. Let H1 and A1 denote the set of open hub nodes and open hub arcs in all the lines, respectively, of the current solution network. For every i, j ∈ N we denote asPij0the shortest path from i to j where no node is used as intermediate node. If (i, j) ∈ A1, thenPij0is equal to αijtij, otherwise it is equal to ∞. The algorithm then adds one node k ∈ H1 at a time as candidate internal node and finishes after |H1| iterations with the shortest paths between all hub nodes. The shortest path in the q-line hub network between every node pair (i, j) ∈ N × N, denoted as SPij, is then computed by selecting the minimum of either the direct connection between i and j, or a path that uses a combination of access and bridge arcs and one or more hub lines. Access and bridge arcs can only be used as the first or last leg of an OD path. The modified FW algorithm is outlined in Algorithm 2.Local search techniques are iterative procedures based on the improvement of a given solution s by finding a new solution s′ in a neighborhoodN(s)of s with a lower objective function value (for a minimization problem). This procedure stops when no such solution can be found, in which case the current solution is called a local optimum. We now propose a local search procedure based on a VND method for the q-HLLP. The VND paradigm was proposed by Hansen and Mladenović (2001) and is based on a systematic local search in a set of m neighborhoods,N1,N2,…,Nm. The main idea is to perform a local search in a neighborhoodN1until a local optimum is found. After that, the search switches to neighborhoodsN2,…,Nm,sequentially, until an improved solution is found. When an improvement is achieved, the search restarts using the neighborhood N1. Our implementation of the VND algorithm considers the following three neighborhoods:•N1: The set of feasible solutions that can be reached by either closing one hub or opening one hub. Closing a hub consists of removing the hub from its associated line and removing the arcs connecting it to the other hubs on that line. If the closed hub is not an extremity of the line, the two hubs that were connected to it will then be connected to each other. Opening a hub consists of inserting a hub in any position of a line;N2: The set of feasible solutions that can be reached by swapping two hubs in the network. Swapping consists of selecting two hubs in the same line or in different lines, and exchanging their positions;N3: The set of feasible solutions that can be reached by simultaneously closing and opening one hub in the network. The new hub can be placed in any position of a line.All these neighborhoods consider only feasible movements with respect to the design constraints. Moreover, since closing a hub usually results in a worse solution, the local search inN1allows closing a hub if the cost of the new solution is within γ percent of the best known solution value, where γ ≥ 0 is a parameter of the algorithm.GRASP is a multi-start metaheuristic proposed by Feo and Resende (1989), in which each iteration consists of two phases: a constructive phase and a local search phase. In the constructive phase, an initial solutions is built, iteratively, by adding at random an element from a restricted candidate list (RCL) until a feasible solution is obtained. A local search phase is later used to improve the initial solution by exploring different neighborhoods but always considering feasible solutions. As before, let s denote the current partial solution.In our GRASP, we use the cost–benefit ratio function (42) presented in Section 4.1 as the greedy function to construct the RCL. At each iteration, one element is randomly selected, according to a discrete uniform probability distribution, from the RCL to become a hub in a given line. The RCL is updated at each iteration of the constructive phase and contains the best candidate elementsF(s)with respect to function (42). Letcmin=min{IC(k,l,s):(k,l)∈F(s)}andcmax=max{IC(k,l,s):(k,l)∈F(s)},thenRCL={(k,l):IC(s,k,l)≤cmin+ν(cmax−cmin)},where 0 ≤ ν ≤ 1 is a parameter that controls how greedy or randomized the heuristic is. For instance, when ν = 0 the algorithm is completely greedy, while when ν = 1 the algorithm is completely random. Given that the GRASP is sensitive to this parameter, we use a reactive GRASP method, proposed by Prais and Ribeiro (1999), to achieve a good trade-off between the quality and diversity of the constructed solutions. This method consists of choosing at random a value for ν from a set of potential values {ν1, ν2, …, νm}. Let z* be the value of the incumbent solution andAitbe the average value of all solutions found so far using ν = νiat iteration t. The probability of choosing a value νiis then equal towi/∑j=1mwj,wherewi=z*/Ait.Once an initial feasible solution is obtained, we use the VND algorithm presented in Section 4.3 in the local search phase to improve this solution.The ALNS method, proposed by Ropke and Pisinger (2006), is a metaheuristic based on performing a search in a large neighborhood by partially destroying the current solution and reconstructing it by applying some heuristic rules. Given a set of removal operators and a set of insertion operators, the destroy and repair phases consist of choosing at random a removal and an insertion operator, respectively. Let wibe the weight associated to operator i. The probability of choosing operator i is given by wi/∑jwj. The adaptive part of the algorithm is given by the dynamic updating of these weights. The update of the weight of each operator is done according to the performance of each operator in a time interval (segment) by means of scores, where the score measures the contribution of the operator to the improvement in the objective function. The score of each operator is initially set to zero, in the beginning of the segment, and can be increased at each iteration by: (a) σ1 if the removal–insertion operation pair results in a new best solution, (b) σ2 if the removal–insertion operation pair results in a new solution worse than the minimum, but better than the current one, and (c) σ3 if the removal–insertion operation pair results in a solution that is worse than the current one, but satisfies the acceptance criterion. In practice, σ1 ≥ σ2 ≥ σ3. The weight associated to operator i can be updated throughwi=wi(1−r)+rsioi,where siis the score associated to operator i, oiis the number of times that operator i was used in the last segment, and r is the reaction factor parameter that indicates how fast the weights change according to the last segment’s performance.In our ALNS algorithm, we consider the following removal operators:(a)Random removal operator. This operator consists of removing m hubs chosen randomly according to a discrete uniform probability distribution.Minimum deterioration removal operator. This operator consists of removing, iteratively, m hub nodes that yield the smallest increase in the objective function value.Cost–benefit removal operator. This operator is similar to the previous one, but it also takes into account the infrastructure cost associated to each node. It consists of removing m hub nodes with the worst (i.e., largest) cost–benefit ratio. The idea behind considering the infrastructure cost in the destroy phase aims to make the repair phase more flexible in relation to the budget.Proximity removal operator. The idea is to remove m hub nodes that are geographically close to each other. The first hub node is chosen at random and after that we remove, iteratively, m − 1 hubs that are the closest to the set of hubs already removed. The distance between a hub node and a set of nodes is measured as the distance between this hub and the closest node of the set.Cost–benefit relatedness operator. This operator consists in removing a segment of a line with m hub nodes. The first hub node is chosen randomly and the other m − 1 are chosen among the hub nodes that were connected to the previously removed hub and that have the worst cost–benefit ratio. If the chosen line has fewer than m hub nodes, the other hub nodes are removed by selecting a new initial hub node randomly.Since most of these operators are deterministic, we introduce some randomness in the algorithm by including a parameter ρ > 1 in the removal operators (b)–(e), as suggested by Ropke and Pisinger (2006). Let H be a sorted set of hub nodes ordered according to the removal operator’s main criterion and letRbe a random number from the interval [0, 1). The idea is to remove the[Rρ|H|]-th element of H, instead of always removing the first one. Observe that the parameter ρ controls how much randomness is added to these operators, where small values of ρ result in more randomness.In order to reconstruct the network so as to obtain a feasible solution, we use the following two insertion operators:(a)Savings insertion operator. Insert, iteratively, hub nodes that will result in the largest improvement in the objective function value.Cost–benefit insertion operator. Insert iteratively hubs with the lowest cost–benefit ratio (42).Finally, a solution s′ is accepted according to a simulated annealing acceptance criterion, i.e. we accept a new solution s′ with probabilityef(s′)−f(s))/T,where T > 0 is the temperature. The temperature starts with a value T = T0 and decreases periodically at a cooling rate c.We next present the results of extensive computational experiments performed to assess the behavior of our exact and heuristic algorithms. In the first part of the experiments, we compare the Benders-branch-and-cut method with a general-purpose solver for instances with up to 40 nodes. The second part of the experiments focuses on the comparison of the proposed heuristic methods. We first apply the metaheuristics to solve the case of q = 1, i.e. the single-line HLLP introduced by Martins de Sá et al. (in press). We then use the metaheuristics to solve the q-HLLP. In the third part of the experiments, we analyze how the discount factor, the transfer time and the budget parameters affect the topology of q-line hub networks. All experiments were performed on a 1260 Xeon Westmere 2.66 gigahertz computer with 24 gigabytes of memory and running Linux. The BBC was coded in C++ using the Concert Technology of CPLEX 12.5 to solve the Benders MPs and SPs.We have used two standard benchmark instances for hub location in our computational experiments: the Australian Post (AP) data set introduced by Ernst and Krishnamoorthy (1996) and the CAB data set of the US Civil Aeronautics Board first used in O’Kelly (1987). Both data sets provide an OD demand matrix and coordinates for each OD node. The AP instances also provide a fixed cost associated to the installation of each potential hub node. Since CAB instances do not provide these data, we use the fixed setup cost generated by de Camargo, Miranda, and Luna (2008). Furthermore, the cost for opening a hub arc (k, m), which is not provided in the two data sets, is assumed to be equal to 2000 tkmfor AP instances and to 500 tkmfor CAB instances. As in other hub location problems, the travel time between a node pair is assumed to be equal to the Euclidean distance between them.Tests were carried out by considering the discount factor values of αij= α in {0.2, 0.4, 0.6, 0.8}. Moreover, in all experiments we consider that the access, exit and transfer times are the same for every node k ∈ N, and controlled by means of the parameter ϑ ∈ {0, 0.1, 0.25}, which is used to set the transfer time ast˜ks=ϑt¯ij,wheret¯ijis the average travel time between all node pairs computed ast¯ij=∑i∑jtij/n(n−1).The access and exit times are assumed to be equal to 90 percent and 10 percent of the transfer time, respectively. Furthermore, we consider the budget constraint to be proportional to the total design cost of the network in which each line hasp=⌊(p¯+p̲)/2⌋hubs, where the hub node and hub arc setup costs are assumed to be equal to the average hub node setup costf¯and the average hub arc installation costc¯,respectively. A proportionality factor β ∈ {0.6, 1.0, 2.0} is used to vary the budget asB=βq(pf¯+(p−1)c¯),wherepf¯is the average cost to install the hubs and(p−1)c¯is the average cost to install the hub arcs. Finally, the subset Q of hub arc candidates is obtained by sorting all arcs in increasing order of their length and by ignoring the first 10 percent and last 40 percent of the sorted list.Tables 1and 2present the computational results comparing the BBC and CPLEX for instances with n ∈ {10, 20}, ϑ ∈ {0.0, 0.1, 0.2} and β ∈ {0.6, 1.0, 2.0} for both the AP and CAB data sets when the hub-level network is not required to be connected. Tables 3and 4present the results when the hub-level network is required to define a single connected component. These experiments were performed using the AP instances with n ∈ {10, 20}, α ∈ {0.4, 0.6, 0.8}, ϑ ∈ {0.1, 0.2} and β ∈ {0.6}, which are the cases where disconnected hub networks are sometimes obtained. Table 5presents the results for AP instances with n ∈ {25, 40}, ϑ = 0.1 and β = 1.0 when the hub-level network is not required to be connected. We consider instances with q ∈ {2, 3},p=2 andp¯=6for n = 10, andp=3 andp¯=8for the other values of n, and α ∈ {0.2, 0.4, 0.6, 0.8}. Each row of these tables presents the average CPU time in seconds, the average optimality gap and the number of solved instances aggregated by the ϑ and β parameters. In all the experiments, we use a CPU time limit of 24 hours. We indicate “–” when no feasible solution was found and “*” when neither a feasible solution nor a lower bound was found.In the case of the AP dataset, from Table 1 we note that BBC solves the considered instances slightly faster on average and is able to prove optimality in seven more instances compared with CPLEX. For the instances in which any of the algorithms is capable of obtaining the optimal solution, BBC provides slightly better gaps. In the case of the CAB dataset, CPLEX seems to obtain slightly better results as it is able to prove the optimality of two more instances and the remaining average percent gap is smaller than for BBC. When the hub-level network is required to be connected, Tables 3 and 4 show that in both datasets BBC solves the instances faster on average than CPLEX. However, CPLEX can solve two more instances than BBC. For the case of larger instances with 25 and 40 nodes, Table 5 shows that only three instances are solved to optimality by both CPLEX and BBC. BBC found the optimal solutions for these instances faster than CPLEX. Furthermore, BBC is able to provide a lower bound for all considered instances whereas CPLEX fails to even solve the LP relaxation after 24 hours for all but one of the 40-node instances. These results provide an indication of the increased complexity of solving to optimality the q-HLLP as compared to the single line case. We recall that the Benders decomposition presented in Martins de Sá et al. (in press) for the HLLP can solve to optimality instances with up to 100 nodes. Our BBC algorithm for the q-HLLP can still be used for larger instances to obtain lower bounds on the optimal solution value to evaluate the performance of the proposed heuristic algorithms.We now present a comparison between the three metaheuristic algorithms presented in Section 4. After some preliminary computational experiments, we set the values of the parameters used in the algorithms as follows. For VND, the value of γ is equal to 2, which allows the selected solution fromN1to be at most 2 percent worse than the current one. For GRASP, the value for ν is chosen at random from {0.01, 0.02, …, 0.1} and the weights wj, for j = 1, …, 10, associated with each of these values are updated every 10 iterations as described in Section 4.4. Furthermore, the termination criteria used are the maximum number of iterations equal to 40 or a time limit of 3600 seconds. For ALNS, the values for the σiparameters are σ1 = 10, σ2 = 7, σ3 = 5, ρ = 3, and r = 0.3. Furthermore, we set the initial temperature T0 = 10,000 and the cooling rate c = 0.990822, so as to obtain a maximum number of iterations of 1000. Finally, the parameter m was chosen randomly considering values between[1,(p¯+p̲)/2],where the weight associated with each value is updated adaptively. Finally, the termination criteria used are the temperature T becoming smaller than the threshold ε = 1 or a time limit of 3600 seconds.We first focus on analyzing the performance of our algorithms for the single line case, i.e. the HLLP. We use the Benders-branch-and-cut algorithm presented in Martins de Sá et al. (in press) to provide the optimal solutions or lower bounds for the considered instances. Since the HLLP has a fixed value for the number of hubs on the line and no budget constraint, the tests were performed consideringp̲=p¯∈{5,8},fi1=0,for i ∈ N andckm1=0,for k, m ∈ N. Furthermore, the tests consider the following parameter values: α ∈ {0.2, 0.5, 0.8}, ϑ ∈ {0.0, 0.1, 0.2} and n ∈ {10, 20, 25, 40, 50, 75, 100}. Table 6presents the average gap and number of instances solved for each metaheuristic. For comparative purposes, we also present the results from the constructive heuristic from Section 4.1. Each row aggregates the results by α and ϑ parameters.According to Table 6, the GRASP and ALNS algorithms present the best performance. The GRASP is able to obtain the optimal solution in 111 out of 114 instances in which the optimal solution is known, whereas the ALNS obtains 102 optimal solutions. Furthermore, the solutions provided by both metaheuristics present a gap with the optimal solution (or best lower bound) of less than 0.17 percent, showing that they can successfully solve the HLLP.The comparison of the proposed heuristics to solve the q-HLLP is presented in Tables 7–11. The results presented in these tables use the same set of instances as in Tables 1–5, respectively. Table 11 also presents results for instances with n = 50 and n = 70. In order to better compare the solutions produced by each algorithm, we take into account two different performance measures: gap is the deviation between the optimal solution (or the best lower bound found by CPLEX and BBC) and the best solution found in any algorithm; percent Dev is the percent deviation between the solution found by each algorithm and the best solution found in any algorithm. To compute the average percent Dev for BBC and CPLEX, we consider only the instances for which the method obtains a feasible solution.Once more, from Tables 7–11 we observe that the GRASP and ALNS algorithms present better performance than the constructive heuristic and the VND procedure. The average gap between the best solution found and the lower bound is 0.67 percent for AP instances, 0.75 percent for CAB instances with up to 20 nodes and 2.41 percent for the larger AP instances. Furthermore, for instances where we do not know the optimal solution, the solution of GRASP and ALNS is, on average, better than the best incumbent found by both CPLEX and BBC. In the case where the hub-level network must be connected, the average gap is 0.06 percent for AP instances and 0.20 percent for CAB instances. By comparing the ALNS and GRASP, GRASP presents a better performance than ALNS for instances with up to 20 nodes by solving more instances and presenting a better gap. On the other hand, ALNS presents a better performance than GRASP for the experiments using the AP instances with 25 up to 70 nodes providing in most cases the best known solution.To analyze how the parameters α, ϑ and β affect the configuration of the hub line network, Figs. 2–4present different network configurations obtained by varying these parameters, considering a network with 25 nodes and 3 lines having between 3 and 8 hubs each. We also report information about the designed system such as the percentage of flow that uses the line and the number of direct connections and access edges. Since we do not have an optimal solution for all of these instances, we are using the solution provided by the ALNS algorithm.Fig. 2 presents the system configuration when the economies of scale factor α is set to 0.2 and the budget factor β is set to 1.0, while we vary the value of ϑ. From Fig. 2, we note that these parameters have a substantial impact on the number of transfer hub nodes, i.e., nodes that are at the intersection of two or more lines. For small transfer times, the network has two transfer hub nodes, while for medium and large transfer times we have just one transfer hub node. Furthermore, the number of access edges increases as the transfer time increases. Fig. 3 presents the network configurations by fixing the transfer time parameter ϑ to 0.1 and the budget parameter β to 1.0, and changing the value of α. In this case, the parameter has a great impact on the number of access edges, i.e., the number of access edges increases as the economies of scale factor increases.Fig. 4 presents the network configuration when we fix the waiting time parameter ϑ = 0.1 and the economies of scale factor α = 0.2 and just vary the budget parameter. The figures confirm that this parameter has a great impact on the network topology. The number of installed hubs and the amount of flow using the multiple hub line network is directly proportional to the budget available to design the network. Furthermore, the number of direct connections decreases and the number of access edges increases as the budget increases.

@&#CONCLUSIONS@&#
